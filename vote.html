<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Enjoy Vote - Dark Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ì‚¬íŒŒë¦¬ í’€ìŠ¤í¬ë¦° ê°•ì œ ê³ ì • */
        html, body {
            width: 100%; height: 100%;
            overflow: hidden; /* ë¸Œë¼ìš°ì € ìì²´ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            position: fixed; /* iOS ë°”ìš´ìŠ¤ ë°©ì§€ */
            top: 0; left: 0;
            background-color: #000000;
            font-family: 'Pretendard', sans-serif;
            color-scheme: dark; /* ë„¤ì´í‹°ë¸Œ ìš”ì†Œ ë‹¤í¬ëª¨ë“œ ëŒ€ì‘ */
        }

        /* ì¤‘ì•™ ì •ë ¬ìš© ë˜í¼ (PC í™”ë©´ ëŒ€ì‘) */
        #app-wrapper {
            width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
        }

        #mobile-frame {
            width: 100%; max-width: 430px; 
            height: 100%; /* ë¶€ëª¨ ë†’ì´ ê½‰ ì±„ì›€ */
            background: #111111; /* ë‹¤í¬ ëª¨ë“œ ë°°ê²½ */
            position: relative; 
            overflow: hidden;
            display: flex; flex-direction: column;
            z-index: 10;
        }

        /* PC/íƒœë¸”ë¦¿ì—ì„œëŠ” ê·¸ë¦¼ì íš¨ê³¼ */
        @media (min-width: 480px) {
            #mobile-frame {
                height: 100dvh; /* PCì—ì„œëŠ” dvh ì‚¬ìš© */
                max-height: 900px; /* ë„ˆë¬´ ê¸¸ì–´ì§€ì§€ ì•Šê²Œ ì œí•œ */
                border-radius: 30px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
                box-shadow: 0 0 50px rgba(0,0,0,0.8);
            }
        }

        /* ëª¨ë°”ì¼ì—ì„œëŠ” ê½‰ ì±„ìš°ê¸° */
        @media (max-width: 480px) {
            #app-wrapper { display: block; }
            #mobile-frame { 
                max-width: 100%; 
                border-radius: 0; 
                height: 100%; 
            }
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        .toss-card {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 24px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2); 
            transition: transform 0.1s; cursor: pointer;
        }
        .toss-card:active { transform: scale(0.97); }

        .screen {
            position: absolute; inset: 0; background: #111111;
            display: flex; flex-direction: column; overflow: hidden;
            opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 10;
        }
        .screen.active { opacity: 1; pointer-events: auto; z-index: 20; }

        .full-modal {
            position: absolute; inset: 0; background: #111111; z-index: 100;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column;
        }
        .full-modal.open { transform: translateY(0); }

        .cert-modal-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.8); z-index: 200;
            backdrop-filter: blur(4px); opacity: 0; pointer-events: none;
            transition: opacity 0.3s; display: flex; align-items: center; justify-content: center;
            padding: 20px;
        }
        .cert-modal-overlay.active { opacity: 1; pointer-events: auto; }
        
        .cert-card-bg {
            background: radial-gradient(circle at top right, #3b0764, #111111 60%);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.1) inset;
        }

        .rank-1-card {
            background: linear-gradient(135deg, #2e1065 0%, #111111 100%);
            border: 2px solid #9333ea; box-shadow: 0 8px 32px rgba(147, 51, 234, 0.15);
        }
        .bar-gradient { background: linear-gradient(90deg, #C084FC 0%, #A855F7 100%); }
        .number-counting { font-variant-numeric: tabular-nums; }
        
        #confetti-canvas, #cert-confetti-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }
        #confetti-canvas { z-index: 150; }
        #cert-confetti-canvas { z-index: 250; }

        /* ì•ˆì „ ì˜ì—­(Safe Area) ëŒ€ì‘ íŒ¨ë”© */
        .pt-safe { padding-top: max(20px, env(safe-area-inset-top)); }
        .pb-safe-scroll { padding-bottom: calc(100px + env(safe-area-inset-bottom)); }

        .fade-in-up { animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        
        .stamp-ani { animation: stamp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; opacity: 0; transform: scale(2); }
        @keyframes stamp { to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

    <div id="app-wrapper">
        <div id="mobile-frame">
            <canvas id="confetti-canvas"></canvas>
            <canvas id="cert-confetti-canvas"></canvas>
            
            <!-- ë©”ì¸ í™”ë©´ -->
            <div id="screen-home" class="screen active">
                
                <div class="flex-1 overflow-y-auto scrollbar-hide px-5 pt-safe pb-safe-scroll">
                    <!-- ë°°ë„ˆ (ë°°ë„ˆëŠ” ì‹œê°ì  í¬ì¸íŠ¸ë¥¼ ìœ„í•´ ë°ì€ í†¤ ìœ ì§€) -->
                    <div class="fade-in-up delay-100 mb-8 w-full h-72 rounded-[28px] relative overflow-hidden shadow-2xl shadow-purple-900/30 border border-white/10 group">
                        <!-- ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ ë° ì¥ì‹ íŒ¨í„´ -->
                        <div class="absolute inset-0 bg-gradient-to-br from-gray-900 via-purple-900/80 to-black"></div>
                        <div class="absolute inset-0" style="background-image: radial-gradient(rgba(255,255,255,0.08) 1px, transparent 1px); background-size: 20px 20px; opacity: 0.5;"></div>
                        
                        <!-- ë¹›ë‚˜ëŠ” ì˜¤ë¼ íš¨ê³¼ -->
                        <div class="absolute -right-10 -top-10 w-60 h-60 bg-purple-500/30 rounded-full blur-3xl group-hover:bg-purple-500/40 transition-all duration-700"></div>
                        <div class="absolute -left-10 bottom-0 w-48 h-48 bg-blue-500/20 rounded-full blur-3xl group-hover:bg-blue-500/30 transition-all duration-700"></div>
                        
                        <!-- ì¥ì‹ìš© ë°°ê²½ ì•„ì´ì½˜ (ì€ì€í•˜ê²Œ) -->
                        <i class="fa-solid fa-music absolute top-8 right-12 text-purple-300/10 text-3xl rotate-12"></i>
                        <i class="fa-solid fa-crown absolute bottom-24 left-1/2 text-yellow-300/10 text-4xl rotate-[-15deg]"></i>
                        <i class="fa-solid fa-star absolute top-1/2 right-1/3 text-pink-300/10 text-xl rotate-45"></i>

                        <!-- í”„ë¡œê·¸ë¨ ë¡œê³  -->
                        <img src="program_logo.png" alt="Logo" class="absolute right-2 bottom-4 w-40 h-40 object-contain drop-shadow-[0_10px_15px_rgba(0,0,0,0.5)] rotate-[-5deg] group-hover:scale-105 group-hover:rotate-[-2deg] transition-transform duration-500 z-10" onerror="this.style.display='none'; document.getElementById('fb-icon').style.display='block'">
                        <div id="fb-icon" class="hidden absolute right-6 bottom-6 text-[80px] drop-shadow-2xl rotate-[-10deg] filter brightness-105 z-10">ğŸ¤</div>
                        
                        <!-- ì½˜í…ì¸  ì˜ì—­ -->
                        <div class="relative z-20 h-full p-6 flex flex-col justify-between">
                            <div>
                                <!-- ìƒë‹¨ ë±ƒì§€ -->
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="inline-flex items-center gap-1.5 bg-gradient-to-r from-purple-600 to-pink-500 text-white text-[10px] font-black px-3 py-1.5 rounded-full shadow-lg shadow-purple-500/30 tracking-wide">
                                        <i class="fa-solid fa-trophy text-yellow-300"></i> WINNER
                                    </span>
                                    <span class="inline-flex items-center gap-1 bg-white/10 text-purple-300 text-[10px] font-bold px-2.5 py-1.5 rounded-full backdrop-blur-sm border border-purple-500/30 shadow-sm">
                                        <span class="w-1.5 h-1.5 rounded-full bg-purple-400 animate-pulse"></span> CLOSED
                                    </span>
                                </div>
                                
                                <!-- ë©”ì¸ íƒ€ì´í‹€ -->
                                <h2 class="text-[28px] font-extrabold text-white leading-[1.2] tracking-tight drop-shadow-lg">
                                    ì—”ì¡°ì´ ì¸ê¸°ê°€ìš”2<br>
                                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-300">ì „ì‹œê¸° 1ìœ„ ì„ ì •</span>
                                </h2>
                                
                                <!-- ë…¸ë˜ ì •ë³´ -->
                                <div class="mt-4 flex items-center gap-2.5">
                                    <div class="w-1 h-8 bg-gradient-to-b from-purple-400 to-pink-400 rounded-full"></div>
                                    <div>
                                        <p class="text-purple-300/80 font-bold text-[10px] uppercase tracking-wider mb-0.5">ì„ ì •ê³¡</p>
                                        <p class="text-white font-bold text-sm drop-shadow-md">ğŸµ ë„ˆì˜ ëª¨ë“  ìˆœê°„</p>
                                    </div>
                                </div>
                            </div>

                            <!-- í•˜ë‹¨ ê°ì‚¬ ì¹´ë“œ (ë¹ˆ ê³µê°„ ì±„ìš°ê¸° ìš©ë„) -->
                            <div class="w-[65%] sm:w-[70%] bg-white/5 backdrop-blur-md border border-white/10 rounded-[18px] p-3 flex items-center gap-3 shadow-inner">
                                <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center border border-purple-500/30 shrink-0">
                                    <i class="fa-solid fa-heart text-pink-400 text-xs animate-pulse"></i>
                                </div>
                                <div class="overflow-hidden">
                                    <p class="text-[9px] text-gray-400 font-bold tracking-wider">THANK YOU</p>
                                    <p class="text-xs text-white font-medium truncate">íˆ¬í‘œí•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ -->
                    <div class="fade-in-up delay-200">
                        <h3 class="text-lg font-bold text-gray-100 mb-3 px-1">íˆ¬í‘œ ê²°ê³¼</h3>
                        <div id="result-list" class="space-y-3"></div>
                    </div>

                    <!-- íˆ¬í‘œ ë°˜ì˜ ë¹„ìœ¨ -->
                    <div class="fade-in-up delay-300 mt-8 mb-6">
                        <h3 class="text-lg font-bold text-gray-100 mb-3 px-1">íˆ¬í‘œ ë°˜ì˜ ë¹„ìœ¨</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <!-- ì•„í‹°ìŠ¤íŠ¸ -->
                            <div class="bg-gray-800/60 p-4 rounded-[24px] shadow-sm border border-gray-700/50 relative overflow-hidden flex flex-col justify-between h-[110px]">
                                <div class="absolute -right-2 -top-2 w-16 h-16 bg-blue-900/30 rounded-full blur-lg"></div>
                                <div class="relative z-10">
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="text-[11px] text-gray-400 font-bold">ì•„í‹°ìŠ¤íŠ¸</p>
                                        <i class="fa-solid fa-microphone text-blue-400 text-sm"></i>
                                    </div>
                                    <div class="flex items-baseline gap-0.5">
                                        <span class="text-3xl font-black text-white tracking-tight">15</span>
                                        <span class="text-xs font-bold text-blue-400">%</span>
                                    </div>
                                </div>
                                <div class="w-full bg-gray-700/80 rounded-full h-1.5 overflow-hidden"><div class="bg-blue-400 h-full rounded-full" style="width: 15%"></div></div>
                            </div>

                            <!-- ë…¸ë˜ì œëª© -->
                            <div class="bg-gray-800/60 p-4 rounded-[24px] shadow-sm border border-gray-700/50 relative overflow-hidden flex flex-col justify-between h-[110px]">
                                <div class="absolute -right-2 -top-2 w-16 h-16 bg-green-900/30 rounded-full blur-lg"></div>
                                <div class="relative z-10">
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="text-[11px] text-gray-400 font-bold">ë…¸ë˜ì œëª©</p>
                                        <i class="fa-solid fa-headset text-green-400 text-sm"></i>
                                    </div>
                                    <div class="flex items-baseline gap-0.5">
                                        <span class="text-3xl font-black text-white tracking-tight">15</span>
                                        <span class="text-xs font-bold text-green-400">%</span>
                                    </div>
                                </div>
                                <div class="w-full bg-gray-700/80 rounded-full h-1.5 overflow-hidden"><div class="bg-green-400 h-full rounded-full" style="width: 15%"></div></div>
                            </div>

                            <!-- AI ì‹¤ë ¥í‰ê°€ -->
                            <div class="bg-gray-800/60 p-4 rounded-[24px] shadow-sm border border-gray-700/50 relative overflow-hidden flex flex-col justify-between h-[110px]">
                                <div class="absolute -right-2 -top-2 w-16 h-16 bg-pink-900/30 rounded-full blur-lg"></div>
                                <div class="relative z-10">
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="text-[11px] text-gray-400 font-bold">AI ì‹¤ë ¥í‰ê°€</p>
                                        <i class="fa-solid fa-robot text-pink-400 text-sm"></i>
                                    </div>
                                    <div class="flex items-baseline gap-0.5">
                                        <span class="text-3xl font-black text-white tracking-tight">30</span>
                                        <span class="text-xs font-bold text-pink-400">%</span>
                                    </div>
                                </div>
                                <div class="w-full bg-gray-700/80 rounded-full h-1.5 overflow-hidden"><div class="bg-pink-400 h-full rounded-full" style="width: 30%"></div></div>
                            </div>

                            <!-- ë³¸íˆ¬í‘œ -->
                            <div class="bg-purple-900/20 p-4 rounded-[24px] shadow-sm border border-purple-800/50 relative overflow-hidden flex flex-col justify-between h-[110px]">
                                <div class="absolute -right-4 -top-4 w-20 h-20 bg-purple-600/20 rounded-full blur-xl"></div>
                                <div class="relative z-10">
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="text-[11px] text-purple-400 font-bold">ìƒë°©ì†¡ ë³¸íˆ¬í‘œ</p>
                                        <i class="fa-solid fa-check-to-slot text-purple-400 text-sm"></i>
                                    </div>
                                    <div class="flex items-baseline gap-0.5">
                                        <span class="text-3xl font-black text-purple-400 tracking-tight">40</span>
                                        <span class="text-xs font-bold text-purple-300">%</span>
                                    </div>
                                </div>
                                <div class="w-full bg-purple-900/50 rounded-full h-1.5 overflow-hidden"><div class="bg-purple-500 h-full rounded-full" style="width: 40%"></div></div>
                            </div>
                        </div>
                    </div>
                    <!-- ì•ˆì „ ì˜ì—­ë§Œí¼ ì¶”ê°€ ì—¬ë°± -->
                    <div class="h-8"></div>
                </div>
            </div>

            <!-- ì„ ë¬¼ í™”ë©´ -->
            <div id="screen-present" class="screen">
                <header class="flex-none px-5 pt-safe pb-2 flex justify-center items-center bg-[#111111]/80 backdrop-blur-md border-b border-gray-800 z-20 h-14">
                    <span class="text-sm font-bold text-white">ì„ ë¬¼ ë½‘ê¸°</span>
                </header>
                <div class="flex-1 overflow-y-auto scrollbar-hide px-5 pt-safe pb-safe-scroll flex flex-col items-center justify-center">
                    <div id="gift-login-area" class="w-full px-4">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-purple-900/50 text-purple-400 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                                <i class="fa-solid fa-gift"></i>
                            </div>
                            <h3 class="text-xl font-bold text-white mb-2">ë‹¹ì‹ ì€ 1ìœ„ ì…ë‹ˆê¹Œ, 2ìœ„ì…ë‹ˆê¹Œ?</h3>
                            <p class="text-sm text-gray-400 mb-6">ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•´ì•¼ ì…ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                        </div>
                        <input type="text" id="gift-name-input" placeholder="" class="w-full bg-gray-800 border border-gray-700 text-white rounded-xl px-4 py-3.5 text-center text-lg font-bold mb-4 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-900 transition-all">
                        <button onclick="window.checkGiftLogin()" class="w-full bg-purple-600 text-white font-bold text-lg py-4 rounded-[24px] shadow-lg active:scale-95 transition-transform">ì…ì¥í•˜ê¸°</button>
                    </div>
                    
                    <div id="gift-content-area" class="hidden w-full px-4 text-center">
                        <div id="gift-box-icon" class="w-20 h-20 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4 border border-gray-700 transition-transform">
                            <i class="fa-solid fa-gift text-3xl text-purple-500"></i>
                        </div>
                        <h2 id="gift-welcome-title" class="text-2xl font-bold text-white mb-2"></h2>
                        
                        <div id="gift-result-box" class="hidden mt-6 bg-gray-800 border border-purple-500/50 rounded-[20px] p-6 shadow-lg shadow-purple-900/20">
                            <p class="text-xs text-purple-400 font-bold mb-2">ë‹¹ì²¨ëœ ì„ ë¬¼</p>
                            <h3 id="gift-result-text" class="text-xl font-extrabold text-white break-keep"></h3>
                        </div>

                        <button id="btn-draw-gift" onclick="window.drawGift()" class="w-full mt-6 bg-gradient-to-r from-purple-600 to-pink-500 text-white font-bold text-lg py-4 rounded-[24px] shadow-lg active:scale-95 transition-transform disabled:opacity-50">ì„ ë¬¼ ë½‘ê¸° ğŸ</button>
                    </div>

                    <!-- ì„¤ì •(ë§ˆìŠ¤í„°í‚¤) ì˜ì—­ -->
                    <div id="gift-settings-area" class="hidden w-full px-4 text-center">
                        <h2 class="text-2xl font-bold text-white mb-6">âš™ï¸ ë§ˆìŠ¤í„° ì„¤ì •</h2>
                        <div class="bg-gray-800 border border-gray-700 rounded-[20px] p-6 text-left space-y-4 shadow-lg shadow-purple-900/20">
                            <div>
                                <div class="flex justify-between items-center">
                                    <p class="text-sm text-gray-400 font-bold">ğŸ¥‡ ì „ì‹œê¸° ë‹¹ì²¨ ê²°ê³¼</p>
                                    <button onclick="window.resetGiftCount('ì „ì‹œê¸°')" class="text-[10px] bg-red-500/20 text-red-400 px-2 py-1 rounded border border-red-500/50 hover:bg-red-500/40 transition-colors">ì´ˆê¸°í™”</button>
                                </div>
                                <p id="setting-result-1" class="text-lg text-purple-400 font-bold mt-1 break-keep">ë¯¸ì°¸ì—¬</p>
                            </div>
                            <div class="h-px bg-gray-700 w-full"></div>
                            <div>
                                <div class="flex justify-between items-center">
                                    <p class="text-sm text-gray-400 font-bold">ğŸ¥ˆ í™ë°•ì‚¬ ë‹¹ì²¨ ê²°ê³¼</p>
                                    <button onclick="window.resetGiftCount('í™ë°•ì‚¬')" class="text-[10px] bg-red-500/20 text-red-400 px-2 py-1 rounded border border-red-500/50 hover:bg-red-500/40 transition-colors">ì´ˆê¸°í™”</button>
                                </div>
                                <p id="setting-result-2" class="text-lg text-purple-400 font-bold mt-1 break-keep">ë¯¸ì°¸ì—¬</p>
                            </div>
                            <div class="h-px bg-gray-700 w-full"></div>
                            <div>
                                <p class="text-sm text-gray-400 font-bold">ğŸ§ª í…ŒìŠ¤íŠ¸ ë‹¹ì²¨ ê²°ê³¼</p>
                                <p id="setting-result-test" class="text-lg text-purple-400 font-bold mt-1 break-keep">ë¯¸ì°¸ì—¬</p>
                            </div>
                        </div>
                        <button onclick="location.reload()" class="w-full mt-6 bg-gray-700 text-white font-bold text-lg py-4 rounded-[24px] shadow-lg active:scale-95 transition-transform">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ëª¨ë‹¬ (ìƒì„¸) -->
            <div id="modal-detail" class="full-modal">
                <header class="flex-none px-5 pt-safe pb-2 flex justify-between items-center bg-[#111111]/80 backdrop-blur-md border-b border-gray-800 z-20 h-14">
                    <button onclick="window.closeModal()" class="w-8 h-8 rounded-full hover:bg-white/10 flex items-center justify-center"><i class="fa-solid fa-chevron-left text-lg text-white"></i></button>
                    <span class="text-sm font-bold text-white">íˆ¬í‘œ ìƒì„¸</span>
                    <div class="w-8"></div>
                </header>
                <div class="flex-1 overflow-y-auto scrollbar-hide px-5 pt-6 pb-safe-scroll">
                    <div class="text-center mb-8">
                        <span id="poll-badge" class="inline-block px-2 py-1 bg-gray-800 text-gray-300 text-[10px] font-bold rounded mb-2">ìƒíƒœ</span>
                        <h2 id="detail-title" class="text-2xl font-bold text-white mb-1.5 leading-tight break-keep">ì œëª©</h2>
                        <p id="detail-info" class="text-xs text-gray-400 font-medium">ì •ë³´</p>
                    </div>
                    <div id="detail-options" class="space-y-3 pb-8"></div>
                    <div class="mt-4 pb-12">
                        <button id="btn-submit" onclick="window.submitVote()" class="w-full bg-purple-600 text-white font-bold text-lg py-4 rounded-[24px] shadow-lg active:scale-95 transition-transform disabled:bg-gray-800 disabled:text-gray-500 disabled:shadow-none">íˆ¬í‘œí•˜ê¸°</button>
                        <!-- ê²°ê³¼ ë²„íŠ¼ë“¤ -->
                        <div id="result-buttons" class="hidden space-y-3 mt-3">
                            <button onclick="window.voteAgain()" class="w-full bg-gray-800 border border-gray-700 text-gray-300 font-bold text-lg py-4 rounded-[24px] shadow-sm active:scale-95 transition-transform">í•œ ë²ˆ ë” íˆ¬í‘œí•˜ê¸° â†º</button>
                            <button onclick="window.openCertInput()" class="w-full bg-purple-900/30 border border-purple-800 text-purple-400 font-bold text-lg py-4 rounded-[24px] shadow-sm active:scale-95 transition-transform flex items-center justify-center gap-2">
                                <i class="fa-solid fa-certificate"></i> ì¸ì¦ì„œ ë°œê¸‰ë°›ê¸°
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ì¸ì¦ì„œ ëª¨ë‹¬ -->
            <div id="modal-cert" class="cert-modal-overlay">
                <div id="cert-step-1" class="w-full bg-gray-900 border border-gray-800 rounded-[28px] p-6 shadow-2xl transform transition-all scale-100">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-purple-900/50 text-purple-400 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl animate-bounce">
                            <i class="fa-solid fa-pen-nib"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white">íˆ¬í‘œ ì¸ì¦ì„œ ë°œê¸‰</h3>
                        <p class="text-sm text-gray-400 mt-1">ì¸ì¦ì„œì— í‘œì‹œë  ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                    </div>
                    <input type="text" id="cert-name-input" placeholder="ì´ë¦„ ë˜ëŠ” ë‹‰ë„¤ì„ (ìµœëŒ€ 6ì)" maxlength="6" class="w-full bg-gray-800 border border-gray-700 text-white rounded-xl px-4 py-3.5 text-center text-lg font-bold mb-4 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-900 transition-all placeholder-gray-500">
                    <div class="flex gap-2">
                        <button onclick="window.closeCertModal()" class="flex-1 py-3.5 rounded-xl bg-gray-800 text-gray-400 font-bold hover:bg-gray-700">ì·¨ì†Œ</button>
                        <button onclick="window.generateCert()" class="flex-1 py-3.5 rounded-xl bg-purple-600 text-white font-bold shadow-md hover:bg-purple-500">ë°œê¸‰í•˜ê¸°</button>
                    </div>
                </div>

                <div id="cert-step-2" class="hidden w-full relative">
                    <button onclick="window.closeCertModal()" class="absolute -top-12 right-0 text-white/80 hover:text-white text-2xl z-50 p-2"><i class="fa-solid fa-xmark"></i></button>
                    <div id="cert-capture-area" class="cert-card-bg rounded-[24px] p-6 text-center relative overflow-hidden transform transition-transform">
                        <div class="absolute -right-10 -bottom-10 w-32 h-32 bg-purple-600/20 rounded-full blur-xl"></div>
                        <div class="relative z-10 pt-2">
                            <div class="inline-block px-3 py-1 rounded-full border border-purple-700/50 bg-purple-900/30 text-[10px] text-purple-300 font-bold tracking-widest mb-4">OFFICIAL CERTIFICATE</div>
                            <h2 class="text-[22px] font-extrabold text-white leading-tight mb-6" id="cert-poll-title">íˆ¬í‘œ ì œëª©</h2>
                            <div class="bg-black/40 rounded-xl p-4 border border-white/10 mb-6 backdrop-blur-md">
                                <p class="text-[11px] text-gray-400 font-bold mb-1">VOTE STATUS</p>
                                <div class="text-xl font-black text-gray-300 tracking-wider">SECRET ğŸ”’</div>
                            </div>
                            <div class="flex justify-between items-end border-t border-gray-700 pt-5 mt-2">
                                <div class="text-left">
                                    <p class="text-[10px] text-gray-500 font-bold mb-0.5">VOTER</p>
                                    <p class="text-base font-bold text-white" id="cert-user-name">ì´ë¦„</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-[10px] text-gray-500 font-bold mb-0.5">DATE & TIME</p>
                                    <p class="text-sm font-medium text-gray-400 tracking-tight" id="cert-date">2024.02.09 14:00</p>
                                </div>
                            </div>
                            <div class="absolute bottom-16 right-4 opacity-0 stamp-ani" style="animation-delay: 0.3s;">
                                <div class="w-20 h-20 border-[3px] border-red-500/60 rounded-full flex items-center justify-center rotate-[-15deg]">
                                    <div class="w-[72px] h-[72px] border border-red-500/60 rounded-full flex items-center justify-center text-red-500 font-black text-xs uppercase tracking-tighter text-center leading-3">VOTE<br>COMPLETE</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 flex flex-col gap-2">
                        <button onclick="window.saveCertImage()" class="w-full bg-white text-black font-bold py-3.5 rounded-[20px] shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2 hover:bg-gray-200">
                            <i class="fa-solid fa-download"></i> ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸°
                        </button>
                        <p class="text-white/50 text-xs text-center">ë˜ëŠ” í™”ë©´ì„ ìº¡ì³í•´ì„œ ê³µìœ í•˜ì„¸ìš”!</p>
                    </div>
                </div>
            </div>

            <!-- í•˜ë‹¨ë°” (ì•½í•œ ë¸”ëŸ¬: backdrop-blur-sm) -->
            <nav id="bottom-nav" class="absolute left-1/2 -translate-x-1/2 z-50 w-auto" style="bottom: calc(8px + env(safe-area-inset-bottom));">
                <div class="flex items-center bg-[#1a1a1a]/80 backdrop-blur-md border border-gray-800 shadow-2xl p-1 gap-1 rounded-full">
                    <div id="nav-bg" class="absolute top-1 bottom-1 bg-gray-800 shadow-md rounded-full z-0 transition-all duration-300 ease-out" style="left: 4px; width: 56px;"></div>
                    
                    <!-- 0: Home -->
                    <button onclick="window.switchTab(0)" class="relative z-10 w-14 py-1.5 flex flex-col items-center gap-0.5 group" id="btn-tab-0"><i class="fa-solid fa-house text-lg text-white"></i><span class="text-[9px] font-bold text-white">í™ˆ</span></button>
                    <!-- 1: Vote (Current) -->
                    <button onclick="window.switchTab(1)" class="relative z-10 w-14 py-1.5 flex flex-col items-center gap-0.5 group" id="btn-tab-1"><i class="fa-solid fa-check-to-slot text-lg text-gray-500"></i><span class="text-[9px] font-medium text-gray-500">íˆ¬í‘œ</span></button>
                    <!-- 2: Present (ì„ ë¬¼) -->
                    <button onclick="window.switchTab(2)" class="relative z-10 w-14 py-1.5 flex flex-col items-center gap-0.5 group" id="btn-tab-2"><i class="fa-solid fa-gift text-lg text-gray-500"></i><span class="text-[9px] font-medium text-gray-500">ì„ ë¬¼</span></button>
                    <!-- 3: My Info -->
                    <button onclick="window.switchTab(3)" class="relative z-10 w-14 py-1.5 flex flex-col items-center gap-0.5 group" id="btn-tab-3"><i class="fa-solid fa-user text-lg text-gray-500"></i><span class="text-[9px] font-medium text-gray-500">ë‚´ ì •ë³´</span></button>
                </div>
            </nav>
        </div>
    </div>

    <!-- íŒŒì´ì–´ë² ì´ìŠ¤ SDK ì¶”ê°€ (v11.6.1) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, increment, deleteField } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- [1] íŒŒì´ì–´ë² ì´ìŠ¤ ì„¤ì • ---
        const firebaseConfig = {
          apiKey: "AIzaSyCDIg4UNJNWa-HUJhjbkBjUyX9eBpq8n0Q",
          authDomain: "vote-c189b.firebaseapp.com",
          projectId: "vote-c189b",
          storageBucket: "vote-c189b.firebasestorage.app",
          messagingSenderId: "470329969958",
          appId: "1:470329969958:web:91cf5d7f8ca6142297c5e7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        window.db = db;
        window.auth = auth;
        
        // í•¨ìˆ˜ë“¤ ì „ì—­ ë…¸ì¶œ
        window.signInAnonymously = signInAnonymously;
        window.collection = collection;
        window.doc = doc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.updateDoc = updateDoc;
        window.onSnapshot = onSnapshot;
        window.increment = increment;
        window.deleteField = deleteField;

        initApp();

        async function initApp() {
            try {
                await signInAnonymously(auth);
                console.log("Firebase Auth Success");

                const pollRef = doc(db, 'polls', 'poll_0');
                const docSnap = await getDoc(pollRef);
                
                if (!docSnap.exists()) {
                    console.log("Initializing Poll 0...");
                    await setDoc(pollRef, {
                        total: 0,
                        options: [0, 0]
                    });
                }

                const pollCollectionRef = collection(db, 'polls');
                
                onSnapshot(pollCollectionRef, (snapshot) => {
                    snapshot.docChanges().forEach((change) => {
                        if (change.type === "added" || change.type === "modified") {
                            const data = change.doc.data();
                            const pollId = parseInt(change.doc.id.replace('poll_', ''));
                            
                            const localPoll = window.polls.find(p => p.id === pollId);
                            if (localPoll && data.options) {
                                localPoll.options.forEach((opt, idx) => {
                                    if (data.options[idx] !== undefined) {
                                        opt.count = data.options[idx];
                                    }
                                });
                                localPoll.total = data.total || 0;
                                
                                if (window.currentPollId === pollId) {
                                    window.renderDetailContent(localPoll);
                                }
                                window.renderResultList();
                            }
                        }
                    });
                });

            } catch (e) {
                console.error("Firebase Init Error:", e);
            }
        }
    </script>

    <script>
        window.polls = [
            { id: 2, type: 'result', title: "ì—”ì¡°ì´ ì¸ê¸°ê°€ìš”2 ë³¸íˆ¬í‘œ ğŸ†", author: "ì—”ì¡°ì´ ì œì‘ì§„", total: 2, options: [{ text: "ì „ì‹œê¸°", count: 2 }, { text: "í™ë°•ì‚¬", count: 0 }], icon: "ğŸ†", color: "bg-pink-900/40 text-pink-400 border border-pink-800", myPick: null, hasVoted: true },
            { id: 0, type: 'result', title: "ì„¤ë‚ íŠ¹ì„  ì—”ì¡°ì´ ì¸ê¸°ê°€ìš”2 ì‚¬ì „íˆ¬í‘œ ğŸ¤", author: "ì—”ì¡°ì´ ì œì‘ì§„", total: 0, options: [{ text: "ë„ˆì˜ ëª¨ë“  ìˆœê°„", count: 0 }, { text: "í°ìˆ˜ì—¼ ê³ ë˜", count: 0 }], icon: "ğŸ¤", color: "bg-purple-900/40 text-purple-400 border border-purple-800", myPick: null, hasVoted: false },
            { id: 1, type: 'result', title: "ì¸ê¸°ê°€ìš”2 ì•„í‹°ìŠ¤íŠ¸ ì‚¬ì „íˆ¬í‘œ ğŸ‘¨â€ğŸ¤", author: "ì—”ì¡°ì´ ì œì‘ì§„", total: 5, options: [{ text: "ì „ì‹œê¸°", count: 3 }, { text: "í™ë°•ì‚¬", count: 2 }], icon: "ğŸ‘¨â€ğŸ¤", color: "bg-blue-900/40 text-blue-400 border border-blue-800", myPick: null, hasVoted: true }
        ];
        window.currentPollId = null;
        window.selectedOptionIdx = null;

        window.fireConfetti = function(targetCanvasId = 'confetti-canvas') {
            const canvas = document.getElementById(targetCanvasId);
            const ctx = canvas.getContext('2d');
            const parent = canvas.parentElement;
            canvas.width = parent.offsetWidth;
            canvas.height = parent.offsetHeight;
            
            const particles = [];
            const colors = ['#A855F7', '#EC4899', '#3B82F6', '#F59E0B', '#10B981'];
            for(let i=0; i<150; i++) particles.push({ x: canvas.width/2, y: canvas.height*0.25, vx:(Math.random()-0.5)*20, vy:(Math.random()-0.5)*20-5, color:colors[Math.floor(Math.random()*colors.length)], size:Math.random()*6+2, life:150, gravity:0.5 });
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let active = false;
                particles.forEach(p => {
                    if(p.life > 0) { active = true; p.x+=p.vx; p.y+=p.vy; p.vy+=p.gravity; p.life--; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill(); }
                });
                if(active) requestAnimationFrame(animate); else ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            animate();
        };

        window.onload = function() { 
            window.renderResultList(); 
            window.switchTab(1); 
        };

        window.switchTab = function(index) {
            if (index === 0) {
                window.location.href = 'index.html';
                return;
            }
            if (index === 3) { 
                alert('ë‚´ ì •ë³´ ê¸°ëŠ¥ì€ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤.'); 
                return; 
            }
            
            const navBg = document.getElementById('nav-bg');
            navBg.style.transform = `translateX(${index * 60}px)`;

            [0, 1, 2, 3].forEach(i => {
                const btn = document.getElementById(`btn-tab-${i}`);
                if (!btn) return;
                const icon = btn.querySelector('i');
                const text = btn.querySelector('span');
                
                if (i === index) {
                    icon.className = icon.className.replace('text-gray-500', 'text-white');
                    text.className = text.className.replace('font-medium', 'font-bold').replace('text-gray-500', 'text-white');
                } else {
                    icon.className = icon.className.replace('text-white', 'text-gray-500');
                    text.className = text.className.replace('font-bold', 'font-medium').replace('text-white', 'text-gray-500');
                }
            });

            const screenHome = document.getElementById('screen-home');
            const screenPresent = document.getElementById('screen-present');
            
            if (index === 1) {
                if(screenHome) screenHome.classList.add('active');
                if(screenPresent) screenPresent.classList.remove('active');
            } else if (index === 2) {
                if(screenHome) screenHome.classList.remove('active');
                if(screenPresent) screenPresent.classList.add('active');
            }
        };

        window.currentGiftUser = null;

        window.checkGiftLogin = async function() {
            const name = document.getElementById('gift-name-input').value.trim();
            if(name === 'ì „ì‹œê¸°' || name === 'í™ë°•ì‚¬' || name === 'í…ŒìŠ¤íŠ¸') {
                window.currentGiftUser = name;
                document.getElementById('gift-login-area').classList.add('hidden');
                document.getElementById('gift-content-area').classList.remove('hidden');
                if(document.getElementById('gift-settings-area')) document.getElementById('gift-settings-area').classList.add('hidden');
                
                const title = document.getElementById('gift-welcome-title');
                if(name === 'ì „ì‹œê¸°') {
                    title.innerHTML = 'ğŸ¥‡ 1ìœ„ ì „ì‹œê¸° ë‹˜<br>í™˜ì˜í•©ë‹ˆë‹¤!';
                } else if(name === 'í™ë°•ì‚¬') {
                    title.innerHTML = 'ğŸ¥ˆ 2ìœ„ í™ë°•ì‚¬ ë‹˜<br>í™˜ì˜í•©ë‹ˆë‹¤!';
                } else {
                    title.innerHTML = 'ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„ì •<br>í™˜ì˜í•©ë‹ˆë‹¤!';
                }
                
                // ìƒíƒœ ì´ˆê¸°í™” ë° íŒŒì´ì–´ë² ì´ìŠ¤ ì—°ë™ í™•ì¸
                document.getElementById('gift-result-box').classList.add('hidden');
                const btnDraw = document.getElementById('btn-draw-gift');
                btnDraw.disabled = true;
                btnDraw.innerText = "ì •ë³´ í™•ì¸ ì¤‘...";
                
                let savedGift = null;
                try {
                    const docSnap = await window.getDoc(window.doc(window.db, 'gifts', 'results'));
                    if (docSnap.exists()) {
                        savedGift = docSnap.data()[name];
                    }
                } catch(e) {
                    console.error("Firebase fetch error:", e);
                }
                
                if (savedGift && name !== 'í…ŒìŠ¤íŠ¸') {
                    btnDraw.classList.add('hidden');
                    document.getElementById('gift-result-box').classList.remove('hidden');
                    document.getElementById('gift-result-text').innerText = savedGift;
                } else {
                    btnDraw.classList.remove('hidden');
                    btnDraw.disabled = false;
                    btnDraw.innerText = "ì„ ë¬¼ ë½‘ê¸° ğŸ";
                }
                document.getElementById('gift-box-icon').classList.remove('animate-bounce');
                
            } else if (name === 'ì„¤ì •') {
                document.getElementById('gift-login-area').classList.add('hidden');
                document.getElementById('gift-content-area').classList.add('hidden');
                
                const settingsArea = document.getElementById('gift-settings-area');
                if(settingsArea) {
                    settingsArea.classList.remove('hidden');
                    document.getElementById('setting-result-1').innerText = "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
                    document.getElementById('setting-result-2').innerText = "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
                    document.getElementById('setting-result-test').innerText = "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
                    
                    try {
                        const docSnap = await window.getDoc(window.doc(window.db, 'gifts', 'results'));
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            document.getElementById('setting-result-1').innerText = data['ì „ì‹œê¸°'] || 'ë¯¸ì°¸ì—¬';
                            document.getElementById('setting-result-2').innerText = data['í™ë°•ì‚¬'] || 'ë¯¸ì°¸ì—¬';
                            document.getElementById('setting-result-test').innerText = data['í…ŒìŠ¤íŠ¸'] || 'ë¯¸ì°¸ì—¬';
                        } else {
                            document.getElementById('setting-result-1').innerText = 'ë¯¸ì°¸ì—¬';
                            document.getElementById('setting-result-2').innerText = 'ë¯¸ì°¸ì—¬';
                            document.getElementById('setting-result-test').innerText = 'ë¯¸ì°¸ì—¬';
                        }
                    } catch(e) {
                        console.error("Firebase fetch error:", e);
                        document.getElementById('setting-result-1').innerText = 'ì˜¤ë¥˜ ë°œìƒ';
                        document.getElementById('setting-result-2').innerText = 'ì˜¤ë¥˜ ë°œìƒ';
                        document.getElementById('setting-result-test').innerText = 'ì˜¤ë¥˜ ë°œìƒ';
                    }
                }
            } else {
                alert("'ì „ì‹œê¸°', 'í™ë°•ì‚¬', 'í…ŒìŠ¤íŠ¸', 'ì„¤ì •'ë§Œ ì…ë ¥í•´ì•¼ ì…ì¥ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            }
        };

        window.resetGiftCount = async function(name) {
            if(!confirm(`${name} ë‹˜ì˜ ë½‘ê¸° ë‚´ì—­ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                if(window.db && window.auth && window.auth.currentUser) {
                    const giftRef = window.doc(window.db, 'gifts', 'results');
                    const updateData = {};
                    updateData[name] = window.deleteField();
                    
                    await window.updateDoc(giftRef, updateData);
                    localStorage.removeItem('gift_' + name);
                    
                    alert(`${name} ë‹˜ì˜ ë½‘ê¸° ë‚´ì—­ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë‹¤ì‹œ ë½‘ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                    
                    // ì„¤ì • í™”ë©´ì˜ ê²°ê³¼ í…ìŠ¤íŠ¸ ì¦‰ì‹œ 'ë¯¸ì°¸ì—¬'ë¡œ ë°˜ì˜
                    if(name === 'ì „ì‹œê¸°') document.getElementById('setting-result-1').innerText = 'ë¯¸ì°¸ì—¬';
                    if(name === 'í™ë°•ì‚¬') document.getElementById('setting-result-2').innerText = 'ë¯¸ì°¸ì—¬';
                }
            } catch(e) {
                console.error("Reset Error:", e);
                // ë¬¸ì„œê°€ ì—†ëŠ” ë“± ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ë¡œì»¬ ê¸°ë¡ì€ ì‚­ì œí•´ì¤Œ
                localStorage.removeItem('gift_' + name);
                if(name === 'ì „ì‹œê¸°') document.getElementById('setting-result-1').innerText = 'ë¯¸ì°¸ì—¬';
                if(name === 'í™ë°•ì‚¬') document.getElementById('setting-result-2').innerText = 'ë¯¸ì°¸ì—¬';
                alert(`${name} ë‹˜ì˜ ë½‘ê¸° ë‚´ì—­ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        };

        window.drawGift = async function() {
            if (window.currentGiftUser === 'ì „ì‹œê¸°' || window.currentGiftUser === 'í™ë°•ì‚¬') {
                try {
                    const docSnap = await window.getDoc(window.doc(window.db, 'gifts', 'results'));
                    if (docSnap.exists() && docSnap.data()[window.currentGiftUser]) {
                        alert("ì´ë¯¸ ì„ ë¬¼ì„ ë½‘ìœ¼ì…¨ìŠµë‹ˆë‹¤!");
                        const savedGift = docSnap.data()[window.currentGiftUser];
                        document.getElementById('btn-draw-gift').classList.add('hidden');
                        document.getElementById('gift-result-box').classList.remove('hidden');
                        document.getElementById('gift-result-text').innerText = savedGift;
                        return;
                    }
                } catch(e) {
                    console.error("Duplicate check error:", e);
                }
            }

            const baseGifts = [
                'ë°°ë‹¬ì˜ ë¯¼ì¡± {amount} ìƒí’ˆê¶Œ', 'ë‹¤ì´ì†Œ ìƒí’ˆê¶Œ {amount}', 'GS25 í¸ì˜ì  {amount} ìƒí’ˆê¶Œ', 
                'CU {amount}ê¶Œ', 'ì„¸ë¸ì¼ë ˆë¸ {amount}ê¶Œ', 'emart 24 {amount}ê¶Œ', 
                'ì¿ íŒ¡ì´ì¸  {amount}ê¶Œ', 'ìš”ê¸°ìš” {amount}ê¶Œ', 'ì¹´í˜ {amount}ê¶Œ', 
                'ì˜¬ë¦¬ë¸Œì˜ {amount}ê¶Œ', 'ë§¥ë„ë‚ ë“œ {amount}ê¶Œ', 'ì¨ë¸Œì›¨ì´ {amount}ê¶Œ', 
                'ì˜í™”ê´€ ê¸ˆì•¡ê¶Œ {amount}', 'ë§˜ìŠ¤í„°ì¹˜ {amount}ê¶Œ', 'ë¡¯ë°ë¦¬ì•„ {amount}ê¶Œ', 
                'ì„±ì‹¬ë‹¹ {amount}ê¶Œ', 'í–„ë²„ê±° {amount}ê¶Œ', 'ì„±ì›ì´ê°€ ì§ì ‘ê°€ì„œ ë†€ì•„ë“œë¦¼', 'í˜„ê¸ˆ {amount}'
            ];
            
            // ì´ë¦„ì— ë”°ë¼ 1ë§Œì› ë˜ëŠ” 5ì²œì› ë°°ì • (í…ŒìŠ¤íŠ¸ëŠ” 1ë§Œì›)
            const amountStr = (window.currentGiftUser === 'í™ë°•ì‚¬') ? '5ì²œì›' : '1ë§Œì›';
            
            // ëœë¤ìœ¼ë¡œ ì„ ë¬¼ ë½‘ê¸° ë° ê¸ˆì•¡ í…ìŠ¤íŠ¸ ì¹˜í™˜
            let drawnGift = baseGifts[Math.floor(Math.random() * baseGifts.length)];
            drawnGift = drawnGift.replace(/{amount}/g, amountStr);

            const btn = document.getElementById('btn-draw-gift');
            const resultBox = document.getElementById('gift-result-box');
            const resultText = document.getElementById('gift-result-text');
            const boxIcon = document.getElementById('gift-box-icon');
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½ ë° ì• ë‹ˆë©”ì´ì…˜
            btn.disabled = true;
            btn.innerText = "ğŸ ë½‘ëŠ” ì¤‘...";
            boxIcon.classList.add('animate-bounce');

            // íŒŒì´ì–´ë² ì´ìŠ¤ì— ì €ì¥ (merge ì˜µì…˜ìœ¼ë¡œ ê¸°ì¡´ ë°ì´í„° ìœ ì§€)
            try {
                if(window.db && window.auth && window.auth.currentUser) {
                    const giftRef = window.doc(window.db, 'gifts', 'results');
                    await window.setDoc(giftRef, {
                        [window.currentGiftUser]: drawnGift
                    }, { merge: true });
                }
            } catch(e) {
                console.error("Gift Save Error:", e);
            }

            // 1.5ì´ˆ ë’¤ ê²°ê³¼ ë…¸ì¶œ
            setTimeout(() => {
                boxIcon.classList.remove('animate-bounce');
                btn.classList.add('hidden'); // ë½‘ì€ ë’¤ ë²„íŠ¼ ìˆ¨ê¹€ (í•œ ë²ˆë§Œ ë½‘ê¸°)
                resultBox.classList.remove('hidden');
                resultText.innerText = drawnGift;
                window.fireConfetti('confetti-canvas'); // í­ì£½ íš¨ê³¼
            }, 1500);
        };

        window.renderResultList = function() {
            const list = document.getElementById('result-list'); list.innerHTML = '';
            window.polls.filter(p => p.type === 'result').forEach(p => {
                list.innerHTML += `<div class="toss-card p-5 flex items-center justify-between active:scale-[0.98] transition-transform" onclick="window.openPollDetail(${p.id})"><div class="flex items-center gap-4 flex-1 overflow-hidden"><div class="w-12 h-12 rounded-[20px] ${p.color} flex items-center justify-center text-xl shadow-sm shrink-0">${p.icon}</div><div class="overflow-hidden"><h4 class="text-base font-bold text-white leading-tight mb-0.5 truncate pr-2">${p.title}</h4><p class="text-xs text-gray-400 font-medium">${p.total}ëª… ì°¸ì—¬ Â· ì¢…ë£Œë¨</p></div></div><div class="flex items-center gap-1.5 shrink-0 pl-2"><span class="text-xs font-medium text-gray-500">ê²°ê³¼ë³´ê¸°</span><i class="fa-solid fa-chevron-right text-gray-600 text-xs"></i></div></div>`;
            });
        };

        window.openPollDetail = function(id) {
            window.currentPollId = id; window.selectedOptionIdx = null;
            const p = window.polls.find(item => item.id === id);
            document.getElementById('detail-title').innerText = p.title;
            document.getElementById('detail-info').innerText = `ì‘ì„±ì: ${p.author} Â· ${p.total}ëª… ì°¸ì—¬`;
            const badge = document.getElementById('poll-badge');
            if(p.type === 'active') { badge.className = "inline-block px-2 py-1 bg-purple-900/50 text-purple-400 border border-purple-800 text-[10px] font-bold rounded mb-2"; badge.innerText = "ì§„í–‰ì¤‘"; } 
            else { badge.className = "inline-block px-2 py-1 bg-gray-800 text-gray-400 border border-gray-700 text-[10px] font-bold rounded mb-2"; badge.innerText = "ì¢…ë£Œë¨"; }
            window.renderDetailContent(p);
            document.getElementById('modal-detail').classList.add('open');
        };
        window.closeModal = function() { document.getElementById('modal-detail').classList.remove('open'); };

        window.renderDetailContent = function(p) {
            const container = document.getElementById('detail-options');
            const btnSubmit = document.getElementById('btn-submit');
            const resultButtons = document.getElementById('result-buttons');
            
            document.getElementById('detail-info').innerText = `ì‘ì„±ì: ${p.author} Â· ${p.total}ëª… ì°¸ì—¬`;

            container.innerHTML = '';
            const showResult = p.type === 'result' || p.hasVoted;

            if(!showResult) {
                btnSubmit.classList.remove('hidden'); resultButtons.classList.add('hidden'); btnSubmit.disabled = true; btnSubmit.innerText = "íˆ¬í‘œí•˜ê¸°";
                p.options.forEach((opt, idx) => {
                    container.innerHTML += `<label class="block cursor-pointer group active:scale-[0.98] transition-all"><input type="radio" name="v_opt" class="hidden peer" onchange="window.selectOption(${idx})"><div class="p-4 rounded-[20px] bg-gray-800 border border-gray-700 shadow-sm flex items-center justify-between peer-checked:border-purple-500 peer-checked:ring-1 peer-checked:ring-purple-500 peer-checked:bg-purple-900/30 transition-all"><span class="font-bold text-white">${opt.text}</span><div class="w-5 h-5 rounded-full border-2 border-gray-600 peer-checked:border-purple-500 peer-checked:bg-purple-500 flex items-center justify-center"><i class="fa-solid fa-check text-white text-[10px]"></i></div></div></label>`;
                });
            } else {
                btnSubmit.classList.add('hidden');
                if(p.type === 'active' && p.hasVoted) resultButtons.classList.remove('hidden'); 
                else resultButtons.classList.add('hidden');
                
                const max = Math.max(...p.options.map(o => o.count || 0));
                p.options.forEach((opt, idx) => {
                    const count = opt.count || 0;
                    const total = p.total || 0;
                    const pct = total === 0 ? 0 : Math.round((count / total) * 100);
                    
                    const isWin = count === max && max > 0;
                    const isMy = idx === p.myPick;
                    const wrapperClass = isWin ? "rank-1-card p-5 rounded-[24px] mb-4 relative overflow-hidden" : "bg-gray-800 p-4 rounded-[20px] mb-3 border border-gray-700 shadow-sm relative overflow-hidden";
                    const barClass = isWin ? "bar-gradient" : "bg-gray-600";
                    const medal = isWin ? `<span class="ml-2 text-5xl inline-block align-middle drop-shadow-md">ğŸ¥‡</span>` : '';
                    
                    container.innerHTML += `<div class="${wrapperClass}"><div class="flex justify-between items-end mb-2 relative z-10"><div><h4 class="text-base font-bold text-white flex items-center">${opt.text} ${medal} ${isMy ? '<span class="text-[10px] bg-purple-900/50 text-purple-300 px-1.5 py-0.5 rounded font-bold ml-2 self-center border border-purple-800">MY</span>' : ''}</h4><p class="text-xs text-gray-400 font-medium mt-0.5">${count}í‘œ</p></div><div class="text-right"><span class="text-2xl font-bold text-purple-400 number-counting" data-target="${pct}">${pct}</span><span class="text-sm font-bold text-purple-400">%</span></div></div><div class="w-full bg-gray-700/80 rounded-full overflow-hidden relative z-10 ${isWin?'h-3':'h-2'}"><div class="${barClass}" style="width: ${pct}%; height: 100%; transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1); border-radius: 99px;"></div></div></div>`;
                });
            }
        };

        window.selectOption = function(idx) { window.selectedOptionIdx = idx; document.getElementById('btn-submit').disabled = false; };
        
        window.submitVote = async function() {
            if(window.selectedOptionIdx === null) return;
            
            const p = window.polls.find(item => item.id === window.currentPollId);
            
            p.myPick = window.selectedOptionIdx; 
            p.hasVoted = true;
            if(!p.options[window.selectedOptionIdx].count) p.options[window.selectedOptionIdx].count = 0;
            p.options[window.selectedOptionIdx].count++;
            p.total++;

            window.renderDetailContent(p); 

            try {
                if(window.db && window.auth && window.auth.currentUser) {
                    const pollRef = window.doc(window.db, 'polls', 'poll_' + p.id);
                    
                    const updateData = {};
                    updateData[`options.${window.selectedOptionIdx}`] = window.increment(1);
                    updateData['total'] = window.increment(1);
                    
                    await window.updateDoc(pollRef, updateData);
                    console.log("Vote saved!");
                }
            } catch (e) {
                console.error("Vote Error:", e);
                if (e.code === 'not-found') {
                     const pollRef = window.doc(window.db, 'polls', 'poll_' + p.id);
                     await window.setDoc(pollRef, {
                        total: 1,
                        options: { [window.selectedOptionIdx]: 1 }
                     }, { merge: true });
                }
            }
        };

        window.voteAgain = function() {
            const p = window.polls.find(item => item.id === window.currentPollId);
            p.hasVoted = false; p.myPick = null; window.selectedOptionIdx = null; window.renderDetailContent(p);
        };

        window.openCertInput = function() {
            document.getElementById('modal-cert').classList.add('active');
            document.getElementById('cert-step-1').classList.remove('hidden');
            document.getElementById('cert-step-2').classList.add('hidden');
            document.getElementById('cert-name-input').value = '';
            document.getElementById('cert-name-input').focus();
        };

        window.closeCertModal = function() {
            document.getElementById('modal-cert').classList.remove('active');
        };

        window.generateCert = function() {
            const name = document.getElementById('cert-name-input').value.trim();
            if(!name) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
            const p = window.polls.find(item => item.id === window.currentPollId);
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const fullDate = `${year}.${month}.${day} ${hours}:${minutes}`;

            document.getElementById('cert-poll-title').innerText = p.title.replace('ì‚¬ì „íˆ¬í‘œ', '').trim(); 
            document.getElementById('cert-user-name').innerText = name;
            document.getElementById('cert-date').innerText = fullDate;

            document.getElementById('cert-step-1').classList.add('hidden');
            document.getElementById('cert-step-2').classList.remove('hidden');
            setTimeout(() => window.fireConfetti('cert-confetti-canvas'), 200);
        };

        window.saveCertImage = function() {
            const target = document.getElementById('cert-capture-area');
            html2canvas(target, { backgroundColor: null, scale: 2, useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'enjoy-vote-certificate.png';
                link.href = canvas.toDataURL("image/png");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }).catch(err => {
                console.error('ì´ë¯¸ì§€ ì €ì¥ ì‹¤íŒ¨:', err);
                alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        };
    </script>
</body>
</html>