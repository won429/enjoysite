<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Random Enjoy - Toss Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í°íŠ¸ ë° ì•„ì´ì½˜ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @font-face {
            font-family: 'TossFaceFontMac';
            src: url('https://cdn.jsdelivr.net/gh/toss/tossface/dist/tossface-font-mac.css');
        }

        body { 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
            background-color: #F2F4F6;
            color: #191F28;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            touch-action: pan-y;
        }

        /* [ì—…ê·¸ë ˆì´ë“œ] ìœ ë¦¬ ì§ˆê° ì¹´ë“œ (ê·¸ë¦¼ì/ë¸”ëŸ¬ ê°•í™”) */
        .toss-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 26px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06); 
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }
        .toss-card:active {
            transform: scale(0.97);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            filter: brightness(0.98);
        }

        /* ë°°ê²½ ì´ëª¨ì§€ ì• ë‹ˆë©”ì´ì…˜ (index.htmlê³¼ í†µì¼) */
        @keyframes floatEmoji {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }
        .bg-emoji {
            animation: floatEmoji 6s ease-in-out infinite;
            position: fixed;
            z-index: 0;
            pointer-events: none;
            opacity: 0.6;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }

        .fade-in-up { animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        .hidden-screen { display: none !important; }
        .shuffling { opacity: 0.7; transform: scale(0.95); transition: all 0.1s; }

        .pt-safe { padding-top: max(20px, env(safe-area-inset-top)); }
        .pb-safe { padding-bottom: max(20px, env(safe-area-inset-bottom)); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        #nav-indicator { will-change: transform, width; transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), width 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); }
        
        .text-main { color: #191F28; }
        .text-sub { color: #6B7684; }
        .text-blue { color: #3182F6; }
    </style>

    <!-- UI Logic -->
    <script>
        // [ìˆ˜ì •] ë©¤ë²„ ì´ë¦„ ë³€ê²½: ì§€ë…¸ -> ì´ì§„ëˆ„
        const MEMBERS = ['ì „ì‹œê¸°', 'ì˜¤ìŠ¤í‹´', 'ì´ì§„ëˆ„', 'í™ë°•ì‚¬', 'ì„±ì›ì œ', 'ë¥˜ì§±'];
        const TRIP_REGIONS_SIMPLE = ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ëŒ€ì „ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ë¶€ì‚°ê´‘ì—­ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ', 'ê´‘ì£¼ê´‘ì—­ì‹œ', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ'];
        const TRIP_REGIONS_COMPLEX = {
            'ê²½ê¸°ë„': ['ìˆ˜ì›ì‹œ', 'ê³ ì–‘ì‹œ', 'ìš©ì¸ì‹œ', 'ì„±ë‚¨ì‹œ', 'ë¶€ì²œì‹œ', 'í™”ì„±ì‹œ', 'ì•ˆì‚°ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'ì•ˆì–‘ì‹œ', 'í‰íƒì‹œ', 'ì‹œí¥ì‹œ', 'íŒŒì£¼ì‹œ', 'ì˜ì •ë¶€ì‹œ', 'ê¹€í¬ì‹œ', 'ê´‘ì£¼ì‹œ', 'ê´‘ëª…ì‹œ', 'êµ°í¬ì‹œ', 'í•˜ë‚¨ì‹œ', 'ì˜¤ì‚°ì‹œ', 'ì–‘ì£¼ì‹œ', 'ì´ì²œì‹œ', 'êµ¬ë¦¬ì‹œ', 'ì•ˆì„±ì‹œ', 'í¬ì²œì‹œ', 'ì˜ì™•ì‹œ', 'ì–‘í‰êµ°', 'ì—¬ì£¼ì‹œ', 'ë™ë‘ì²œì‹œ', 'ê°€í‰êµ°', 'ê³¼ì²œì‹œ', 'ì—°ì²œêµ°'],
            'ê°•ì›íŠ¹ë³„ìì¹˜ë„': ['ì¶˜ì²œì‹œ', 'ì›ì£¼ì‹œ', 'ê°•ë¦‰ì‹œ', 'ë™í•´ì‹œ', 'íƒœë°±ì‹œ', 'ì†ì´ˆì‹œ', 'ì‚¼ì²™ì‹œ', 'í™ì²œêµ°', 'íš¡ì„±êµ°', 'ì˜ì›”êµ°', 'í‰ì°½êµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°', 'í™”ì²œêµ°', 'ì–‘êµ¬êµ°', 'ì¸ì œêµ°', 'ê³ ì„±êµ°', 'ì–‘ì–‘êµ°'],
            'ì¶©ì²­ë¶ë„': ['ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ', 'ì œì²œì‹œ', 'ë³´ì€êµ°', 'ì˜¥ì²œêµ°', 'ì˜ë™êµ°', 'ì¦í‰êµ°', 'ì§„ì²œêµ°', 'ê´´ì‚°êµ°', 'ìŒì„±êµ°', 'ë‹¨ì–‘êµ°'],
            'ì¶©ì²­ë‚¨ë„': ['ì²œì•ˆì‹œ', 'ê³µì£¼ì‹œ', 'ë³´ë ¹ì‹œ', 'ì•„ì‚°ì‹œ', 'ì„œì‚°ì‹œ', 'ë…¼ì‚°ì‹œ', 'ê³„ë£¡ì‹œ', 'ë‹¹ì§„ì‹œ', 'ê¸ˆì‚°êµ°', 'ë¶€ì—¬êµ°', 'ì„œì²œêµ°', 'ì²­ì–‘êµ°', 'í™ì„±êµ°', 'ì˜ˆì‚°êµ°', 'íƒœì•ˆêµ°'],
            'ì „ë¶íŠ¹ë³„ìì¹˜ë„': ['ì „ì£¼ì‹œ', 'êµ°ì‚°ì‹œ', 'ìµì‚°ì‹œ', 'ì •ìì‹œ', 'ë‚¨ì›ì‹œ', 'ê¹€ì œì‹œ', 'ì™„ì£¼êµ°', 'ì§„ì•ˆêµ°', 'ë¬´ì£¼êµ°', 'ì¥ìˆ˜êµ°', 'ì„ì‹¤êµ°', 'ìˆœì°½êµ°', 'ê³ ì°½êµ°', 'ë¶€ì•ˆêµ°'],
            'ì „ë¼ë‚¨ë„': ['ëª©í¬ì‹œ', 'ì—¬ìˆ˜ì‹œ', 'ìˆœì²œì‹œ', 'ë‚˜ì£¼ì‹œ', 'ê´‘ì–‘ì‹œ', 'ë‹´ì–‘êµ°', 'ê³¡ì„±êµ°', 'êµ¬ë¡€êµ°', 'ê³ í¥êµ°', 'ë³´ì„±êµ°', 'í™”ìˆœêµ°', 'ì¥í¥êµ°', 'ê°•ì§„êµ°', 'í•´ë‚¨êµ°', 'ì˜ì•”êµ°', 'ë¬´ì•ˆêµ°', 'í•¨í‰êµ°', 'ì˜ê´‘êµ°', 'ì¥ì„±êµ°', 'ì™„ë„êµ°', 'ì§„ë„êµ°', 'ì‹ ì•ˆêµ°'],
            'ê²½ìƒë¶ë„': ['í¬í•­ì‹œ', 'ê²½ì£¼ì‹œ', 'ê¹€ì²œì‹œ', 'ì•ˆë™ì‹œ', 'êµ¬ë¯¸ì‹œ', 'ì˜ì£¼ì‹œ', 'ì˜ì²œì‹œ', 'ìƒì£¼ì‹œ', 'ë¬¸ê²½ì‹œ', 'ê²½ì‚°ì‹œ', 'êµ°ìœ„êµ°', 'ì˜ì„±êµ°', 'ì²­ì†¡êµ°', 'ì˜ì–‘êµ°', 'ì˜ë•êµ°', 'ì²­ë„êµ°', 'ê³ ë ¹êµ°', 'ì„±ì£¼êµ°', 'ì¹ ê³¡êµ°', 'ì˜ˆì²œêµ°', 'ë´‰í™”êµ°', 'ìš¸ì§„êµ°', 'ìš¸ë¦‰êµ°'],
            'ê²½ìƒë‚¨ë„': ['ì°½ì›ì‹œ', 'ì§„ì£¼ì‹œ', 'í†µì˜ì‹œ', 'ì‚¬ì²œì‹œ', 'ê¹€í•´ì‹œ', 'ë°€ì–‘ì‹œ', 'ê±°ì œì‹œ', 'ì–‘ì‚°ì‹œ', 'ì˜ë ¹êµ°', 'í•¨ì•ˆêµ°', 'ì°½ë…•êµ°', 'ê³ ì„±êµ°', 'ë‚¨í•´êµ°', 'í•˜ë™êµ°', 'ì‚°ì²­êµ°', 'í•¨ì–‘êµ°', 'ê±°ì°½êµ°', 'í•©ì²œêµ°'],
            'ì œì£¼íŠ¹ë³„ìì¹˜ë„': ['ì œì£¼ì‹œ', 'ì„œê·€í¬ì‹œ']
        };
        const REGION_POOL = [...TRIP_REGIONS_SIMPLE, ...Object.keys(TRIP_REGIONS_COMPLEX)];

        const GREETING_MESSAGES = ["ì˜¤ëŠ˜ ê½ ê±¸ë ¤ë„ ìš¸ì§€ ì•Šê¸°!", "ì œ íƒ“ì€ í•˜ì§€ ë§ˆì„¸ìš”, ìš´ëª…ì…ë‹ˆë‹¤.", "ì†ì— ë•€ ì¢€ ì¥ì–´ë³´ì‹¤ê¹Œìš”?", "ê³¼ì—° ì˜¤ëŠ˜ì€ í–‰ìš´ì˜ ì—¬ì‹ ì´?", "ê²°ê³¼ëŠ” ëƒ‰ì •í•©ë‹ˆë‹¤.", "ë²Œì¹™ ê±¸ë¦´ ê´€ìƒì´ì‹ ë°ìš”?", "ì¸ìƒì€ í•œë°©!", "ì‹¬ì¥ ë¶€ì—¬ì¡ìœ¼ì„¸ìš”.", "ì˜¤ëŠ˜ë”°ë¼ ëŠë‚Œì´ ì„~í•œë°ìš”?", "ë„ë§ì³ë„ ì†Œìš©ì—†ìŠµë‹ˆë‹¤."];

        window.haptic = function() { if (navigator.vibrate) navigator.vibrate(10); }

        document.addEventListener('DOMContentLoaded', () => {
            const greetingEl = document.getElementById('dynamic-greeting');
            if (greetingEl) {
                greetingEl.textContent = GREETING_MESSAGES[Math.floor(Math.random() * GREETING_MESSAGES.length)];
            }
            updateNavState('screen-game-menu');
        });

        function handleGlobalBack() {
            window.haptic();
            window.location.href = 'index.html';
        }

        function switchScreen(screenId) {
            window.haptic();
            if (screenId === 'admin-login') {
                updateNavState('admin-login');
                openAdminLogin();
                return;
            }

            document.querySelectorAll('[id^="screen-"]').forEach(el => {
                el.classList.add('hidden-screen');
                el.classList.remove('flex', 'fade-in-up');
            });
            const target = document.getElementById(screenId);
            target.classList.remove('hidden-screen');
            target.classList.add('flex', 'fade-in-up');
            updateNavState(screenId);
        }

        function updateNavState(screenId) {
            const homeBtn = document.getElementById('nav-btn-home');
            const randomBtn = document.getElementById('nav-btn-random');
            const membersBtn = document.getElementById('nav-btn-members');
            const settingsBtn = document.getElementById('nav-btn-settings');
            const ind = document.getElementById('nav-indicator');
            
            [homeBtn, randomBtn, membersBtn, settingsBtn].forEach(btn => {
                if(btn) {
                    const icon = btn.querySelector('i');
                    const text = btn.querySelector('span');
                    icon.className = icon.className.replace('text-[#191F28]', 'text-[#4E5968]');
                    text.className = text.className.replace('font-bold', 'font-medium').replace('text-[#191F28]', 'text-[#4E5968]');
                }
            });

            let activeBtn = null;

            if (screenId === 'screen-game-menu' || screenId === 'screen-car-game' || screenId === 'screen-chore-game' || screenId === 'screen-trip-game') {
                activeBtn = randomBtn;
            } else if (screenId === 'screen-members') {
                activeBtn = membersBtn;
            } else if (screenId === 'admin-login') {
                activeBtn = settingsBtn;
            }

            if (activeBtn) {
                const icon = activeBtn.querySelector('i');
                const text = activeBtn.querySelector('span');
                icon.className = icon.className.replace('text-[#4E5968]', 'text-[#191F28]');
                text.className = text.className.replace('font-medium', 'font-bold').replace('text-[#4E5968]', 'text-[#191F28]');
                
                ind.style.width = `${activeBtn.offsetWidth}px`;
                ind.style.transform = `translateX(${activeBtn.offsetLeft - 6}px)`;
            }
        }

        // --- Game Logic ---
        let carConfig = 1; let driverMode = 'random'; let selectedDrivers = [];
        window.getCarConfig = () => carConfig;
        window.getDriverMode = () => driverMode;
        window.getSelectedDrivers = () => selectedDrivers;

        window.setCarConfig = (cfg) => {
            window.haptic();
            carConfig = cfg; selectedDrivers = []; 
            updateCarConfigBtn(); window.updateCarView(cfg); window.setDriverMode(driverMode);
        }

        function updateCarConfigBtn() {
            const btn1 = document.getElementById('btn-car-1');
            const btn2 = document.getElementById('btn-car-2');
            if (carConfig === 1) {
                btn1.className = 'flex-1 py-3 rounded-[20px] font-bold text-xs transition-all bg-blue-500 text-white shadow-md';
                btn2.className = 'flex-1 py-3 rounded-[20px] font-bold text-xs transition-all text-gray-400 bg-white hover:bg-gray-50';
            } else {
                btn2.className = 'flex-1 py-3 rounded-[20px] font-bold text-xs transition-all bg-blue-500 text-white shadow-md';
                btn1.className = 'flex-1 py-3 rounded-[20px] font-bold text-xs transition-all text-gray-400 bg-white hover:bg-gray-50';
            }
        }

        window.updateCarView = (cfg) => {
            document.getElementById('view-car-1').classList.toggle('hidden', cfg !== 1);
            document.getElementById('view-car-1').classList.toggle('flex', cfg === 1);
            document.getElementById('view-car-2').classList.toggle('hidden', cfg === 1);
            document.getElementById('view-car-2').classList.toggle('flex', cfg !== 1);
        }

        function getDriverSeatElements() {
            return carConfig === 1 ? [document.getElementById('seat-driver-1')] : [document.getElementById('seat-driver-a'), document.getElementById('seat-driver-b')];
        }

        window.setDriverMode = (mode) => {
            window.haptic();
            driverMode = mode; selectedDrivers = [];
            const btnRandom = document.getElementById('mode-random');
            const btnManual = document.getElementById('mode-manual');
            const selector = document.getElementById('manual-selector');
            const driverSeats = getDriverSeatElements();

            if (mode === 'random') {
                btnRandom.className = 'px-3 py-1.5 rounded-lg bg-white text-black shadow-sm transition-all';
                btnManual.className = 'px-3 py-1.5 rounded-lg text-gray-400 transition-all';
                selector.classList.add('hidden'); selector.classList.remove('flex');
                driverSeats.forEach(seat => { if(seat && seat.textContent === 'ì„ íƒí•„ìš”') { seat.textContent = '?'; seat.style.color = ''; } });
            } else {
                btnManual.className = 'px-3 py-1.5 rounded-lg bg-white text-black shadow-sm transition-all';
                btnRandom.className = 'px-3 py-1.5 rounded-lg text-gray-400 transition-all';
                selector.classList.remove('hidden'); selector.classList.add('flex');
                renderManualSelector();
                driverSeats.forEach(seat => { if(seat && (seat.textContent === '?' || seat.textContent === '...')) { seat.textContent = 'ì„ íƒí•„ìš”'; seat.style.color = '#9CA3AF'; } });
            }
        }

        function renderManualSelector() {
            const container = document.getElementById('manual-selector');
            const max = carConfig === 1 ? 1 : 2;
            container.innerHTML = `<p class="w-full text-xs text-gray-400 mb-2">ìš´ì „ì ${max}ëª…ì„ ì„ íƒí•˜ì„¸ìš”:</p>`;
            MEMBERS.forEach(member => {
                const btn = document.createElement('button');
                const isSelected = selectedDrivers.includes(member);
                btn.className = `px-3 py-1.5 text-xs font-bold rounded-full border transition-all mr-1 mb-1 ${isSelected ? 'bg-blue-500 text-white border-blue-500 shadow-sm' : 'bg-white text-gray-600 border-gray-200'}`;
                btn.textContent = member;
                btn.onclick = () => {
                    window.haptic();
                    if (isSelected) { selectedDrivers = selectedDrivers.filter(m => m !== member); }
                    else { if (selectedDrivers.length < max) selectedDrivers.push(member); else alert(`ìš´ì „ìëŠ” ìµœëŒ€ ${max}ëª…ê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.`); }
                    
                    const driverSeats = getDriverSeatElements();
                    driverSeats.forEach(seat => { if(seat) { seat.textContent = 'ì„ íƒí•„ìš”'; seat.style.color = '#9CA3AF'; }});
                    selectedDrivers.forEach((driver, index) => { if (driverSeats[index]) { driverSeats[index].textContent = driver; driverSeats[index].style.color = '#3182F6'; } });
                    renderManualSelector();
                };
                container.appendChild(btn);
            });
        }

        window.resetCarGameUI = () => { document.querySelectorAll('[id^="seat-"]').forEach(el => { el.textContent = '?'; el.style.color = ''; el.classList.remove('shuffling'); }); }
        window.resetChoreGameUI = () => { document.getElementById('result-cleaning').textContent = '?'; document.getElementById('result-dishes').textContent = '?'; }
        window.resetTripGameUI = () => {
            const el1 = document.getElementById('result-trip-step1');
            const el2 = document.getElementById('result-trip-step2');
            el1.textContent = '?'; el1.style.color = '';
            el2.textContent = '-'; el2.style.color = '';
            document.getElementById('box-trip-step2').className = "toss-card p-8 !bg-white flex flex-col items-center justify-center relative border border-gray-100";
            document.getElementById('label-step2').className = "text-[10px] font-bold text-gray-300 uppercase tracking-widest mb-2";
        }

        window.activateStep2UI = () => {
            // [ìƒ‰ìƒ ë³€ê²½] ì—¬í–‰ 2ë‹¨ê³„ í™œì„±í™” ì‹œ ì˜¤ë Œì§€ í…Œë§ˆ ì ìš©
            document.getElementById('box-trip-step2').className = "toss-card p-8 !bg-orange-50 flex flex-col items-center justify-center relative border border-orange-200";
            document.getElementById('label-step2').className = "text-[10px] font-bold text-orange-600 uppercase tracking-widest mb-2";
        }

        // Sound & Animation
        let audioCtx = null;
        window.initAudio = () => { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); if (audioCtx.state === 'suspended') audioCtx.resume(); }
        window.playWinSound = () => {
            window.initAudio();
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.type = 'sine'; o.frequency.setValueAtTime(659, audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
            g.gain.setValueAtTime(0.3, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.4);
        }
        window.playTickSound = () => {
            window.initAudio();
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.type = 'triangle'; o.frequency.setValueAtTime(200, audioCtx.currentTime);
            g.gain.setValueAtTime(0.2, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.05);
        }

        window.animateShuffle = (el, list, final, dur, cb) => {
            el.classList.add('shuffling');
            let c = 0;
            const i = setInterval(() => { el.textContent = list[Math.floor(Math.random() * list.length)]; c++; if(c%3===0) window.playTickSound(); }, 80);
            setTimeout(() => {
                clearInterval(i); el.textContent = final; el.classList.remove('shuffling');
                if(!cb) { window.playWinSound(); el.style.transform = "scale(1.1)"; setTimeout(() => el.style.transform = "scale(1)", 300); }
                else { cb(); }
            }, dur);
        }
    </script>
</head>
<body class="w-full h-[100dvh] flex flex-col overflow-hidden bg-gradient-to-br from-[#F2F4F6] via-[#E8ECF2] to-[#DEE2E6]" ontouchstart="">

    <!-- ë°°ê²½ ì´ëª¨ì§€ ì œê±°ë¨ -->
    <div id="notification-container" class="absolute top-0 left-0 w-full z-[100] flex flex-col items-center pointer-events-none"></div>

    <!-- ê´€ë¦¬ì ë²„íŠ¼ (ì‚­ì œë¨ - í•˜ë‹¨ ë©”ë‰´ë¡œ ì´ë™) -->

    <!-- 1. ë©”ì¸ ë©”ë‰´ (ë³µë¶ˆë³µ í™”ë©´) -->
    <div id="screen-game-menu" class="flex-1 w-full h-full flex flex-col p-5 pt-safe pb-24 overflow-y-auto no-scrollbar fade-in-up relative z-10">
        <!-- ì¸ì‚¬ë§ -->
        <div class="mt-4 mb-4 px-1">
            <h1 class="text-2xl font-bold text-main leading-snug">
                ì—”ì¡°ì´ ì—¬ëŸ¬ë¶„,<br>
                <span id="dynamic-greeting" class="text-blue-600">í™œê¸°ì°¬ í•˜ë£¨ ë³´ë‚´ì„¸ìš”</span>
            </h1>
        </div>

        <div class="flex flex-col gap-3">
            <!-- [1] ì°¨ëŸ‰ ë°°ì¹˜ (Blue - ê¸°ì¡´ ìœ ì§€) -->
            <div onclick="window.haptic(); switchScreen('screen-car-game');" class="toss-card p-6 !bg-gradient-to-br from-[#E8F3FF] to-[#D6E8FF] border-white/60 h-32 flex items-center justify-between group">
                <div class="relative z-10">
                    <span class="inline-block px-2 py-0.5 bg-white/60 text-[10px] font-bold text-blue-600 rounded-md mb-2 backdrop-blur-sm shadow-sm">BEST</span>
                    <h3 class="text-xl font-bold text-[#1B64DA] leading-tight">ì°¨ëŸ‰ & ìš´ì „ì<br>ë°°ì¹˜í•˜ê¸°</h3>
                </div>
                <div class="w-14 h-14 bg-white/80 rounded-full flex items-center justify-center shadow-sm z-10 text-[#1B64DA] text-2xl group-active:scale-110 transition-transform backdrop-blur-sm">
                    <i class="fa-solid fa-car-side"></i>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <!-- [2] ë‹¹ë²ˆ ë½‘ê¸° (Red -> Emerald ë³€ê²½) -->
                <div onclick="window.haptic(); switchScreen('screen-chore-game');" class="toss-card p-5 !bg-gradient-to-br from-[#E3FAEB] to-[#D1F7DE] border-white/60 h-44 flex flex-col justify-between group">
                    <div class="w-10 h-10 bg-white/80 rounded-xl flex items-center justify-center shadow-sm text-[#00C77D] text-lg group-hover:rotate-12 transition-transform backdrop-blur-sm">
                        <i class="fa-solid fa-broom"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-main mb-1">ë‹¹ë²ˆ ë½‘ê¸°</h3>
                        <p class="text-xs text-[#00C77D]/90 font-medium">ì²­ì†Œì™€ ì„¤ê±°ì§€<br>ì£¼ì¸ê³µì€?</p>
                    </div>
                </div>

                <!-- [3] ì—¬í–‰ì§€ ë½‘ê¸° (Purple -> Orange ë³€ê²½) -->
                <div onclick="window.haptic(); switchScreen('screen-trip-game');" class="toss-card p-5 !bg-gradient-to-br from-[#FFF7ED] to-[#FFEDD5] border-white/60 h-44 flex flex-col justify-between group">
                    <div class="w-10 h-10 bg-white/80 rounded-xl flex items-center justify-center shadow-sm text-[#F97316] text-lg group-hover:scale-110 transition-transform backdrop-blur-sm">
                        <i class="fa-solid fa-plane-departure"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-main mb-1">ì—¬í–‰ì§€ ë½‘ê¸°</h3>
                        <p class="text-xs text-[#F97316]/90 font-medium">ì–´ë””ë¡œ ë– ë‚ ê¹Œìš”?<br>ë‘ê·¼ë‘ê·¼</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ -->
    <div id="screen-members" class="hidden-screen flex-1 w-full h-full flex-col p-5 pt-safe pb-24 overflow-y-auto no-scrollbar fade-in-up relative z-10">
        <h2 class="text-2xl font-bold text-main mb-5 px-1 mt-4">ì—”ì¡°ì´ ë©¤ë²„ë“¤</h2>
        <div class="grid grid-cols-2 gap-3">
            <!-- ì „ì‹œê¸° (íšŒì¥) -->
            <div class="toss-card p-4 flex items-center gap-3 !bg-gradient-to-br from-white to-yellow-50 border-yellow-100 shadow-yellow-100/50">
                <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600 font-bold shrink-0 relative shadow-inner">
                    ì „
                    <span class="absolute -top-1.5 -right-1 text-xs drop-shadow-sm">ğŸ‘‘</span>
                </div>
                <div class="flex flex-col">
                    <span class="font-bold text-main text-sm">ì „ì‹œê¸°</span>
                    <span class="text-[10px] text-yellow-700 font-bold bg-yellow-200/50 px-1.5 py-0.5 rounded-full w-fit mt-0.5">íšŒì¥</span>
                </div>
            </div>
            <!-- ë©¤ë²„ë“¤ -->
            <div class="toss-card p-4 flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 font-bold shrink-0 shadow-inner">ì˜¤</div><span class="font-bold text-main text-sm">ì˜¤ìŠ¤í‹´</span></div>
            <div class="toss-card p-4 flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 font-bold shrink-0 shadow-inner">ì´</div><span class="font-bold text-main text-sm">ì´ì§„ëˆ„</span></div>
            <div class="toss-card p-4 flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold shrink-0 shadow-inner">í™</div><span class="font-bold text-main text-sm">í™ë°•ì‚¬</span></div>
            <div class="toss-card p-4 flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 font-bold shrink-0 shadow-inner">ì„±</div><span class="font-bold text-main text-sm">ì„±ì›ì œ</span></div>
            <div class="toss-card p-4 flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold shrink-0 shadow-inner">ë¥˜</div><span class="font-bold text-main text-sm">ë¥˜ì§±</span></div>
        </div>
        <div class="mt-auto pt-8 text-center"><p class="text-xs text-gray-400 font-medium">Random Enjoy With Members</p></div>
    </div>

    <!-- 3. ì°¨ëŸ‰ ë°°ì¹˜ -->
    <div id="screen-car-game" class="hidden-screen flex-1 w-full h-full flex-col items-center p-5 pt-safe pb-8 overflow-y-auto no-scrollbar relative z-10">
        <h2 class="text-xl font-bold text-main mb-4 mt-4">ì°¨ëŸ‰ ì¢Œì„ ë°°ì¹˜</h2>

        <div class="w-full flex flex-col gap-4">
            <!-- ì„¤ì • ë²„íŠ¼ -->
            <div class="bg-white/50 backdrop-blur-md rounded-[24px] p-1.5 flex gap-1 shadow-sm border border-white/60">
                <button id="btn-car-1" onclick="setCarConfig(1)" class="flex-1 py-3 rounded-[20px] font-bold text-xs transition-all bg-blue-500 text-white shadow-sm">1ëŒ€ (6ì¸ìŠ¹)</button>
                <button id="btn-car-2" onclick="setCarConfig(2)" class="flex-1 py-3 rounded-[20px] font-bold text-xs transition-all text-gray-400 hover:bg-white/50">2ëŒ€ (3ì¸ìŠ¹)</button>
            </div>

            <!-- ì˜µì…˜ ì¹´ë“œ -->
            <div class="toss-card p-5 !bg-white/80 flex flex-col gap-3">
                <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-main">ìš´ì „ì ì„ ì •</span>
                    <div class="bg-gray-100 p-1 rounded-xl flex text-xs font-bold">
                        <button id="mode-random" onclick="setDriverMode('random')" class="px-3 py-1.5 rounded-lg bg-white text-black shadow-sm transition-all">ëœë¤</button>
                        <button id="mode-manual" onclick="setDriverMode('manual')" class="px-3 py-1.5 rounded-lg text-gray-400 transition-all">ìˆ˜ë™</button>
                    </div>
                </div>
                <div id="manual-selector" class="hidden flex-wrap pt-2 border-t border-gray-100"></div>
            </div>

            <!-- ì°¨ëŸ‰ ë·° -->
            <div id="car-view-container" class="w-full">
                <!-- 1ëŒ€ ë·° -->
                <div id="view-car-1" class="toss-card !bg-gradient-to-b from-[#E8F3FF] to-white p-5 flex flex-col justify-between shadow-lg border-2 border-blue-50 aspect-[3/4] mt-2 relative">
                    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-2/3 h-6 bg-white/80 rounded-b-2xl shadow-sm border-b border-l border-r border-blue-100"></div>
                    <!-- ì•ì¢Œì„ -->
                    <div class="flex gap-3 mb-2 mt-4">
                        <div class="w-1/2 aspect-square bg-white rounded-2xl border-2 border-blue-200 flex flex-col items-center justify-center relative shadow-sm">
                            <span class="absolute top-2 left-2 text-[8px] text-blue-600 font-bold bg-blue-50 px-1.5 py-0.5 rounded">DRIVER</span>
                            <div id="seat-driver-1" class="text-lg font-bold text-main">?</div>
                        </div>
                        <div class="w-1/2 aspect-square bg-white/60 rounded-2xl border border-white flex flex-col items-center justify-center relative shadow-sm backdrop-blur-sm">
                            <div id="seat-p-1" class="text-lg font-bold text-main">?</div>
                        </div>
                    </div>
                    <!-- ë’·ì¢Œì„ë“¤ -->
                    <div class="flex gap-3 mb-2">
                        <div class="flex-1 aspect-video bg-white/60 rounded-2xl border border-white flex items-center justify-center shadow-sm backdrop-blur-sm"><div id="seat-m-1" class="text-sm font-bold text-main">?</div></div>
                        <div class="flex-1 aspect-video bg-white/60 rounded-2xl border border-white flex items-center justify-center shadow-sm backdrop-blur-sm"><div id="seat-m-2" class="text-sm font-bold text-main">?</div></div>
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1 aspect-video bg-white/60 rounded-2xl border border-white flex items-center justify-center shadow-sm backdrop-blur-sm"><div id="seat-b-1" class="text-sm font-bold text-main">?</div></div>
                        <div class="flex-1 aspect-video bg-white/60 rounded-2xl border border-white flex items-center justify-center shadow-sm backdrop-blur-sm"><div id="seat-b-2" class="text-sm font-bold text-main">?</div></div>
                    </div>
                </div>

                <!-- 2ëŒ€ ë·° -->
                <div id="view-car-2" class="hidden w-full flex-col gap-4 mt-2">
                    <!-- CAR 1 -->
                    <div class="toss-card !bg-gradient-to-b from-[#E8F3FF] to-white p-4 border-2 border-blue-50 shadow-md">
                        <p class="text-center text-xs font-bold text-blue-400 mb-2">CAR 1</p>
                        <div class="flex gap-2 mb-2">
                            <div class="w-1/2 aspect-square bg-white rounded-2xl border-2 border-blue-200 flex flex-col items-center justify-center relative shadow-sm"><span class="absolute top-1 left-1 text-[8px] text-blue-600 font-bold bg-blue-50 px-1 rounded">DRV</span><div id="seat-driver-a" class="text-sm font-bold text-main">?</div></div>
                            <div class="w-1/2 aspect-square bg-white/60 rounded-2xl border border-white flex flex-col items-center justify-center relative shadow-sm backdrop-blur-sm"><div id="seat-p-a" class="text-sm font-bold text-main">?</div></div>
                        </div>
                        <div class="w-full h-12 bg-white/60 rounded-2xl border border-white flex items-center justify-center shadow-sm backdrop-blur-sm"><div id="seat-b-a" class="text-sm font-bold text-main">?</div></div>
                    </div>
                    <!-- CAR 2 -->
                    <div class="toss-card !bg-gradient-to-b from-[#E8F3FF] to-white p-4 border-2 border-blue-50 shadow-md">
                        <p class="text-center text-xs font-bold text-blue-400 mb-2">CAR 2</p>
                        <div class="flex gap-2 mb-2">
                            <div class="w-1/2 aspect-square bg-white rounded-2xl border-2 border-blue-200 flex flex-col items-center justify-center relative shadow-sm"><span class="absolute top-1 left-1 text-[8px] text-blue-600 font-bold bg-blue-50 px-1 rounded">DRV</span><div id="seat-driver-b" class="text-sm font-bold text-main">?</div></div>
                            <div class="w-1/2 aspect-square bg-white/60 rounded-2xl border border-white flex flex-col items-center justify-center relative shadow-sm backdrop-blur-sm"><div id="seat-p-b" class="text-sm font-bold text-main">?</div></div>
                        </div>
                        <div class="w-full h-12 bg-white/60 rounded-2xl border border-white flex items-center justify-center shadow-sm backdrop-blur-sm"><div id="seat-b-b" class="text-sm font-bold text-main">?</div></div>
                    </div>
                </div>
            </div>

            <button id="btn-run-car" onclick="window.haptic(); requestCarGame()" class="w-full bg-[#3182F6] hover:bg-blue-600 text-white font-bold py-4 rounded-[20px] shadow-lg shadow-blue-500/30 active:scale-95 transition-all mt-4 text-base">ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
        </div>
    </div>

    <!-- 4. ë‹¹ë²ˆ ë½‘ê¸° í™”ë©´ -->
    <div id="screen-chore-game" class="hidden-screen flex-1 w-full h-full flex-col items-center p-5 pt-safe pb-8 overflow-y-auto no-scrollbar relative z-10">
        <h2 class="text-xl font-bold text-main mb-6 mt-4">ë‹¹ë²ˆ ë½‘ê¸°</h2>

        <div class="w-full flex flex-col gap-4 h-full">
            <div class="toss-card p-6 !bg-white flex items-center justify-between shadow-sm">
                <div class="flex flex-col gap-1">
                    <div class="flex items-center gap-1.5 text-blue-500 mb-1"><span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span><span class="text-xs font-bold">CLEANING</span></div>
                    <span class="text-lg font-bold text-main">ì²­ì†Œ ë‹¹ë²ˆ</span>
                </div>
                <div id="result-cleaning" class="h-12 px-5 bg-blue-50 rounded-2xl flex items-center justify-center font-bold text-xl text-blue-600 min-w-[80px] shadow-inner">?</div>
            </div>

            <div class="toss-card p-6 !bg-white flex items-center justify-between shadow-sm">
                <div class="flex flex-col gap-1">
                    <div class="flex items-center gap-1.5 text-green-500 mb-1"><span class="w-1.5 h-1.5 rounded-full bg-green-500"></span><span class="text-xs font-bold">DISHES</span></div>
                    <span class="text-lg font-bold text-main">ì„¤ê±°ì§€ ë‹¹ë²ˆ</span>
                </div>
                <div id="result-dishes" class="h-12 px-5 bg-green-50 rounded-2xl flex items-center justify-center font-bold text-xl text-green-600 min-w-[80px] shadow-inner">?</div>
            </div>

            <div class="mt-auto">
                <button id="btn-run-chore" onclick="window.haptic(); requestChoreGame()" class="w-full bg-[#191F28] text-white font-bold py-4 rounded-[20px] shadow-lg active:scale-95 transition-all text-base">ì¶”ì²¨ ì‹œì‘í•˜ê¸°!</button>
            </div>
        </div>
    </div>

    <!-- 5. ì—¬í–‰ì§€ ë½‘ê¸° í™”ë©´ (ìƒ‰ìƒ ë³€ê²½: Purple -> Orange) -->
    <div id="screen-trip-game" class="hidden-screen flex-1 w-full h-full flex-col items-center p-5 pt-safe pb-8 overflow-y-auto no-scrollbar relative z-10">
        <h2 class="text-xl font-bold text-main mb-6 mt-4">ì—¬í–‰ì§€ ë½‘ê¸°</h2>

        <div class="w-full flex flex-col gap-4">
            <div class="toss-card p-8 !bg-white flex flex-col items-center justify-center relative border border-orange-50 shadow-sm">
                <span class="text-[10px] font-bold text-orange-400 uppercase tracking-widest mb-2 bg-orange-50 px-2 py-0.5 rounded">REGION</span>
                <div id="result-trip-step1" class="text-3xl font-bold text-main break-keep text-center">?</div>
            </div>

            <div class="flex justify-center -my-3 z-10">
                <div class="bg-orange-50 p-2 rounded-full border-4 border-[#F2F4F6] text-orange-300">
                    <i class="fa-solid fa-arrow-down"></i>
                </div>
            </div>

            <div id="box-trip-step2" class="toss-card p-8 !bg-white flex flex-col items-center justify-center relative border border-gray-100 transition-colors duration-300 shadow-sm">
                <span class="text-[10px] font-bold text-gray-300 uppercase tracking-widest mb-2 transition-colors" id="label-step2">DETAIL</span>
                <div id="result-trip-step2" class="text-3xl font-bold text-gray-300 break-keep text-center transition-colors">-</div>
            </div>

            <button id="btn-run-trip" onclick="window.haptic(); requestTripGame()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 rounded-[20px] shadow-lg shadow-orange-200 mt-6 active:scale-95 transition-all text-base">ì—¬í–‰ì§€ í™•ì¸í•˜ê¸°</button>
        </div>
    </div>

    <!-- í•˜ë‹¨ ë©”ë‰´ -->
    <nav id="main-nav" class="fixed bottom-3 left-1/2 -translate-x-1/2 z-50 w-auto touch-pan-x select-none cursor-grab active:cursor-grabbing">
        <div class="flex items-center bg-white/10 backdrop-blur-[4px] backdrop-saturate-[180%] shadow-[0_8px_32px_0_rgba(31,38,135,0.15)] border border-white/20 rounded-full p-1.5 gap-1 ring-1 ring-white/30 relative">
            <div id="nav-indicator" class="absolute top-1 bottom-1 bg-white/50 shadow-[inset_0_1px_1px_rgba(255,255,255,0.8)] rounded-full backdrop-blur-[2px] border border-white/20 z-0 nav-transition" style="left: 6px; width: 64px;"></div>
            
            <button id="nav-btn-home" class="relative px-5 py-2 rounded-full group min-w-[64px] z-10 active:scale-95 transition-transform" onclick="window.haptic(); window.location.href='index.html'">
                <div class="flex flex-col items-center gap-0.5 pointer-events-none">
                    <i class="fa-solid fa-house text-base text-[#191F28] drop-shadow-sm transition-colors"></i>
                    <span class="text-[10px] font-bold text-[#191F28] drop-shadow-sm whitespace-nowrap transition-colors">í™ˆ</span>
                </div>
            </button>

            <button id="nav-btn-random" class="relative px-5 py-2 rounded-full group min-w-[64px] z-10 active:scale-95 transition-transform" onclick="window.haptic(); switchScreen('screen-game-menu')">
                <div class="flex flex-col items-center gap-0.5 pointer-events-none">
                    <i class="fa-solid fa-dice text-base text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm"></i>
                    <span class="text-[10px] font-medium text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm whitespace-nowrap">ë³µë¶ˆë³µ</span>
                </div>
            </button>

            <button id="nav-btn-members" class="relative px-5 py-2 rounded-full group min-w-[64px] z-10 active:scale-95 transition-transform" onclick="window.haptic(); switchScreen('screen-members')">
                <div class="flex flex-col items-center gap-0.5 pointer-events-none">
                    <i class="fa-solid fa-users text-base text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm"></i>
                    <span class="text-[10px] font-medium text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm whitespace-nowrap">ë©¤ë²„</span>
                </div>
            </button>

            <button id="nav-btn-settings" class="relative px-5 py-2 rounded-full group min-w-[64px] z-10 active:scale-95 transition-transform" onclick="window.haptic(); switchScreen('admin-login')">
                <div class="flex flex-col items-center gap-0.5 pointer-events-none">
                    <i class="fa-solid fa-gear text-base text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm"></i>
                    <span class="text-[10px] font-medium text-[#4E5968] group-hover:text-gray-900 transition-colors drop-shadow-sm whitespace-nowrap">ì„¤ì •</span>
                </div>
            </button>
        </div>
    </nav>

    <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ -->
    <div id="modal-admin-login" class="fixed inset-0 z-[60] bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl scale-in text-center">
            <h3 class="text-lg font-bold text-main mb-4">ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
            <input type="password" id="admin-pw" class="w-full bg-gray-50 border border-gray-100 rounded-xl px-4 py-3 text-center text-lg mb-4 focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
            <div class="flex gap-2">
                <button onclick="window.haptic(); closeAdminLogin()" class="flex-1 py-3 bg-gray-100 rounded-xl font-bold text-gray-500 active:bg-gray-200 transition-colors">ì·¨ì†Œ</button>
                <button onclick="window.haptic(); checkAdminPw()" class="flex-1 py-3 bg-blue-500 rounded-xl font-bold text-white shadow-md active:bg-blue-600 transition-colors">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ì íŒ¨ë„ -->
    <div id="modal-admin-panel" class="fixed inset-0 z-[60] bg-black/60 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-3xl p-6 w-full max-w-xs text-center shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-main">ê´€ë¦¬ì ì„¤ì •</h3>
                <button onclick="window.haptic(); closeAdminPanel()" class="text-gray-400 hover:text-gray-600 transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="space-y-4">
                <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 text-left">
                    <p class="text-xs font-bold text-gray-500 mb-2">ê²Œì„ë³„ ì´ˆê¸°í™”</p>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="window.haptic(); adminResetGame('car')" class="py-3 bg-blue-100 text-blue-600 rounded-xl text-xs font-bold hover:bg-blue-200 transition-colors active:scale-95">ì°¨ëŸ‰<br>ì´ˆê¸°í™”</button>
                        <button onclick="window.haptic(); adminResetGame('chore')" class="py-3 bg-red-100 text-red-600 rounded-xl text-xs font-bold hover:bg-red-200 transition-colors active:scale-95">ë‹¹ë²ˆ<br>ì´ˆê¸°í™”</button>
                        <button onclick="window.haptic(); adminResetGame('trip')" class="py-3 bg-purple-100 text-purple-600 rounded-xl text-xs font-bold hover:bg-purple-200 transition-colors active:scale-95">ì—¬í–‰<br>ì´ˆê¸°í™”</button>
                    </div>
                </div>
                <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 text-left flex items-center justify-between">
                    <div>
                        <p class="text-xs font-bold text-gray-500 mb-0.5">ë¬´í•œ ë½‘ê¸° ëª¨ë“œ</p>
                        <p class="text-[10px] text-gray-400">1íšŒ ì œí•œ í•´ì œ</p>
                    </div>
                    <button id="btn-unlimited-toggle" onclick="window.haptic(); adminToggleUnlimited()" class="w-12 h-7 bg-gray-300 rounded-full relative transition-colors"><div class="w-5 h-5 bg-white rounded-full absolute top-1 left-1 transition-transform shadow-sm"></div></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, updateDoc, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB_GKGcBR-MGnhpRz_UbdRIy_iZN9rjNq4",
            authDomain: "random-enjoy.firebaseapp.com",
            projectId: "random-enjoy",
            storageBucket: "random-enjoy.firebasestorage.app",
            messagingSenderId: "337463244854",
            appId: "1:337463244854:web:9972e90fbacb6869a34097"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let globalState = { car: { timestamp: 0 }, chore: { timestamp: 0 }, trip: { timestamp: 0 }, admin: { resets: { car: 0, chore: 0, trip: 0 }, unlimited: false } };
        let localTimestamps = { car: 0, chore: 0, trip: 0 };
        let isFirstLoad = true;

        const setupFirestoreListener = () => {
            const docRef = doc(db, 'games', 'random_enjoy_state');
            onSnapshot(docRef, (snapshot) => {
                if (snapshot.exists()) handleGameStateChange(snapshot.data());
                else setDoc(docRef, globalState, { merge: true });
                isFirstLoad = false;
            }, (error) => console.error("Snapshot error:", error));
        };

        const init = async () => {
            try { await signInAnonymously(auth); onAuthStateChanged(auth, (user) => { if (user) { setupFirestoreListener(); updateButtonVisibility(); } }); } catch (e) { console.error(e); }
        };
        init();

        function handleGameStateChange(newData) {
            globalState = newData;
            updateTopNotifications(newData);
            updateButtonVisibility();
            const adminResets = newData.admin?.resets || { car: 0, chore: 0, trip: 0 };
            
            if (newData.car && newData.car.timestamp === 0) window.resetCarGameUI();
            else if (newData.car && newData.car.timestamp > localTimestamps.car) {
                if (!isFirstLoad) playCarGameAnimation(newData.car); else displayCarResult(newData.car);
                localTimestamps.car = newData.car.timestamp;
            } else if (newData.car) displayCarResult(newData.car);

            if (newData.chore && newData.chore.timestamp === 0) window.resetChoreGameUI();
            else if (newData.chore && newData.chore.timestamp > localTimestamps.chore) {
                if (!isFirstLoad) playChoreGameAnimation(newData.chore); else displayChoreResult(newData.chore);
                localTimestamps.chore = newData.chore.timestamp;
            } else if (newData.chore) displayChoreResult(newData.chore);

            if (newData.trip && newData.trip.timestamp === 0) window.resetTripGameUI();
            else if (newData.trip && newData.trip.timestamp > localTimestamps.trip) {
                if (!isFirstLoad) playTripGameAnimation(newData.trip); else displayTripResult(newData.trip);
                localTimestamps.trip = newData.trip.timestamp;
            } else if (newData.trip) displayTripResult(newData.trip);
        }

        function updateTopNotifications(data) {
            const container = document.getElementById('notification-container');
            const admin = data.admin || { unlimited: false, resets: {} };
            const resets = admin.resets || { car: 0, chore: 0, trip: 0 };

            let unlimitedBanner = document.getElementById('noti-unlimited');
            if (admin.unlimited) {
                if (!unlimitedBanner) { unlimitedBanner = createNotification('noti-unlimited', 'ğŸ”¥ ë¬´í•œ ë½‘ê¸° ëª¨ë“œ í™œì„±í™” ì¤‘!', 'bg-red-500'); container.appendChild(unlimitedBanner); }
            } else { if (unlimitedBanner) unlimitedBanner.remove(); }
            updateUnlimitedUI(admin.unlimited);

            updatePersistentBanner('car', (resets.car || 0) > (data.car?.timestamp || 0), 'ğŸš— ì°¨ëŸ‰ ë°°ì¹˜ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'bg-blue-500');
            updatePersistentBanner('chore', (resets.chore || 0) > (data.chore?.timestamp || 0), 'ğŸ§¹ ë‹¹ë²ˆì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'bg-green-500');
            updatePersistentBanner('trip', (resets.trip || 0) > (data.trip?.timestamp || 0), 'âœˆï¸ ì—¬í–‰ì§€ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'bg-purple-500');
        }

        function updatePersistentBanner(key, shouldShow, msg, color) {
            const container = document.getElementById('notification-container');
            const id = `noti-reset-${key}`;
            let el = document.getElementById(id);
            if (shouldShow) { if (!el) { el = createNotification(id, msg, color); container.appendChild(el); } }
            else { if (el) { el.style.opacity = '0'; el.style.transform = 'translateY(-100%)'; setTimeout(() => { if(el && el.parentNode) el.remove(); }, 300); } }
        }

        function createNotification(id, text, colorClass) {
            const el = document.createElement('div');
            el.id = id;
            el.className = `${colorClass} text-white px-6 py-3 rounded-b-xl shadow-lg flex items-center gap-2 pointer-events-auto mb-2 font-bold text-xs justify-center transition-all duration-300 fade-in-up w-[90%] mx-auto mt-2`;
            el.innerHTML = `<i class="fa-solid fa-bell"></i><span>${text}</span>`;
            return el;
        }

        window.updateButtonVisibility = () => {
            const isUnlimited = globalState.admin?.unlimited;
            const btnCar = document.getElementById('btn-run-car');
            const btnChore = document.getElementById('btn-run-chore');
            const btnTrip = document.getElementById('btn-run-trip');
            if(btnCar) btnCar.style.display = (!isUnlimited && globalState.car?.timestamp > 0) ? 'none' : 'block';
            if(btnChore) btnChore.style.display = (!isUnlimited && globalState.chore?.timestamp > 0) ? 'none' : 'block';
            if(btnTrip) btnTrip.style.display = (!isUnlimited && globalState.trip?.timestamp > 0) ? 'none' : 'block';
        }

        window.openAdminLogin = () => document.getElementById('modal-admin-login').classList.remove('hidden');
        window.closeAdminLogin = () => document.getElementById('modal-admin-login').classList.add('hidden');
        window.checkAdminPw = () => {
            const pw = document.getElementById('admin-pw').value;
            if (pw === '0920') { closeAdminLogin(); document.getElementById('modal-admin-panel').classList.remove('hidden'); document.getElementById('admin-pw').value = ''; }
            else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.'); }
        };
        window.closeAdminPanel = () => document.getElementById('modal-admin-panel').classList.add('hidden');
        
        window.adminResetGame = async (type) => {
            if (!confirm(`${type === 'car' ? 'ì°¨ëŸ‰' : type === 'chore' ? 'ë‹¹ë²ˆ' : 'ì—¬í–‰'} ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            try { await updateDoc(doc(db, 'games', 'random_enjoy_state'), { [`admin.resets.${type}`]: Date.now(), [type]: { timestamp: 0 } }); closeAdminPanel(); } catch (e) { alert("ì´ˆê¸°í™” ì‹¤íŒ¨: " + e.message); }
        };

        window.adminToggleUnlimited = async () => {
            try { await updateDoc(doc(db, 'games', 'random_enjoy_state'), { 'admin.unlimited': !globalState.admin?.unlimited }); } catch (e) { alert("ì„¤ì • ë³€ê²½ ì‹¤íŒ¨: " + e.message); }
        };
        
        function updateUnlimitedUI(isUnlimited) {
            const btn = document.getElementById('btn-unlimited-toggle');
            const dot = btn.querySelector('div');
            if (isUnlimited) { btn.classList.replace('bg-gray-300', 'bg-green-500'); dot.classList.replace('left-1', 'translate-x-5'); }
            else { btn.classList.replace('bg-green-500', 'bg-gray-300'); dot.classList.replace('translate-x-5', 'left-1'); }
        }
        function canPlay(gameType) {
            if (globalState.admin?.unlimited) return true; 
            if (globalState[gameType]?.timestamp > 0) { alert('ì´ë¯¸ ê²°ê³¼ê°€ ë‚˜ì™€ìˆìŠµë‹ˆë‹¤!'); return false; }
            return true;
        }

        window.requestCarGame = async () => {
            if (!canPlay('car')) return;
            if (driverMode === 'manual') {
                if (carConfig === 1 && selectedDrivers.length !== 1) { alert('ìš´ì „ì 1ëª…ì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
                if (carConfig === 2 && selectedDrivers.length !== 2) { alert('ìš´ì „ì 2ëª…ì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
            }
            let finalDrivers = driverMode === 'manual' ? [...selectedDrivers] : (carConfig === 1 ? [[...MEMBERS].sort(() => Math.random()-0.5)[0]] : [...MEMBERS].sort(() => Math.random()-0.5).slice(0,2));
            let passengers = MEMBERS.filter(m => !finalDrivers.includes(m)).sort(() => Math.random() - 0.5);
            await setDoc(doc(db, 'games', 'random_enjoy_state'), { car: { config: carConfig, drivers: finalDrivers, passengers: passengers, timestamp: Date.now() } }, { merge: true });
        };

        window.requestChoreGame = async () => {
            if (!canPlay('chore')) return;
            const shuffled = [...MEMBERS].sort(() => Math.random() - 0.5);
            await setDoc(doc(db, 'games', 'random_enjoy_state'), { chore: { cleaner: shuffled[0], dishwasher: shuffled[1], timestamp: Date.now() } }, { merge: true });
        };

        window.requestTripGame = async () => {
            if (!canPlay('trip')) return;
            const step1 = REGION_POOL[Math.floor(Math.random() * REGION_POOL.length)];
            const sub = TRIP_REGIONS_COMPLEX[step1];
            await setDoc(doc(db, 'games', 'random_enjoy_state'), { trip: { step1: step1, step2: sub ? sub[Math.floor(Math.random()*sub.length)] : null, timestamp: Date.now() } }, { merge: true });
        };

        function playCarGameAnimation(data) {
            window.initAudio(); window.updateCarView(data.config || 1); 
            if (data.config === 1) {
                window.animateShuffle(document.getElementById('seat-driver-1'), MEMBERS, data.drivers[0], 2000);
                ['seat-p-1', 'seat-m-1', 'seat-m-2', 'seat-b-1', 'seat-b-2'].forEach((id, i) => { if(data.passengers[i]) window.animateShuffle(document.getElementById(id), MEMBERS, data.passengers[i], 2000 + (i * 300)); });
            } else {
                window.animateShuffle(document.getElementById('seat-driver-a'), MEMBERS, data.drivers[0], 2000);
                window.animateShuffle(document.getElementById('seat-driver-b'), MEMBERS, data.drivers[1], 2000);
                ['seat-p-a', 'seat-b-a', 'seat-p-b', 'seat-b-b'].forEach((id, i) => { if(data.passengers[i]) window.animateShuffle(document.getElementById(id), MEMBERS, data.passengers[i], 2000 + (i * 300)); });
            }
        }
        function displayCarResult(data) {
            window.updateCarView(data.config || 1);
            if(data.config === 1) {
                if(data.drivers) document.getElementById('seat-driver-1').textContent = data.drivers[0];
                ['seat-p-1', 'seat-m-1', 'seat-m-2', 'seat-b-1', 'seat-b-2'].forEach((id, i) => { if(data.passengers && data.passengers[i]) document.getElementById(id).textContent = data.passengers[i]; });
            } else {
                if(data.drivers) { document.getElementById('seat-driver-a').textContent = data.drivers[0]; document.getElementById('seat-driver-b').textContent = data.drivers[1]; }
                ['seat-p-a', 'seat-b-a', 'seat-p-b', 'seat-b-b'].forEach((id, i) => { if(data.passengers && data.passengers[i]) document.getElementById(id).textContent = data.passengers[i]; });
            }
            document.querySelectorAll('[id^="seat-"]').forEach(el => el.style.color = '#3182ce');
        }

        function playChoreGameAnimation(data) { window.initAudio(); window.animateShuffle(document.getElementById('result-cleaning'), MEMBERS, data.cleaner, 1500); window.animateShuffle(document.getElementById('result-dishes'), MEMBERS, data.dishwasher, 2500); }
        function displayChoreResult(data) {
            if(!data.cleaner) return;
            const c = document.getElementById('result-cleaning'); const d = document.getElementById('result-dishes');
            c.textContent = data.cleaner; d.textContent = data.dishwasher; c.style.color = "#2563eb"; d.style.color = "#16a34a";
        }

        function playTripGameAnimation(data) {
            window.initAudio(); window.resetTripGameUI();
            const el2 = document.getElementById('result-trip-step2');
            window.animateShuffleCallback(document.getElementById('result-trip-step1'), REGION_POOL, data.step1, 2000, () => {
                if (data.step2) { setTimeout(() => { window.activateStep2UI(); window.animateShuffleCallback(el2, TRIP_REGIONS_COMPLEX[data.step1], data.step2, 2000, () => window.playWinSound()); }, 300); }
                else { el2.textContent = "í•´ë‹¹ ì—†ìŒ"; window.playWinSound(); }
            });
        }
        function displayTripResult(data) {
            if(!data.step1) return;
            window.resetTripGameUI();
            const el1 = document.getElementById('result-trip-step1'); el1.textContent = data.step1; el1.style.color = "#F97316"; // [ìˆ˜ì •] ì˜¤ë Œì§€ ìƒ‰ìƒ
            if (data.step2) { window.activateStep2UI(); const el2 = document.getElementById('result-trip-step2'); el2.textContent = data.step2; el2.style.color = "#F97316"; // [ìˆ˜ì •] ì˜¤ë Œì§€ ìƒ‰ìƒ
            }
            else document.getElementById('result-trip-step2').textContent = "í•´ë‹¹ ì—†ìŒ";
        }
    </script>
</body>
</html>