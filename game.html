<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Random Enjoy - Life</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í°íŠ¸ ì¶”ê°€ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonts-archive/HakgyoansimDunggeunmiso/HakgyoansimDunggeunmiso.css" type="text/css"/>
    
    <style>
        @font-face {
            font-family: 'Pretendard-Bold';
            src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Bold.woff') format('woff');
            font-weight: 700;
            font-style: normal;
        }

        body { 
            font-family: 'Pretendard-Bold', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background-color: #F2F4F6;
            -webkit-tap-highlight-color: transparent;
            color: #191F28;
            overscroll-behavior-y: none;
        }

        .btn-scale { transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-scale:active { transform: scale(0.96); }

        .fade-in { animation: fadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .hidden-screen { display: none; }
        .shuffling { opacity: 0.7; }

        .slide-down { animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .slide-up { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
        @keyframes slideUp { from { transform: translateY(0); } to { transform: translateY(-100%); } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .glass-nav {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .mobile-container {
            max-width: 480px;
            margin: 0 auto;
            width: 100%;
            height: 100%;
        }
    </style>

    <!-- [UI Helper Script] -->
    <script>
        const MEMBERS = ['ì „ì‹œê¸°', 'ì˜¤ìŠ¤í‹´', 'ì§€ë…¸', 'í™ë°•ì‚¬', 'ì„±ì›ì œ', 'ë¥˜ì§±'];
        const TRIP_REGIONS_SIMPLE = ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ëŒ€ì „ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ë¶€ì‚°ê´‘ì—­ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ', 'ê´‘ì£¼ê´‘ì—­ì‹œ', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ'];
        const TRIP_REGIONS_COMPLEX = {
            'ê²½ê¸°ë„': ['ìˆ˜ì›ì‹œ', 'ê³ ì–‘ì‹œ', 'ìš©ì¸ì‹œ', 'ì„±ë‚¨ì‹œ', 'ë¶€ì²œì‹œ', 'í™”ì„±ì‹œ', 'ì•ˆì‚°ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'ì•ˆì–‘ì‹œ', 'í‰íƒì‹œ', 'ì‹œí¥ì‹œ', 'íŒŒì£¼ì‹œ', 'ì˜ì •ë¶€ì‹œ', 'ê¹€í¬ì‹œ', 'ê´‘ì£¼ì‹œ', 'ê´‘ëª…ì‹œ', 'êµ°í¬ì‹œ', 'í•˜ë‚¨ì‹œ', 'ì˜¤ì‚°ì‹œ', 'ì–‘ì£¼ì‹œ', 'ì´ì²œì‹œ', 'êµ¬ë¦¬ì‹œ', 'ì•ˆì„±ì‹œ', 'í¬ì²œì‹œ', 'ì˜ì™•ì‹œ', 'ì–‘í‰êµ°', 'ì—¬ì£¼ì‹œ', 'ë™ë‘ì²œì‹œ', 'ê°€í‰êµ°', 'ê³¼ì²œì‹œ', 'ì—°ì²œêµ°'],
            'ê°•ì›íŠ¹ë³„ìì¹˜ë„': ['ì¶˜ì²œì‹œ', 'ì›ì£¼ì‹œ', 'ê°•ë¦‰ì‹œ', 'ë™í•´ì‹œ', 'íƒœë°±ì‹œ', 'ì†ì´ˆì‹œ', 'ì‚¼ì²™ì‹œ', 'í™ì²œêµ°', 'íš¡ì„±êµ°', 'ì˜ì›”êµ°', 'í‰ì°½êµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°', 'í™”ì²œêµ°', 'ì–‘êµ¬êµ°', 'ì¸ì œêµ°', 'ê³ ì„±êµ°', 'ì–‘ì–‘êµ°'],
            'ì¶©ì²­ë¶ë„': ['ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ', 'ì œì²œì‹œ', 'ë³´ì€êµ°', 'ì˜¥ì²œêµ°', 'ì˜ë™êµ°', 'ì¦í‰êµ°', 'ì§„ì²œêµ°', 'ê´´ì‚°êµ°', 'ìŒì„±êµ°', 'ë‹¨ì–‘êµ°'],
            'ì¶©ì²­ë‚¨ë„': ['ì²œì•ˆì‹œ', 'ê³µì£¼ì‹œ', 'ë³´ë ¹ì‹œ', 'ì•„ì‚°ì‹œ', 'ì„œì‚°ì‹œ', 'ë…¼ì‚°ì‹œ', 'ê³„ë£¡ì‹œ', 'ë‹¹ì§„ì‹œ', 'ê¸ˆì‚°êµ°', 'ë¶€ì—¬êµ°', 'ì„œì²œêµ°', 'ì²­ì–‘êµ°', 'í™ì„±êµ°', 'ì˜ˆì‚°êµ°', 'íƒœì•ˆêµ°'],
            'ì „ë¶íŠ¹ë³„ìì¹˜ë„': ['ì „ì£¼ì‹œ', 'êµ°ì‚°ì‹œ', 'ìµì‚°ì‹œ', 'ì •ìì‹œ', 'ë‚¨ì›ì‹œ', 'ê¹€ì œì‹œ', 'ì™„ì£¼êµ°', 'ì§„ì•ˆêµ°', 'ë¬´ì£¼êµ°', 'ì¥ìˆ˜êµ°', 'ì„ì‹¤êµ°', 'ìˆœì°½êµ°', 'ê³ ì°½êµ°', 'ë¶€ì•ˆêµ°'],
            'ì „ë¼ë‚¨ë„': ['ëª©í¬ì‹œ', 'ì—¬ìˆ˜ì‹œ', 'ìˆœì²œì‹œ', 'ë‚˜ì£¼ì‹œ', 'ê´‘ì–‘ì‹œ', 'ë‹´ì–‘êµ°', 'ê³¡ì„±êµ°', 'êµ¬ë¡€êµ°', 'ê³ í¥êµ°', 'ë³´ì„±êµ°', 'í™”ìˆœêµ°', 'ì¥í¥êµ°', 'ê°•ì§„êµ°', 'í•´ë‚¨êµ°', 'ì˜ì•”êµ°', 'ë¬´ì•ˆêµ°', 'í•¨í‰êµ°', 'ì˜ê´‘êµ°', 'ì¥ì„±êµ°', 'ì™„ë„êµ°', 'ì§„ë„êµ°', 'ì‹ ì•ˆêµ°'],
            'ê²½ìƒë¶ë„': ['í¬í•­ì‹œ', 'ê²½ì£¼ì‹œ', 'ê¹€ì²œì‹œ', 'ì•ˆë™ì‹œ', 'êµ¬ë¯¸ì‹œ', 'ì˜ì£¼ì‹œ', 'ì˜ì²œì‹œ', 'ìƒì£¼ì‹œ', 'ë¬¸ê²½ì‹œ', 'ê²½ì‚°ì‹œ', 'êµ°ìœ„êµ°', 'ì˜ì„±êµ°', 'ì²­ì†¡êµ°', 'ì˜ì–‘êµ°', 'ì˜ë•êµ°', 'ì²­ë„êµ°', 'ê³ ë ¹êµ°', 'ì„±ì£¼êµ°', 'ì¹ ê³¡êµ°', 'ì˜ˆì²œêµ°', 'ë´‰í™”êµ°', 'ìš¸ì§„êµ°', 'ìš¸ë¦‰êµ°'],
            'ê²½ìƒë‚¨ë„': ['ì°½ì›ì‹œ', 'ì§„ì£¼ì‹œ', 'í†µì˜ì‹œ', 'ì‚¬ì²œì‹œ', 'ê¹€í•´ì‹œ', 'ë°€ì–‘ì‹œ', 'ê±°ì œì‹œ', 'ì–‘ì‚°ì‹œ', 'ì˜ë ¹êµ°', 'í•¨ì•ˆêµ°', 'ì°½ë…•êµ°', 'ê³ ì„±êµ°', 'ë‚¨í•´êµ°', 'í•˜ë™êµ°', 'ì‚°ì²­êµ°', 'í•¨ì–‘êµ°', 'ê±°ì°½êµ°', 'í•©ì²œêµ°'],
            'ì œì£¼íŠ¹ë³„ìì¹˜ë„': ['ì œì£¼ì‹œ', 'ì„œê·€í¬ì‹œ']
        };
        const REGION_POOL = [...TRIP_REGIONS_SIMPLE, ...Object.keys(TRIP_REGIONS_COMPLEX)];

        const GREETING_MESSAGES = [
            "ì˜¤ëŠ˜ ê½ ê±¸ë ¤ë„ ìš¸ì§€ ì•Šê¸°!",
            "ì œ íƒ“ì€ í•˜ì§€ ë§ˆì„¸ìš”, ìš´ëª…ì…ë‹ˆë‹¤.",
            "ì†ì— ë•€ ì¢€ ì¥ì–´ë³´ì‹¤ê¹Œìš”?",
            "ê³¼ì—° ì˜¤ëŠ˜ì€ í–‰ìš´ì˜ ì—¬ì‹ ì´?",
            "ê²°ê³¼ëŠ” ëƒ‰ì •í•©ë‹ˆë‹¤. ë°›ì•„ë“¤ì´ì„¸ìš”.",
            "ë²Œì¹™ ê±¸ë¦´ ê´€ìƒì´ì‹ ë°ìš”?",
            "ì¸ìƒì€ í•œë°©! ì—¬ê¸°ì„œ í„°ì§ˆê¹Œìš”?",
            "ì‹¬ì¥ ë¶€ì—¬ì¡ê³  ê²°ê³¼ í™•ì¸í•˜ì„¸ìš”.",
            "ì˜¤ëŠ˜ë”°ë¼ ëŠë‚Œì´ ì„~í•œë°ìš”?",
            "ë„ë§ì³ë„ ì†Œìš©ì—†ìŠµë‹ˆë‹¤."
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const greetingEl = document.getElementById('dynamic-greeting');
            if (greetingEl) {
                const randomMsg = GREETING_MESSAGES[Math.floor(Math.random() * GREETING_MESSAGES.length)];
                greetingEl.textContent = randomMsg;
            }
        });

        function handleGlobalBack() {
            const home = document.getElementById('screen-game-menu');
            if (!home.classList.contains('hidden-screen')) {
                 // í™ˆ í™”ë©´ì¼ ë•Œ: index.htmlë¡œ ì´ë™ (ë©”ì¸ ì‚¬ì´íŠ¸ë¡œ ì—°ê²°)
                 window.location.href = 'index.html';
            } else {
                 // ê²Œì„ í™”ë©´ì¼ ë•Œ: í™ˆìœ¼ë¡œ ì´ë™
                 switchScreen('screen-game-menu');
            }
        }

        function switchScreen(screenId) {
            document.querySelectorAll('[id^="screen-"]').forEach(el => {
                el.classList.add('hidden-screen');
                el.classList.remove('flex', 'fade-in');
            });
            const target = document.getElementById(screenId);
            target.classList.remove('hidden-screen');
            target.classList.add('flex', 'fade-in');

            updateNavState(screenId);
        }

        function updateNavState(screenId) {
            const navHome = document.getElementById('nav-home');
            const navMembers = document.getElementById('nav-members');
            const mainNav = document.getElementById('main-nav'); // í•˜ë‹¨ ë©”ë‰´ ì»¨í…Œì´ë„ˆ
            
            navHome.classList.replace('opacity-100', 'opacity-40');
            navMembers.classList.replace('opacity-100', 'opacity-40');

            // í•˜ë‹¨ ë©”ë‰´ í‘œì‹œ ì¡°ê±´: í™ˆ ë˜ëŠ” ë©¤ë²„ í™”ë©´ì¼ ë•Œë§Œ í‘œì‹œ
            if (screenId === 'screen-game-menu') {
                navHome.classList.replace('opacity-40', 'opacity-100');
                mainNav.classList.remove('hidden');
            } else if (screenId === 'screen-members') {
                navMembers.classList.replace('opacity-40', 'opacity-100');
                mainNav.classList.remove('hidden');
            } else {
                // ê²Œì„ í™”ë©´ ë“±ì—ì„œëŠ” ìˆ¨ê¹€
                mainNav.classList.add('hidden');
            }
        }

        // --- Car Game UI Logic ---
        let carConfig = 1; 
        let driverMode = 'random';
        let selectedDrivers = [];

        window.getCarConfig = () => carConfig;
        window.getDriverMode = () => driverMode;
        window.getSelectedDrivers = () => selectedDrivers;

        window.setCarConfig = (cfg) => {
            carConfig = cfg;
            selectedDrivers = []; 
            updateCarConfigBtn();
            window.updateCarView(cfg);
            window.setDriverMode(driverMode);
        }

        function updateCarConfigBtn() {
            const btn1 = document.getElementById('btn-car-1');
            const btn2 = document.getElementById('btn-car-2');
            
            const activeClasses = ['bg-blue-600', 'text-white', 'border-blue-600', 'shadow-md'];
            const inactiveClasses = ['bg-white', 'text-gray-400', 'border-gray-200', 'hover:bg-gray-50'];

            if (carConfig === 1) {
                btn1.classList.add(...activeClasses);
                btn1.classList.remove(...inactiveClasses.filter(c => !c.startsWith('hover')));
                btn2.classList.add(...inactiveClasses);
                btn2.classList.remove(...activeClasses);
            } else {
                btn2.classList.add(...activeClasses);
                btn2.classList.remove(...inactiveClasses.filter(c => !c.startsWith('hover')));
                btn1.classList.add(...inactiveClasses);
                btn1.classList.remove(...activeClasses);
            }
        }

        window.updateCarView = (cfg) => {
            const view1 = document.getElementById('view-car-1');
            const view2 = document.getElementById('view-car-2');
            if (cfg === 1) {
                view1.classList.remove('hidden'); view1.classList.add('flex');
                view2.classList.add('hidden'); view2.classList.remove('flex');
            } else {
                view1.classList.add('hidden'); view1.classList.remove('flex');
                view2.classList.remove('hidden'); view2.classList.add('flex');
            }
        }

        function getDriverSeatElements() {
            if (carConfig === 1) {
                return [document.getElementById('seat-driver-1')];
            } else {
                return [document.getElementById('seat-driver-a'), document.getElementById('seat-driver-b')];
            }
        }

        window.setDriverMode = (mode) => {
            driverMode = mode;
            selectedDrivers = [];
            const btnRandom = document.getElementById('mode-random');
            const btnManual = document.getElementById('mode-manual');
            const selector = document.getElementById('manual-selector');
            const driverSeats = getDriverSeatElements();

            if (mode === 'random') {
                btnRandom.classList.replace('text-gray-400', 'bg-white'); btnRandom.classList.add('text-black', 'shadow-sm');
                btnManual.classList.remove('bg-white', 'text-black', 'shadow-sm'); btnManual.classList.add('text-gray-400');
                selector.classList.add('hidden'); selector.classList.remove('flex');
                
                driverSeats.forEach(seat => {
                    if(seat && seat.textContent === 'ì„ íƒí•„ìš”') {
                        seat.textContent = '?';
                        seat.style.color = '';
                    }
                });
            } else {
                btnManual.classList.replace('text-gray-400', 'bg-white'); btnManual.classList.add('text-black', 'shadow-sm');
                btnRandom.classList.remove('bg-white', 'text-black', 'shadow-sm'); btnRandom.classList.add('text-gray-400');
                selector.classList.remove('hidden'); selector.classList.add('flex');
                renderManualSelector();
                
                driverSeats.forEach(seat => {
                    if(seat && (seat.textContent === '?' || seat.textContent === '...')) {
                        seat.textContent = 'ì„ íƒí•„ìš”';
                        seat.style.color = 'gray';
                    }
                });
            }
        }

        function renderManualSelector() {
            const container = document.getElementById('manual-selector');
            const max = carConfig === 1 ? 1 : 2;
            container.innerHTML = `<p class="w-full text-xs text-gray-400 mb-2">ìš´ì „ì ${max}ëª…ì„ ì„ íƒí•˜ì„¸ìš”:</p>`;
            MEMBERS.forEach(member => {
                const btn = document.createElement('button');
                const isSelected = selectedDrivers.includes(member);
                btn.className = `px-3 py-1.5 text-sm rounded-full border transition-all mr-1 mb-1 ${isSelected ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-600 border-gray-200 hover:border-blue-300'}`;
                btn.textContent = member;
                btn.onclick = () => {
                    if (isSelected) {
                        selectedDrivers = selectedDrivers.filter(m => m !== member);
                    } else {
                        if (selectedDrivers.length < max) selectedDrivers.push(member);
                        else alert(`ìš´ì „ìëŠ” ìµœëŒ€ ${max}ëª…ê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
                    }
                    
                    const driverSeats = getDriverSeatElements();
                    driverSeats.forEach(seat => { if(seat) { seat.textContent = 'ì„ íƒí•„ìš”'; seat.style.color = 'gray'; }});
                    
                    selectedDrivers.forEach((driver, index) => {
                        if (driverSeats[index]) {
                            driverSeats[index].textContent = driver;
                            driverSeats[index].style.color = '#3182ce';
                        }
                    });

                    renderManualSelector();
                };
                container.appendChild(btn);
            });
        }

        // --- Reset UI Functions ---
        window.resetCarGameUI = () => {
            const seats = document.querySelectorAll('[id^="seat-"]');
            seats.forEach(el => { el.textContent = '?'; el.style.color = ''; el.classList.remove('shuffling'); });
        }

        window.resetChoreGameUI = () => {
            document.getElementById('result-cleaning').textContent = '?'; document.getElementById('result-cleaning').style.color = '';
            document.getElementById('result-dishes').textContent = '?'; document.getElementById('result-dishes').style.color = '';
        }

        window.resetTripGameUI = () => {
            const el1 = document.getElementById('result-trip-step1');
            const el2 = document.getElementById('result-trip-step2');
            
            if (el1) { el1.textContent = '?'; el1.style.color = ''; el1.classList.remove('shuffling'); }
            if (el2) { el2.textContent = '-'; el2.style.color = ''; el2.classList.remove('shuffling'); }
            
            const box2 = document.getElementById('box-trip-step2');
            const label2 = document.getElementById('label-step2');
            
            if (box2) { box2.classList.replace('border-purple-200', 'border-gray-100'); box2.classList.replace('bg-purple-50', 'bg-white'); }
            if (label2) { label2.classList.replace('text-purple-600', 'text-gray-400'); }
        }

        window.activateStep2UI = () => {
            const box2 = document.getElementById('box-trip-step2');
            const text2 = document.getElementById('result-trip-step2');
            const label2 = document.getElementById('label-step2');
            
            if (box2) { box2.classList.replace('border-gray-100', 'border-purple-200'); box2.classList.replace('bg-white', 'bg-purple-50'); }
            if (text2) { text2.classList.replace('text-gray-300', 'text-gray-900'); }
            if (label2) { label2.classList.replace('text-gray-400', 'text-purple-600'); }
        }

        // --- Sound & Animations ---
        let audioCtx = null;
        window.initAudio = () => { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); if (audioCtx.state === 'suspended') audioCtx.resume(); }
        
        window.playWinSound = () => {
            window.initAudio();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(659, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(3.0, audioCtx.currentTime); 
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.4);
        }
        
        window.playTickSound = () => {
            window.initAudio();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(1.0, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.05);
        }

        window.animateShuffle = (element, candidates, finalValue, duration) => window.animateShuffleCallback(element, candidates, finalValue, duration, null);
        
        window.animateShuffleCallback = (element, candidates, finalValue, duration, callback) => {
            element.classList.add('shuffling');
            let tickCount = 0;
            const interval = setInterval(() => {
                const randomVal = candidates[Math.floor(Math.random() * candidates.length)];
                element.textContent = randomVal;
                tickCount++;
                if(tickCount % 3 === 0) window.playTickSound(); 
            }, 80); 

            setTimeout(() => {
                clearInterval(interval);
                element.textContent = finalValue;
                element.classList.remove('shuffling');
                
                if (!callback) {
                    window.playWinSound();
                    element.style.transform = "scale(1.1)";
                    if(element.id.includes('cleaning')) element.style.color = "#2563eb"; 
                    else if(element.id.includes('dishes')) element.style.color = "#16a34a"; 
                    else if(element.id.includes('seat')) element.style.color = "#3182ce"; 
                    else if(element.id.includes('trip')) element.style.color = "#9333ea";
                    setTimeout(() => { element.style.transform = "scale(1)"; }, 300);
                } else {
                    callback();
                    if(element.id.includes('trip')) {
                        element.style.transform = "scale(1.05)";
                        element.style.color = "#9333ea";
                        setTimeout(() => { element.style.transform = "scale(1)"; }, 300);
                    }
                }
            }, duration);
        }
    </script>
</head>
<body class="h-[100dvh] w-full bg-[#F2F4F6] overflow-hidden relative">

    <div class="mobile-container relative bg-[#F2F4F6] h-full shadow-2xl">

        <!-- ==================== ìƒë‹¨ ì•Œë¦¼ ì»¨í…Œì´ë„ˆ ==================== -->
        <div id="notification-container" class="absolute top-0 left-0 w-full z-[100] flex flex-col items-center pointer-events-none"></div>

        <!-- ==================== 1. ë’¤ë¡œê°€ê¸° ë²„íŠ¼ (Global) ==================== -->
        <div class="absolute top-6 left-6 z-50">
            <button id="global-back-btn" onclick="handleGlobalBack()" class="p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-sm text-gray-400 hover:text-blue-600 transition-colors">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
        </div>

        <!-- ==================== 2. ê´€ë¦¬ì ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) ==================== -->
        <div class="absolute top-6 right-6 z-50">
            <button onclick="openAdminLogin()" class="p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-sm text-gray-400 hover:text-blue-600 transition-colors">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            </button>
        </div>

        <!-- ==================== 3. ë©”ì¸ ë©”ë‰´ ==================== -->
        <div id="screen-game-menu" class="h-full w-full flex flex-col p-6 pt-24 pb-24 overflow-y-auto fade-in no-scrollbar">
            
            <div class="mt-4 mb-8">
                <h1 class="text-[26px] leading-[1.3] font-bold text-[#191F28]">
                    ì—”ì¡°ì´ ì—¬ëŸ¬ë¶„,<br>
                    <span id="dynamic-greeting">í™œê¸°ì°¬ í•˜ë£¨ ë³´ë‚´ì„¸ìš”</span> <span class="inline-block animate-bounce">ğŸ€</span>
                </h1>
            </div>

            <div class="flex flex-col gap-4">
                
                <button onclick="switchScreen('screen-car-game');" class="btn-scale w-full bg-[#E8F3FF] rounded-[26px] p-6 text-left relative overflow-hidden h-[120px] flex items-center justify-between group shadow-sm">
                    <div class="z-10">
                        <span class="inline-block px-2 py-0.5 bg-white/60 text-[10px] font-bold text-blue-600 rounded-md mb-2 backdrop-blur-sm">BEST</span>
                        <h3 class="text-xl font-bold text-[#1B64DA] leading-tight">ì°¨ëŸ‰ & ìš´ì „ì<br>ë°°ì¹˜í•˜ê¸°</h3>
                    </div>
                    <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow-sm z-10 group-active:scale-110 transition-transform">
                        <svg class="text-[#1B64DA]" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>
                    </div>
                    <div class="absolute right-[-20px] top-[-30px] w-40 h-40 bg-white/30 rounded-full blur-2xl"></div>
                </button>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="switchScreen('screen-chore-game');" class="btn-scale bg-[#FFF0F0] rounded-[26px] p-5 text-left h-[160px] flex flex-col justify-between relative overflow-hidden group shadow-sm">
                        <div class="flex justify-between items-start z-10">
                            <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-sm text-[#F04452]">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                            </div>
                        </div>
                        <div class="z-10">
                            <h3 class="text-lg font-bold text-[#333D4B] mb-1">ê°œì¸ì„ë¬´ë¶„ë‹´ì œ<br>ë‹¹ë²ˆ ë½‘ê¸°</h3>
                            <p class="text-xs text-gray-500">ì˜¤ëŠ˜ì˜ ì£¼ì¸ê³µì€?</p>
                        </div>
                    </button>

                    <button onclick="switchScreen('screen-trip-game');" class="btn-scale bg-[#E8F7F0] rounded-[26px] p-5 text-left h-[160px] flex flex-col justify-between relative overflow-hidden group shadow-sm">
                        <div class="flex justify-between items-start z-10">
                            <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-sm text-[#00BFA5]">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                            </div>
                        </div>
                        <div class="z-10">
                            <h3 class="text-lg font-bold text-[#333D4B] mb-1">ì—¬í–‰ì§€<br>ë½‘ê¸°</h3>
                            <p class="text-xs text-gray-500">ì–´ë””ë¡œ ë– ë‚ ê¹Œìš”?</p>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ í™”ë©´ ==================== -->
        <div id="screen-members" class="hidden-screen h-full w-full flex-col p-6 pt-24 pb-24 overflow-y-auto fade-in no-scrollbar">
            <h2 class="text-2xl font-bold text-[#333D4B] mb-6">ì—”ì¡°ì´ ë©¤ë²„ë“¤</h2>
            <div class="grid grid-cols-2 gap-4">
                <!-- ì „ì‹œê¸° (íšŒì¥ ë°°ì§€ ì¶”ê°€) -->
                <div class="bg-white p-4 rounded-[20px] shadow-sm flex items-center gap-3 ring-1 ring-yellow-400 relative overflow-hidden bg-yellow-50/10">
                    <div class="absolute -right-8 -top-8 w-16 h-16 bg-yellow-100 rounded-full opacity-50 blur-xl"></div>
                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold relative shrink-0">
                        ì „
                        <span class="absolute -top-2 -right-1 text-sm animate-bounce">ğŸ‘‘</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-bold text-[#333D4B]">ì „ì‹œê¸°</span>
                        <span class="text-[10px] text-yellow-600 font-bold bg-yellow-100 px-1.5 py-0.5 rounded-full w-fit">íšŒì¥</span>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-[20px] shadow-sm flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 font-bold shrink-0">ì˜¤</div><span class="font-bold text-[#333D4B]">ì˜¤ìŠ¤í‹´</span></div>
                <div class="bg-white p-4 rounded-[20px] shadow-sm flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 font-bold shrink-0">ì§€</div><span class="font-bold text-[#333D4B]">ì§€ë…¸</span></div>
                <div class="bg-white p-4 rounded-[20px] shadow-sm flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600 font-bold shrink-0">í™</div><span class="font-bold text-[#333D4B]">í™ë°•ì‚¬</span></div>
                <div class="bg-white p-4 rounded-[20px] shadow-sm flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 font-bold shrink-0">ì„±</div><span class="font-bold text-[#333D4B]">ì„±ì›ì œ</span></div>
                <div class="bg-white p-4 rounded-[20px] shadow-sm flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold shrink-0">ë¥˜</div><span class="font-bold text-[#333D4B]">ë¥˜ì§±</span></div>
            </div>
            <div class="mt-auto pt-8 text-center"><p class="text-xs text-gray-400">Random Enjoy With Members</p></div>
        </div>

        <!-- ==================== 4. ì°¨ëŸ‰ ë°°ì¹˜ í™”ë©´ ==================== -->
        <div id="screen-car-game" class="hidden-screen h-full w-full flex-col items-center justify-start p-6 pt-24 bg-[#F2F4F6] overflow-y-auto no-scrollbar">
            <!-- Header Title Only (Sticky) -->
            <div class="w-full flex items-center justify-center mb-4">
                <h2 class="text-lg font-bold text-[#333D4B]">ì°¨ëŸ‰ ì¢Œì„ ë°°ì¹˜</h2>
            </div>

            <div class="w-full flex flex-col gap-4">
                <div class="bg-white rounded-[24px] p-2 flex gap-2 shadow-sm">
                    <button id="btn-car-1" onclick="setCarConfig(1)" class="flex-1 py-3 rounded-2xl font-bold text-sm transition-all bg-blue-600 text-white border border-blue-600 shadow-md">1ëŒ€ (6ì¸ìŠ¹)</button>
                    <button id="btn-car-2" onclick="setCarConfig(2)" class="flex-1 py-3 rounded-2xl font-bold text-sm transition-all text-gray-400 bg-white border border-gray-200 hover:bg-gray-50">2ëŒ€ (3ì¸ìŠ¹)</button>
                </div>

                <div class="bg-white p-5 rounded-[24px] shadow-sm flex flex-col gap-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-gray-700">ìš´ì „ì ì„ ì •</span>
                        <div class="bg-gray-100 p-1 rounded-xl flex text-xs font-bold">
                            <button id="mode-random" onclick="setDriverMode('random')" class="px-3 py-1.5 rounded-lg bg-white text-black shadow-sm transition-all">ëœë¤</button>
                            <button id="mode-manual" onclick="setDriverMode('manual')" class="px-3 py-1.5 rounded-lg text-gray-400 transition-all">ìˆ˜ë™</button>
                        </div>
                    </div>
                    <div id="manual-selector" class="hidden flex-wrap pt-2 border-t border-gray-100"></div>
                </div>

                <div id="car-view-container" class="w-full">
                    <!-- 1ëŒ€ (6ì¸ìŠ¹) -->
                    <div id="view-car-1" class="relative w-full aspect-[3/4] bg-[#E8F3FF] rounded-[32px] border-4 border-white p-5 flex flex-col justify-between shadow-sm mt-2">
                        <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-3/4 h-8 bg-white/50 rounded-b-3xl"></div>
                        <div class="flex gap-4 mb-2">
                            <div class="w-1/2 aspect-square bg-white rounded-2xl border-2 border-blue-200 flex flex-col items-center justify-center relative shadow-sm">
                                <span class="absolute top-2 left-2 text-[10px] text-blue-600 font-bold bg-blue-50 px-1.5 py-0.5 rounded">DRIVER</span>
                                <div id="seat-driver-1" class="text-lg font-bold text-gray-800">?</div>
                            </div>
                            <div class="w-1/2 aspect-square bg-white rounded-2xl border border-white flex flex-col items-center justify-center relative shadow-sm">
                                <span class="absolute top-2 left-2 text-[10px] text-gray-400">PASSENGER</span>
                                <div id="seat-p-1" class="text-lg font-bold text-gray-800">?</div>
                            </div>
                        </div>
                        <div class="flex gap-4 mb-2">
                            <div class="flex-1 aspect-video bg-white rounded-2xl border border-white flex items-center justify-center shadow-sm relative"><span class="absolute top-1 left-2 text-[8px] text-gray-300">MID</span><div id="seat-m-1" class="text-sm font-bold text-gray-800">?</div></div>
                            <div class="flex-1 aspect-video bg-white rounded-2xl border border-white flex items-center justify-center shadow-sm relative"><span class="absolute top-1 left-2 text-[8px] text-gray-300">MID</span><div id="seat-m-2" class="text-sm font-bold text-gray-800">?</div></div>
                        </div>
                        <div class="flex gap-4">
                            <div class="flex-1 aspect-video bg-white rounded-2xl border border-white flex items-center justify-center shadow-sm relative"><span class="absolute top-1 left-2 text-[8px] text-gray-300">BACK</span><div id="seat-b-1" class="text-sm font-bold text-gray-800">?</div></div>
                            <div class="flex-1 aspect-video bg-white rounded-2xl border border-white flex items-center justify-center shadow-sm relative"><span class="absolute top-1 left-2 text-[8px] text-gray-300">BACK</span><div id="seat-b-2" class="text-sm font-bold text-gray-800">?</div></div>
                        </div>
                    </div>

                    <!-- 2ëŒ€ ë·° -->
                    <div id="view-car-2" class="hidden w-full flex-col gap-4 mt-2">
                        <div class="bg-[#E8F3FF] rounded-[32px] border-4 border-white p-4 shadow-sm">
                            <p class="text-center text-xs font-bold text-blue-400 mb-2">CAR 1</p>
                            <div class="flex gap-2 mb-2">
                                <div class="w-1/2 aspect-square bg-white rounded-2xl border-2 border-blue-200 flex flex-col items-center justify-center relative shadow-sm"><span class="absolute top-1 left-1 text-[8px] text-blue-600 font-bold bg-blue-50 px-1 rounded">DRV</span><div id="seat-driver-a" class="text-sm font-bold text-black">?</div></div>
                                <div class="w-1/2 aspect-square bg-white rounded-2xl border border-white flex flex-col items-center justify-center relative shadow-sm"><div id="seat-p-a" class="text-sm font-bold text-gray-800">?</div></div>
                            </div>
                            <div class="w-full h-12 bg-white rounded-2xl border border-white flex items-center justify-center shadow-sm"><div id="seat-b-a" class="text-sm font-bold text-gray-800">?</div></div>
                        </div>
                        <div class="bg-[#E8F3FF] rounded-[32px] border-4 border-white p-4 shadow-sm">
                            <p class="text-center text-xs font-bold text-blue-400 mb-2">CAR 2</p>
                            <div class="flex gap-2 mb-2">
                                <div class="w-1/2 aspect-square bg-white rounded-2xl border-2 border-blue-200 flex flex-col items-center justify-center relative shadow-sm"><span class="absolute top-1 left-1 text-[8px] text-blue-600 font-bold bg-blue-50 px-1 rounded">DRV</span><div id="seat-driver-b" class="text-sm font-bold text-black">?</div></div>
                                <div class="w-1/2 aspect-square bg-white rounded-2xl border border-white flex flex-col items-center justify-center relative shadow-sm"><div id="seat-p-b" class="text-sm font-bold text-gray-800">?</div></div>
                            </div>
                            <div class="w-full h-12 bg-white rounded-2xl border border-white flex items-center justify-center shadow-sm"><div id="seat-b-b" class="text-sm font-bold text-gray-800">?</div></div>
                        </div>
                    </div>
                </div>

                <button id="btn-run-car" onclick="requestCarGame()" class="btn-scale w-full bg-blue-600 text-white py-4 rounded-[20px] font-bold shadow-lg shadow-blue-200 mt-2 text-lg">ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
            </div>
        </div>

        <!-- ==================== 5. ì²­ì†Œ ê²Œì„ í™”ë©´ ==================== -->
        <div id="screen-chore-game" class="hidden-screen h-full w-full flex-col items-center justify-start p-6 pt-24 bg-[#F2F4F6] overflow-y-auto no-scrollbar">
            <!-- Header Title -->
            <div class="w-full flex items-center justify-center mb-6">
                <h2 class="text-lg font-bold text-[#333D4B]">ë‹¹ë²ˆ ë½‘ê¸°</h2>
            </div>

            <div class="w-full flex flex-col gap-6">
                <div class="w-full bg-white rounded-[26px] p-6 flex items-center justify-between shadow-sm">
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2 text-blue-500 mb-1"><span class="text-xs font-bold uppercase tracking-wider bg-blue-50 px-2 py-0.5 rounded-full">CLEANING</span></div>
                        <span class="text-xl font-bold text-[#333D4B]">ì²­ì†Œ ë‹¹ë²ˆ</span>
                    </div>
                    <div id="result-cleaning" class="h-14 px-6 bg-blue-50 rounded-2xl flex items-center justify-center font-bold text-2xl text-blue-600 min-w-[100px]">?</div>
                </div>

                <div class="w-full bg-white rounded-[26px] p-6 flex items-center justify-between shadow-sm">
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2 text-green-500 mb-1"><span class="text-xs font-bold uppercase tracking-wider bg-green-50 px-2 py-0.5 rounded-full">DISHES</span></div>
                        <span class="text-xl font-bold text-[#333D4B]">ì„¤ê±°ì§€ ë‹¹ë²ˆ</span>
                    </div>
                    <div id="result-dishes" class="h-14 px-6 bg-green-50 rounded-2xl flex items-center justify-center font-bold text-2xl text-green-600 min-w-[100px]">?</div>
                </div>

                <button id="btn-run-chore" onclick="requestChoreGame()" class="btn-scale w-full bg-[#333D4B] text-white py-4 rounded-[20px] font-bold shadow-lg mt-auto text-lg">ì¶”ì²¨ ì‹œì‘í•˜ê¸°!</button>
            </div>
        </div>

        <!-- ==================== 6. ì—¬í–‰ì§€ ë½‘ê¸° í™”ë©´ ==================== -->
        <div id="screen-trip-game" class="hidden-screen h-full w-full flex-col items-center justify-start p-6 pt-24 bg-[#F2F4F6] overflow-y-auto no-scrollbar">
            <!-- Header Title -->
            <div class="w-full flex items-center justify-center mb-4">
                <h2 class="text-lg font-bold text-[#333D4B]">ì—¬í–‰ì§€ ë½‘ê¸°</h2>
            </div>

            <div class="w-full flex flex-col gap-4">
                <div class="w-full bg-white rounded-[30px] p-8 flex flex-col items-center justify-center relative shadow-sm border border-purple-50">
                    <span class="text-xs font-bold text-purple-400 uppercase tracking-widest mb-2">REGION</span>
                    <div id="result-trip-step1" class="text-3xl font-bold text-[#333D4B] break-keep text-center">?</div>
                </div>

                <div class="flex justify-center -my-3 z-10">
                    <div class="bg-purple-50 p-2 rounded-full border-4 border-[#F2F4F6]"><svg class="text-purple-300" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M7 13l5 5 5-5M7 6l5 5 5-5"/></svg></div>
                </div>

                <div id="box-trip-step2" class="w-full bg-white rounded-[30px] p-8 flex flex-col items-center justify-center relative shadow-sm border border-gray-100 transition-colors duration-300">
                    <span class="text-xs font-bold text-gray-300 uppercase tracking-widest mb-2 transition-colors" id="label-step2">DETAIL</span>
                    <div id="result-trip-step2" class="text-3xl font-bold text-gray-200 break-keep text-center transition-colors">-</div>
                </div>

                <button id="btn-run-trip" onclick="requestTripGame()" class="btn-scale w-full bg-purple-600 text-white py-4 rounded-[20px] font-bold shadow-lg shadow-purple-200 mt-4 text-lg">ì—¬í–‰ì§€ í™•ì¸í•˜ê¸°</button>
            </div>
        </div>

        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div id="main-nav" class="absolute bottom-6 left-1/2 transform -translate-x-1/2 glass-nav rounded-full px-8 py-3 flex items-center gap-10 z-50">
            <button id="nav-home" onclick="switchScreen('screen-game-menu')" class="flex flex-col items-center gap-1 opacity-100 transition-opacity">
                <svg class="text-[#333D4B]" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                <span class="text-[10px] font-bold text-[#333D4B]">í™ˆ</span>
            </button>
            <button id="nav-members" onclick="switchScreen('screen-members')" class="flex flex-col items-center gap-1 opacity-40 transition-opacity">
                <svg class="text-[#333D4B]" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                <span class="text-[10px] font-bold text-[#333D4B]">ë©¤ë²„</span>
            </button>
        </div>
    </div>

    <!-- ==================== ê´€ë¦¬ì ëª¨ë‹¬ (ì—…ë°ì´íŠ¸) ==================== -->
    <div id="modal-admin-login" class="fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-[24px] p-6 w-full max-w-xs text-center shadow-2xl">
            <h3 class="text-lg font-bold mb-4">ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
            <input type="password" id="admin-pw" class="w-full border border-gray-200 bg-gray-50 rounded-xl p-3 mb-4 text-center" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
            <div class="flex gap-2">
                <button onclick="closeAdminLogin()" class="flex-1 py-3 bg-gray-100 rounded-xl font-bold text-gray-600">ì·¨ì†Œ</button>
                <button onclick="checkAdminPw()" class="flex-1 py-3 bg-blue-600 rounded-xl font-bold text-white">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div id="modal-admin-panel" class="fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm hidden flex items-center justify-center px-6">
        <div class="bg-white rounded-[24px] p-6 w-full max-w-xs text-center shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold">ê´€ë¦¬ì ì„¤ì •</h3>
                <button onclick="closeAdminPanel()" class="text-gray-400"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
            </div>
            
            <div class="space-y-4">
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100 text-left">
                    <p class="text-sm font-bold text-gray-900 mb-2">ê²Œì„ë³„ ì´ˆê¸°í™”</p>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="adminResetGame('car')" class="py-3 bg-blue-100 text-blue-700 rounded-xl text-xs font-bold hover:bg-blue-200 transition-colors">
                            ì°¨ëŸ‰<br>ì´ˆê¸°í™”
                        </button>
                        <button onclick="adminResetGame('chore')" class="py-3 bg-red-100 text-red-700 rounded-xl text-xs font-bold hover:bg-red-200 transition-colors">
                            ë‹¹ë²ˆ<br>ì´ˆê¸°í™”
                        </button>
                        <button onclick="adminResetGame('trip')" class="py-3 bg-purple-100 text-purple-700 rounded-xl text-xs font-bold hover:bg-purple-200 transition-colors">
                            ì—¬í–‰<br>ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-100 text-left flex items-center justify-between">
                    <div>
                        <p class="text-sm font-bold text-gray-900 mb-1">ë¬´í•œ ë½‘ê¸° ëª¨ë“œ</p>
                        <p class="text-xs text-gray-500">1íšŒ ì œí•œì„ ì¼ì‹œì ìœ¼ë¡œ í•´ì œí•©ë‹ˆë‹¤.</p>
                    </div>
                    <button id="btn-unlimited-toggle" onclick="adminToggleUnlimited()" class="w-12 h-7 bg-gray-300 rounded-full relative transition-colors">
                        <div class="w-5 h-5 bg-white rounded-full absolute top-1 left-1 transition-transform"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- [Firebase Script] -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, updateDoc, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB_GKGcBR-MGnhpRz_UbdRIy_iZN9rjNq4",
            authDomain: "random-enjoy.firebaseapp.com",
            projectId: "random-enjoy",
            storageBucket: "random-enjoy.firebasestorage.app",
            messagingSenderId: "337463244854",
            appId: "1:337463244854:web:9972e90fbacb6869a34097"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let globalState = {
            car: { timestamp: 0 },
            chore: { timestamp: 0 },
            trip: { timestamp: 0 },
            admin: { resets: { car: 0, chore: 0, trip: 0 }, unlimited: false }
        };
        let localTimestamps = { car: 0, chore: 0, trip: 0 };
        let isFirstLoad = true;

        const setupFirestoreListener = () => {
            const docRef = doc(db, 'games', 'random_enjoy_state');
            onSnapshot(docRef, (snapshot) => {
                if (snapshot.exists()) {
                    handleGameStateChange(snapshot.data());
                } else {
                    setDoc(docRef, {
                        car: { timestamp: 0 },
                        chore: { timestamp: 0 },
                        trip: { timestamp: 0 },
                        admin: { resets: { car: 0, chore: 0, trip: 0 }, unlimited: false }
                    }, { merge: true });
                }
                isFirstLoad = false;
            }, (error) => {
                console.error("Snapshot error:", error);
            });
        };

        const init = async () => {
            try {
                await signInAnonymously(auth);
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        setupFirestoreListener();
                        updateButtonVisibility(); 
                    }
                });
            } catch (e) { console.error(e); }
        };
        init();

        function handleGameStateChange(newData) {
            globalState = newData;
            updateTopNotifications(newData);
            updateButtonVisibility();

            // ê°œë³„ ë¦¬ì…‹ ì²˜ë¦¬
            const adminResets = newData.admin?.resets || { car: 0, chore: 0, trip: 0 };
            
            // Check Car Reset
            if (newData.car && newData.car.timestamp === 0) {
                 window.resetCarGameUI();
            } else if (newData.car && newData.car.timestamp > localTimestamps.car) {
                if (!isFirstLoad) playCarGameAnimation(newData.car);
                else displayCarResult(newData.car);
                localTimestamps.car = newData.car.timestamp;
            } else if (newData.car) {
                displayCarResult(newData.car);
            }

            // Check Chore Reset
            if (newData.chore && newData.chore.timestamp === 0) {
                window.resetChoreGameUI();
            } else if (newData.chore && newData.chore.timestamp > localTimestamps.chore) {
                if (!isFirstLoad) playChoreGameAnimation(newData.chore);
                else displayChoreResult(newData.chore);
                localTimestamps.chore = newData.chore.timestamp;
            } else if (newData.chore) {
                displayChoreResult(newData.chore);
            }

            // Check Trip Reset
            if (newData.trip && newData.trip.timestamp === 0) {
                window.resetTripGameUI();
            } else if (newData.trip && newData.trip.timestamp > localTimestamps.trip) {
                if (!isFirstLoad) playTripGameAnimation(newData.trip);
                else displayTripResult(newData.trip);
                localTimestamps.trip = newData.trip.timestamp;
            } else if (newData.trip) {
                displayTripResult(newData.trip);
            }
        }

        function updateTopNotifications(data) {
            const container = document.getElementById('notification-container');
            const admin = data.admin || { unlimited: false, resets: {} };
            const resets = admin.resets || { car: 0, chore: 0, trip: 0 };

            // 1. Unlimited Mode Banner
            let unlimitedBanner = document.getElementById('noti-unlimited');
            if (admin.unlimited) {
                if (!unlimitedBanner) {
                    unlimitedBanner = createNotification('noti-unlimited', 'ğŸ”¥ ë¬´í•œ ë½‘ê¸° ëª¨ë“œ í™œì„±í™” ì¤‘!', 'bg-red-500');
                    container.appendChild(unlimitedBanner);
                }
            } else {
                if (unlimitedBanner) unlimitedBanner.remove();
            }
            updateUnlimitedUI(admin.unlimited);

            // 2. Persistent Reset Banners Logic (State-based)
            // ë°°ë„ˆê°€ ë³´ì—¬ì•¼ í•˜ëŠ” ì¡°ê±´: (ë§ˆì§€ë§‰ ë¦¬ì…‹ ì‹œê°„) > (ë§ˆì§€ë§‰ ê²Œì„ í”Œë ˆì´ ì‹œê°„)
            // ì¦‰, ë¦¬ì…‹ ì´í›„ì— ì•„ì§ ê²Œì„ì„ í•˜ì§€ ì•Šì•˜ì„ ë•Œë§Œ ë°°ë„ˆë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
            
            const carResetTime = resets.car || 0;
            const carPlayTime = data.car?.timestamp || 0;
            updatePersistentBanner('car', carResetTime > carPlayTime, 'ğŸš— ì°¨ëŸ‰ ë°°ì¹˜ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'bg-blue-600');

            const choreResetTime = resets.chore || 0;
            const chorePlayTime = data.chore?.timestamp || 0;
            updatePersistentBanner('chore', choreResetTime > chorePlayTime, 'ğŸ§¹ ë‹¹ë²ˆì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'bg-green-600');

            const tripResetTime = resets.trip || 0;
            const tripPlayTime = data.trip?.timestamp || 0;
            updatePersistentBanner('trip', tripResetTime > tripPlayTime, 'âœˆï¸ ì—¬í–‰ì§€ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'bg-purple-600');
        }

        function updatePersistentBanner(key, shouldShow, msg, color) {
            const container = document.getElementById('notification-container');
            const id = `noti-reset-${key}`;
            let el = document.getElementById(id);

            if (shouldShow) {
                if (!el) {
                    el = createNotification(id, msg, color);
                    container.appendChild(el);
                }
            } else {
                if (el) {
                    el.classList.remove('slide-down');
                    el.classList.add('slide-up');
                    setTimeout(() => { if(el && el.parentNode) el.remove(); }, 300);
                }
            }
        }

        function createNotification(id, text, colorClass) {
            const el = document.createElement('div');
            el.id = id;
            el.className = `${colorClass} text-white px-6 py-3 rounded-b-xl shadow-lg flex items-center gap-3 pointer-events-auto mb-2 slide-down font-bold text-sm justify-center transition-all duration-300`;
            const span = document.createElement('span');
            span.textContent = text;
            el.appendChild(span);
            return el;
        }

        window.updateButtonVisibility = () => {
            const isUnlimited = globalState.admin?.unlimited;
            const carPlayed = globalState.car?.timestamp > 0;
            const chorePlayed = globalState.chore?.timestamp > 0;
            const tripPlayed = globalState.trip?.timestamp > 0;

            document.getElementById('btn-run-car').style.display = (!isUnlimited && carPlayed) ? 'none' : 'block';
            document.getElementById('btn-run-chore').style.display = (!isUnlimited && chorePlayed) ? 'none' : 'block';
            document.getElementById('btn-run-trip').style.display = (!isUnlimited && tripPlayed) ? 'none' : 'block';
        }

        window.openAdminLogin = () => document.getElementById('modal-admin-login').classList.remove('hidden');
        window.closeAdminLogin = () => document.getElementById('modal-admin-login').classList.add('hidden');
        window.checkAdminPw = () => {
            const pw = document.getElementById('admin-pw').value;
            if (pw === '0920') {
                closeAdminLogin();
                document.getElementById('modal-admin-panel').classList.remove('hidden');
                document.getElementById('admin-pw').value = '';
            } else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.'); }
        };
        window.closeAdminPanel = () => document.getElementById('modal-admin-panel').classList.add('hidden');
        
        // Granular Reset Function
        window.adminResetGame = async (type) => {
            if (!confirm(`${type === 'car' ? 'ì°¨ëŸ‰' : type === 'chore' ? 'ë‹¹ë²ˆ' : 'ì—¬í–‰'} ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            try {
                const docRef = doc(db, 'games', 'random_enjoy_state'); 
                
                // í•´ë‹¹ ê²Œì„ ë°ì´í„° ë¦¬ì…‹ ë° ë¦¬ì…‹ íƒ€ì„ìŠ¤íƒ¬í”„ ê°±ì‹ 
                let updateData = {
                    [`admin.resets.${type}`]: Date.now(),
                    [type]: { timestamp: 0 } // ê²Œì„ ë°ì´í„° ì‹¤ì œ ì´ˆê¸°í™”
                };

                await updateDoc(docRef, updateData);
                closeAdminPanel();
            } catch (e) { alert("ì´ˆê¸°í™” ì‹¤íŒ¨: " + e.message); }
        };

        window.adminToggleUnlimited = async () => {
            try {
                const current = globalState.admin?.unlimited || false;
                const docRef = doc(db, 'games', 'random_enjoy_state');
                await updateDoc(docRef, { 'admin.unlimited': !current });
            } catch (e) { alert("ì„¤ì • ë³€ê²½ ì‹¤íŒ¨: " + e.message); }
        };
        
        function updateUnlimitedUI(isUnlimited) {
            const btn = document.getElementById('btn-unlimited-toggle');
            const dot = btn.querySelector('div');
            if (isUnlimited) {
                btn.classList.replace('bg-gray-300', 'bg-green-500');
                dot.classList.replace('left-1', 'translate-x-5'); 
                dot.style.transform = 'translateX(20px)'; 
            } else {
                btn.classList.replace('bg-green-500', 'bg-gray-300');
                dot.classList.replace('translate-x-5', 'left-1');
                dot.style.transform = 'translateX(0)';
            }
        }
        function canPlay(gameType) {
            if (globalState.admin?.unlimited) return true; 
            if (globalState[gameType]?.timestamp > 0) { alert('ì´ë¯¸ ê²°ê³¼ê°€ ë‚˜ì™€ìˆìŠµë‹ˆë‹¤!'); return false; }
            return true;
        }

        window.requestCarGame = async () => {
            if (!canPlay('car')) return;
            const driverMode = window.getDriverMode(); 
            const selectedDrivers = window.getSelectedDrivers(); 
            const carConfig = window.getCarConfig();
            if (driverMode === 'manual') {
                if (carConfig === 1 && selectedDrivers.length !== 1) { alert('ìš´ì „ì 1ëª…ì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
                if (carConfig === 2 && selectedDrivers.length !== 2) { alert('ìš´ì „ì 2ëª…ì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
            }
            let finalDrivers = [];
            let passengers = [];
            if (driverMode === 'manual') finalDrivers = [...selectedDrivers];
            else {
                const shuffled = [...MEMBERS].sort(() => Math.random() - 0.5);
                if (carConfig === 1) finalDrivers = [shuffled[0]];
                else finalDrivers = [shuffled[0], shuffled[1]];
            }
            passengers = MEMBERS.filter(m => !finalDrivers.includes(m)).sort(() => Math.random() - 0.5);
            await setDoc(doc(db, 'games', 'random_enjoy_state'), {
                car: { config: carConfig, drivers: finalDrivers, passengers: passengers, timestamp: Date.now() }
            }, { merge: true });
        };

        window.requestChoreGame = async () => {
            if (!canPlay('chore')) return;
            const shuffled = [...MEMBERS].sort(() => Math.random() - 0.5);
            await setDoc(doc(db, 'games', 'random_enjoy_state'), {
                chore: { cleaner: shuffled[0], dishwasher: shuffled[1], timestamp: Date.now() }
            }, { merge: true });
        };

        window.requestTripGame = async () => {
            if (!canPlay('trip')) return;
            const step1 = REGION_POOL[Math.floor(Math.random() * REGION_POOL.length)];
            let step2 = null;
            if (TRIP_REGIONS_COMPLEX[step1]) {
                const subs = TRIP_REGIONS_COMPLEX[step1];
                step2 = subs[Math.floor(Math.random() * subs.length)];
            }
            await setDoc(doc(db, 'games', 'random_enjoy_state'), {
                trip: { step1: step1, step2: step2, timestamp: Date.now() }
            }, { merge: true });
        };

        function playCarGameAnimation(data) {
            window.initAudio();
            window.updateCarView(data.config || 1); 
            if (data.config === 1) {
                const driverEl = document.getElementById('seat-driver-1');
                window.animateShuffle(driverEl, MEMBERS, data.drivers[0], 2000);
                const seatIds = ['seat-p-1', 'seat-m-1', 'seat-m-2', 'seat-b-1', 'seat-b-2'];
                seatIds.forEach((id, i) => {
                    const el = document.getElementById(id);
                    if(data.passengers[i]) window.animateShuffle(el, MEMBERS, data.passengers[i], 2000 + (i * 300));
                });
            } else {
                const driverElA = document.getElementById('seat-driver-a');
                const driverElB = document.getElementById('seat-driver-b');
                window.animateShuffle(driverElA, MEMBERS, data.drivers[0], 2000);
                window.animateShuffle(driverElB, MEMBERS, data.drivers[1], 2000);
                const seatIds = ['seat-p-a', 'seat-b-a', 'seat-p-b', 'seat-b-b'];
                seatIds.forEach((id, i) => {
                    const el = document.getElementById(id);
                    if(data.passengers[i]) window.animateShuffle(el, MEMBERS, data.passengers[i], 2000 + (i * 300));
                });
            }
        }
        function displayCarResult(data) {
            window.updateCarView(data.config || 1);
            if(data.config === 1) {
                if(data.drivers && data.drivers[0]) document.getElementById('seat-driver-1').textContent = data.drivers[0];
                const seatIds = ['seat-p-1', 'seat-m-1', 'seat-m-2', 'seat-b-1', 'seat-b-2'];
                seatIds.forEach((id, i) => { if(data.passengers && data.passengers[i]) document.getElementById(id).textContent = data.passengers[i]; });
            } else {
                if(data.drivers) {
                    document.getElementById('seat-driver-a').textContent = data.drivers[0];
                    document.getElementById('seat-driver-b').textContent = data.drivers[1];
                }
                const seatIds = ['seat-p-a', 'seat-b-a', 'seat-p-b', 'seat-b-b'];
                seatIds.forEach((id, i) => { if(data.passengers && data.passengers[i]) document.getElementById(id).textContent = data.passengers[i]; });
            }
            document.querySelectorAll('[id^="seat-"]').forEach(el => el.style.color = '#3182ce');
        }

        function playChoreGameAnimation(data) {
            window.initAudio();
            const cEl = document.getElementById('result-cleaning');
            const dEl = document.getElementById('result-dishes');
            window.animateShuffle(cEl, MEMBERS, data.cleaner, 1500);
            window.animateShuffle(dEl, MEMBERS, data.dishwasher, 2500);
        }
        function displayChoreResult(data) {
            if(!data.cleaner) return;
            const cEl = document.getElementById('result-cleaning');
            const dEl = document.getElementById('result-dishes');
            cEl.textContent = data.cleaner;
            dEl.textContent = data.dishwasher;
            cEl.style.color = "#2563eb";
            dEl.style.color = "#16a34a";
        }

        function playTripGameAnimation(data) {
            window.initAudio();
            window.resetTripGameUI();
            const el1 = document.getElementById('result-trip-step1');
            const el2 = document.getElementById('result-trip-step2');
            window.animateShuffleCallback(el1, REGION_POOL, data.step1, 2000, () => {
                if (data.step2) {
                    setTimeout(() => {
                        window.activateStep2UI();
                        const subRegions = TRIP_REGIONS_COMPLEX[data.step1];
                        window.animateShuffleCallback(el2, subRegions, data.step2, 2000, () => window.playWinSound());
                    }, 300);
                } else {
                    el2.textContent = "í•´ë‹¹ ì—†ìŒ";
                    window.playWinSound();
                }
            });
        }
        function displayTripResult(data) {
            if(!data.step1) return;
            window.resetTripGameUI();
            document.getElementById('result-trip-step1').textContent = data.step1;
            document.getElementById('result-trip-step1').style.color = "#9333ea";
            if (data.step2) {
                window.activateStep2UI();
                const el2 = document.getElementById('result-trip-step2');
                el2.textContent = data.step2;
                el2.style.color = "#9333ea";
            } else {
                document.getElementById('result-trip-step2').textContent = "í•´ë‹¹ ì—†ìŒ";
            }
        }
    </script>
</body>
</html>