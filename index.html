<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Enjoy - Paper Diary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í°íŠ¸ ë° ì•„ì´ì½˜ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Jua (Handwritten style) -->
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    
    <style>
        @font-face {
            font-family: 'TossFaceFontMac';
            src: url('https://cdn.jsdelivr.net/gh/toss/tossface/dist/tossface-font-mac.css');
        }

        :root {
            --paper-bg: #FDFBF7;
            --paper-texture: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
            --text-ink: #4A4036;
            --text-light: #8C837B;
            --accent-tape: #FFD166;
            --shadow-paper: 2px 4px 10px rgba(74, 64, 54, 0.1);
        }

        body { 
            font-family: 'Jua', sans-serif;
            background-color: #E6E2DA; /* PC ë°°ê²½ */
            color: var(--text-ink);
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            touch-action: pan-y;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            height: 100dvh;
        }

        /* ëª¨ë°”ì¼ í”„ë ˆì„ */
        #mobile-frame {
            width: 100%;
            max-width: 450px;
            height: 100%;
            background-color: var(--paper-bg);
            background-image: var(--paper-texture);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0,0,0,0.1);
            border-left: 1px solid #E0D8D0;
            border-right: 1px solid #E0D8D0;
        }

        /* Paper Card Style */
        .paper-card {
            background-color: #FFFFFF;
            background-image: var(--paper-texture);
            border-radius: 20px; /* ì•½ê°„ ë‘¥ê¸€ê²Œ */
            box-shadow: var(--shadow-paper);
            border: 1px solid rgba(0,0,0,0.02);
            position: relative;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: visible; /* ìŠ¤í‹°ì»¤ ë“±ì´ íŠ€ì–´ë‚˜ì˜¤ê²Œ */
        }
        
        .paper-card:active {
            transform: scale(0.98) rotate(-1deg);
        }

        /* Tape Effect */
        .tape {
            position: absolute;
            height: 24px;
            width: 80px;
            background-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            top: -10px;
            left: 50%;
            transform: translateX(-50%) rotate(-2deg);
            z-index: 10;
            opacity: 0.6;
            border-left: 1px dashed rgba(0,0,0,0.1);
            border-right: 1px dashed rgba(0,0,0,0.1);
        }
        .tape-corner {
            position: absolute;
            width: 40px;
            height: 12px;
            background-color: var(--accent-tape);
            opacity: 0.8;
            top: -5px;
            right: 20px;
            transform: rotate(25deg);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* Navigation Bar (Sketchbook Binder) */
        .nav-paper {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: #FFFFFF;
            background-image: var(--paper-texture);
            border-top: 2px dashed #D6CCC2;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 20px;
            z-index: 50;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.02);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #C2B8B0;
            gap: 4px;
            font-size: 12px;
            transition: all 0.2s;
        }
        .nav-item i {
            font-size: 22px;
            transition: transform 0.2s;
        }
        .nav-item.active {
            color: #FF8BA7; /* Warm Pink */
            transform: translateY(-5px);
        }
        .nav-item.active i {
            transform: rotate(-10deg) scale(1.1);
        }

        .screen-container { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow-y: auto; display: none; opacity: 0; transition: opacity 0.3s; 
            padding-bottom: 100px;
            z-index: 10;
        }
        .screen-container.active { display: block; opacity: 1; }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Marquee on Paper Strip */
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-content { display: inline-block; animation: marquee 25s linear infinite; padding-left: 100%; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        .pt-safe { padding-top: max(20px, env(safe-area-inset-top)); }
        .pb-safe { padding-bottom: max(20px, env(safe-area-inset-bottom)); }

        /* Hand-drawn Input */
        .input-paper {
            width: 100%;
            background: transparent;
            border: 2px solid #E0D8D0;
            border-radius: 12px;
            padding: 12px 16px;
            font-family: 'Jua', sans-serif;
            font-size: 16px;
            color: var(--text-ink);
            outline: none;
            background-color: #FFF;
            box-shadow: inset 1px 1px 4px rgba(0,0,0,0.05);
            transition: border-color 0.2s;
        }
        .input-paper:focus {
            border-color: #FF8BA7;
            border-style: dashed;
        }

        /* Post-it Style */
        .post-it {
            background-color: #FFF7D1; /* Light Yellow */
            box-shadow: 2px 4px 6px rgba(0,0,0,0.1);
            transform: rotate(-1deg);
        }
        .post-it-blue {
            background-color: #E0F7FA;
            transform: rotate(1deg);
        }
        .post-it-pink {
            background-color: #FCE4EC;
            transform: rotate(-0.5deg);
        }
    </style>
</head>
<body>

    <div id="mobile-frame">
        
        <!-- =======================
             ìƒì¼ ì¶•í•˜ ì˜¤ë²„ë ˆì´ (Birthday Overlay)
             ======================= -->
        <div id="birthday-overlay" class="absolute inset-0 z-[200] bg-black/90 flex flex-col items-center justify-center text-white text-center p-6" style="display:flex;">
            <canvas id="firework-canvas" class="absolute inset-0 w-full h-full pointer-events-none"></canvas>
            <div class="relative z-10 space-y-6">
                <h1 class="text-4xl font-bold text-[#FFD166] drop-shadow-lg leading-relaxed animate-bounce">
                    ğŸ‚ Happy Birthday!<br>
                    <span class="text-5xl text-[#FF8BA7]">ì „ì‹œê¸°</span>
                </h1>
                <p class="text-lg opacity-80">ì˜¤ëŠ˜ í•˜ë£¨ ê°€ì¥ í–‰ë³µí•œ ì‚¬ëŒì´ê¸¸! âœ¨</p>
                
                <div class="flex flex-col gap-3 w-full max-w-xs mx-auto mt-8">
                    <button onclick="window.closeBirthdayOverlay()" class="bg-[#FF8BA7] text-white py-3 rounded-xl font-bold shadow-lg border-b-4 border-[#F06292] active:border-b-0 active:translate-y-1 transition-all">
                        ì‚¬ì´íŠ¸ ì ‘ì†í•˜ê¸° ğŸ
                    </button>
                    <button onclick="window.location.href='message.html'" class="bg-white text-[#5D4037] py-3 rounded-xl font-bold shadow-lg border-b-4 border-[#D7CCC8] active:border-b-0 active:translate-y-1 transition-all">
                        ì¶•í•˜ë©”ì„¸ì§€ ë‚¨ê¸°ê¸° ğŸ’Œ
                    </button>
                </div>
            </div>
        </div>

        <!-- =======================
             1. í™ˆ í™”ë©´ (Home)
             ======================= -->
        <main id="home-screen" class="screen-container active scrollbar-hide px-6 pt-safe">
            <!-- Header -->
            <div class="mt-10 mb-8 relative z-10 flex justify-between items-end">
                <div>
                    <div class="inline-block bg-[#E8F5E9] text-[#4CAF50] px-3 py-1 rounded-full text-xs mb-2 border border-[#C8E6C9] transform -rotate-2 shadow-sm">
                        ì˜¤ëŠ˜ë„ ë§‘ìŒ â˜€ï¸
                    </div>
                    <h1 class="text-3xl text-[#4A4036] leading-tight">
                        ì•ˆë…•, <span class="text-[#FF8BA7] underline decoration-wavy decoration-2 underline-offset-4">ì—”ì¡°ì´</span>!<br>
                        ê¸°ë¡í•  ì¤€ë¹„ ëì–´?
                    </h1>
                </div>
                <div class="w-12 h-12">
                    <!-- Doodle Sticker -->
                    <svg viewBox="0 0 100 100" class="w-full h-full text-[#FFD166] drop-shadow-sm transform rotate-12">
                        <circle cx="50" cy="50" r="40" fill="currentColor"/>
                        <circle cx="35" cy="40" r="5" fill="#4A4036"/>
                        <circle cx="65" cy="40" r="5" fill="#4A4036"/>
                        <path d="M 35 65 Q 50 75 65 65" stroke="#4A4036" stroke-width="4" fill="none" stroke-linecap="round"/>
                    </svg>
                </div>
            </div>

            <!-- Notice Banner (Washi Tape Style) -->
            <div class="mb-8 relative z-10">
                <div class="bg-[#FFECB3] py-2 px-1 transform rotate-1 shadow-sm border-l-4 border-r-4 border-transparent border-dashed" style="border-image: linear-gradient(to right, transparent 50%, rgba(0,0,0,0.1) 50%) 1;">
                    <div class="marquee-container w-full">
                        <div class="marquee-content text-sm text-[#5D4037]">
                            ğŸ–ï¸ ì—”ì¡°ì´ 2026ë…„ ì²« ëª¨ì„ 1ì›” 26ì¼ ~ 27ì¼ í™•ì •! &nbsp;&nbsp;&nbsp; ğŸˆ 2026ë…„ ë³‘ì˜¤ë…„ ìƒˆí•´ ë³µ ë§ì´ ë°›ìœ¼ì„¸ìš”!
                        </div>
                    </div>
                    <!-- Tape ends -->
                    <div class="absolute top-0 left-0 w-4 h-full bg-white opacity-40" style="clip-path: polygon(0 0, 100% 0, 80% 100%, 0% 100%);"></div>
                    <div class="absolute top-0 right-0 w-4 h-full bg-white opacity-40" style="clip-path: polygon(20% 0, 100% 0, 100% 100%, 0% 100%);"></div>
                </div>
            </div>

            <!-- Service Grid (Polaroid Style) -->
            <div class="grid grid-cols-2 gap-4 mb-8 relative z-10">
                
                <!-- Music Player (Big Note) -->
                <button onclick="window.haptic(); window.goToMusic()" class="paper-card col-span-2 p-6 flex flex-col justify-between h-40 group hover:rotate-1 transition-transform bg-[#F3E5F5]">
                    <div class="tape"></div>
                    <div class="flex justify-between items-start mt-2">
                        <div>
                            <span class="inline-block bg-white px-2 py-0.5 rounded text-xs text-[#9C27B0] border border-[#E1BEE7] mb-2">NOW PLAYING ğŸ§</span>
                            <h2 class="text-2xl text-[#4A4036]">ë®¤ì§ í”Œë ˆì´ì–´</h2>
                        </div>
                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-[#9C27B0] shadow-sm border border-[#E1BEE7] group-active:scale-90 transition-transform">
                            <i class="fa-solid fa-play ml-1 text-lg"></i>
                        </div>
                    </div>
                    <p class="text-sm text-[#8E8E8E] text-left">ë¸Œì´ë¡œê·¸ BGM ê°ìƒí•˜ê¸° <i class="fa-solid fa-music text-[10px] ml-1"></i></p>
                </button>

                <!-- Location (Yellow Note) -->
                <button onclick="window.haptic(); window.location.href='map.html'" class="paper-card post-it p-4 h-40 flex flex-col justify-between text-left hover:scale-[1.02] transition-transform">
                    <div class="flex justify-between w-full">
                        <i class="fa-solid fa-map-location-dot text-2xl text-[#FF9800]"></i>
                        <span class="w-3 h-3 rounded-full bg-red-400 border border-red-500"></span>
                    </div>
                    <div>
                        <h3 class="text-xl text-[#5D4037] mb-1">ìœ„ì¹˜ ê³µìœ </h3>
                        <p class="text-xs text-[#8D6E63]">ì‹¤ì‹œê°„ í™•ì¸</p>
                    </div>
                </button>

                <!-- OTT (Blue Note) -->
                <button onclick="window.haptic(); window.showOttModal()" class="paper-card post-it-blue p-4 h-40 flex flex-col justify-between text-left hover:scale-[1.02] transition-transform">
                    <div class="flex justify-between w-full">
                        <i class="fa-solid fa-film text-2xl text-[#00BCD4]"></i>
                    </div>
                    <div>
                        <h3 class="text-xl text-[#006064] mb-1">ì˜í™”ê´€</h3>
                        <p class="text-xs text-[#00838F]">ì˜¤í”ˆ ì˜ˆì •!</p>
                    </div>
                </button>
            </div>

            <!-- List Section (Notebook Lines) -->
            <div class="paper-card bg-white p-5 mb-8 relative">
                <!-- Ring Binder Holes -->
                <div class="absolute top-4 left-3 w-3 h-3 rounded-full bg-[#E0E0E0] shadow-inner"></div>
                <div class="absolute bottom-4 left-3 w-3 h-3 rounded-full bg-[#E0E0E0] shadow-inner"></div>
                <div class="absolute top-1/2 left-3 w-3 h-3 rounded-full bg-[#E0E0E0] shadow-inner -translate-y-1/2"></div>
                
                <h3 class="text-sm text-[#8C837B] ml-6 mb-4 border-b-2 border-[#D7CCC8] pb-1 inline-block">ë” ë³´ê¸° ëª©ë¡</h3>
                
                <div class="space-y-4 ml-6">
                    <button onclick="window.haptic(); window.goToTravel()" class="w-full flex items-center justify-between group">
                        <div class="flex items-center gap-3">
                            <span class="w-6 text-center text-[#4CAF50]"><i class="fa-solid fa-plane"></i></span>
                            <span class="text-lg text-[#5D4037] border-b border-dashed border-transparent group-hover:border-[#8D6E63] transition-colors">ì—¬í–‰ ê¸°ë¡</span>
                        </div>
                        <i class="fa-solid fa-check text-[#D7CCC8]"></i>
                    </button>

                    <button onclick="window.haptic(); window.playGame()" class="w-full flex items-center justify-between group">
                        <div class="flex items-center gap-3">
                            <span class="w-6 text-center text-[#F06292]"><i class="fa-solid fa-dice"></i></span>
                            <span class="text-lg text-[#5D4037] border-b border-dashed border-transparent group-hover:border-[#8D6E63] transition-colors">ë³µë¶ˆë³µ ê²Œì„</span>
                        </div>
                        <i class="fa-solid fa-check text-[#D7CCC8]"></i>
                    </button>
                    
                    <button onclick="window.haptic(); window.showSecretModal()" class="w-full flex items-center justify-between opacity-50">
                        <div class="flex items-center gap-3">
                            <span class="w-6 text-center text-[#BDBDBD]"><i class="fa-solid fa-lock"></i></span>
                            <span class="text-lg text-[#9E9E9E]">ì¤€ë¹„ ì¤‘</span>
                        </div>
                    </button>
                </div>
            </div>
        </main>

        <!-- =======================
             2. ì¼ì • í™”ë©´ (Schedule)
             ======================= -->
        <div id="schedule-screen" class="screen-container">
            <header class="sticky top-0 z-20 px-6 pt-safe pb-4 flex justify-between items-end bg-[#FDFBF7]/95 backdrop-blur-sm border-b-2 border-dashed border-[#D7CCC8]">
                <h2 class="text-2xl text-[#4A4036]">ë‹¤ì´ì–´ë¦¬</h2>
                <div class="flex items-center gap-2">
                    <button onclick="window.haptic(); window.changeMonth(-1)" class="w-8 h-8 rounded-full hover:bg-[#EFEBE9] text-[#8D6E63]"><i class="fa-solid fa-caret-left text-lg"></i></button>
                    <span id="cal-title" class="text-lg text-[#5D4037] w-20 text-center pt-1">2024.05</span>
                    <button onclick="window.haptic(); window.changeMonth(1)" class="w-8 h-8 rounded-full hover:bg-[#EFEBE9] text-[#8D6E63]"><i class="fa-solid fa-caret-right text-lg"></i></button>
                </div>
            </header>

            <div class="px-6 pt-6 relative z-10">
                <!-- Calendar Card -->
                <div class="paper-card p-5 mb-6 bg-white rotate-1">
                    <div class="tape" style="top: -12px; left: 50%; transform: translateX(-50%) rotate(2deg); width: 60px;"></div>
                    <div class="grid grid-cols-7 text-center mb-4 pb-2 border-b-2 border-[#EFEBE9]">
                        <div class="text-sm text-[#E57373]">ì¼</div>
                        <div class="text-sm text-[#A1887F]">ì›”</div>
                        <div class="text-sm text-[#A1887F]">í™”</div>
                        <div class="text-sm text-[#A1887F]">ìˆ˜</div>
                        <div class="text-sm text-[#A1887F]">ëª©</div>
                        <div class="text-sm text-[#A1887F]">ê¸ˆ</div>
                        <div class="text-sm text-[#64B5F6]">í† </div>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 text-center gap-y-3"></div>
                </div>

                <!-- Event List Header -->
                <div class="flex justify-between items-center mb-4 px-1 border-l-4 border-[#FF8BA7] pl-3">
                    <h3 class="text-xl text-[#4A4036]" id="selected-date-title">ì¼ì • ëª©ë¡</h3>
                    <button onclick="window.haptic(); window.openAddScheduleModal()" class="bg-[#FF8BA7] text-white px-3 py-1.5 rounded-lg text-sm shadow-sm active:scale-95 transition-transform">
                        <i class="fa-solid fa-pencil mr-1"></i> ì“°ê¸°
                    </button>
                </div>
                <div id="event-list" class="space-y-3"></div>
            </div>
        </div>

        <!-- =======================
             3. ì›”ë › (Meeting/Wallet)
             ======================= -->
        <div id="meeting-screen" class="screen-container">
            <header class="sticky top-0 z-20 px-6 pt-safe pb-4 flex justify-between items-end bg-[#FDFBF7]/95 backdrop-blur-sm border-b-2 border-dashed border-[#D7CCC8]">
                <h2 class="text-2xl text-[#4A4036]">ê°€ê³„ë¶€</h2>
                <button onclick="window.haptic(); window.openPasswordModal()" class="bg-[#EFEBE9] px-3 py-1 rounded-lg text-xs text-[#8D6E63] border border-[#D7CCC8] shadow-sm active:scale-95">
                    ê´€ë¦¬ì
                </button>
            </header>

            <div class="px-6 pt-6 relative z-10">
                <!-- Wallet Card (Envelope Style) -->
                <div class="p-6 mb-8 rounded-lg bg-[#5D4037] text-[#FFF8E1] shadow-lg relative overflow-hidden group border-b-8 border-[#3E2723]">
                    <div class="absolute top-0 right-0 w-16 h-16 bg-[#8D6E63] rounded-bl-full opacity-50"></div>
                    
                    <div class="flex justify-between items-start mb-6 relative z-10">
                        <div class="flex items-center gap-2 opacity-90">
                            <i class="fa-solid fa-coins text-[#FFD54F]"></i>
                            <span class="text-sm">Enjoy Club</span>
                        </div>
                        <div class="w-8 h-8 rounded-full bg-[#FFD54F] border-2 border-[#FFA000] flex items-center justify-center text-[#5D4037] font-bold">$</div>
                    </div>
                    <div class="relative z-10 text-center py-2 bg-[#3E2723]/30 rounded-lg">
                        <p class="text-xs opacity-70 mb-1">í˜„ì¬ ëª¨ì¸ ëˆ</p>
                        <h3 id="total-balance" class="text-3xl tabular-nums tracking-wide">0ì›</h3>
                    </div>
                </div>

                <!-- Status Grid -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="paper-card p-4 text-center transform -rotate-1">
                        <div class="tape-corner bg-red-200"></div>
                        <div class="text-2xl mb-1">ğŸš¨</div>
                        <span class="text-sm font-bold text-[#5D4037] border-b-2 border-red-200">ë¯¸ë‚© ë‚´ì—­</span>
                        <div id="penalty-list-mini" class="mt-2 h-16 overflow-y-auto scrollbar-hide text-xs text-[#8D6E63] leading-relaxed"></div>
                    </div>
                    <div class="paper-card p-4 text-center transform rotate-1">
                        <div class="tape-corner bg-green-200"></div>
                        <div class="text-2xl mb-1">ğŸŸï¸</div>
                        <span class="text-sm font-bold text-[#5D4037] border-b-2 border-green-200">ë©´ì œê¶Œ</span>
                        <div id="ticket-list-mini" class="mt-2 h-16 overflow-y-auto scrollbar-hide text-xs text-[#8D6E63] leading-relaxed"></div>
                    </div>
                </div>

                <!-- Dues List -->
                <div class="mb-4 flex items-center justify-between px-1 border-b-2 border-[#D7CCC8] pb-2">
                    <h3 class="text-lg text-[#5D4037]">ë‚©ë¶€ ê¸°ë¡</h3>
                    <div class="flex items-center bg-white rounded-lg px-2 py-1 border border-[#E0E0E0] shadow-sm">
                        <button onclick="window.haptic(); window.changeDuesMonth(-1)" class="w-6 h-6 flex items-center justify-center text-[#8D6E63] active:scale-95"><i class="fa-solid fa-chevron-left text-xs"></i></button>
                        <span id="dues-month-title" class="text-sm text-[#5D4037] mx-2 pt-0.5 tabular-nums">12ì›”</span>
                        <button onclick="window.haptic(); window.changeDuesMonth(1)" class="w-6 h-6 flex items-center justify-center text-[#8D6E63] active:scale-95"><i class="fa-solid fa-chevron-right text-xs"></i></button>
                    </div>
                </div>
                <div id="dues-list" class="space-y-3"></div>
            </div>
        </div>

        <!-- ğŸŒ ë‚´ë¶€ ë¸Œë¼ìš°ì € (ìœ ì§€) -->
        <div id="browser-screen" class="hidden absolute inset-0 z-[100] flex-col bg-[#FDFBF7]">
            <div class="flex-1 relative w-full h-full bg-[#FDFBF7]">
                <div id="browser-loader" class="absolute inset-0 flex items-center justify-center text-[#FF8BA7] z-0">
                    <i class="fa-solid fa-circle-notch fa-spin text-3xl"></i>
                </div>
                <iframe id="internal-browser-frame" class="w-full h-full border-0 relative z-10 bg-transparent" allow="autoplay; encrypted-media" onload="document.getElementById('browser-loader').style.display='none'"></iframe>
            </div>
            <button onclick="window.closeBrowser()" class="absolute bottom-24 left-1/2 -translate-x-1/2 bg-[#4A4036] text-white px-6 py-3 rounded-xl text-lg shadow-lg z-20 active:scale-95 transform rotate-1 border-2 border-[#3E2723]">ë®ê¸° ğŸ“•</button>
        </div>

        <!-- =======================
             í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (Sketchbook Binder)
             ======================= -->
        <nav class="nav-paper">
            <button id="nav-home" class="nav-item active" onclick="window.haptic(); window.goHome()">
                <i class="fa-solid fa-house"></i>
                <span>í™ˆ</span>
            </button>
            <button id="nav-calendar" class="nav-item" onclick="window.haptic(); window.goSchedule()">
                <i class="fa-regular fa-calendar-check"></i>
                <span>ì¼ì •</span>
            </button>
            <button id="nav-meeting" class="nav-item" onclick="window.haptic(); window.goMeeting()">
                <i class="fa-solid fa-piggy-bank"></i>
                <span>í†µì¥</span>
            </button>
        </nav>

        <!-- =======================
             Modals (Paper Style)
             ======================= -->
        
        <!-- Admin Password Modal -->
        <div id="password-modal" class="absolute inset-0 z-[60] bg-[#4A4036]/50 backdrop-blur-sm hidden flex items-center justify-center px-6">
            <div class="paper-card p-8 w-full max-w-xs scale-in text-center bg-[#FFF8E1] border-4 border-[#5D4037]">
                <h3 class="text-xl text-[#5D4037] mb-6">ğŸ”’ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</h3>
                <div class="flex justify-center gap-2 mb-6">
                    <input type="password" id="admin-password-input" class="input-paper text-center tracking-[0.5em] text-xl bg-white" placeholder="****" maxlength="4" inputmode="numeric">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="window.haptic(); window.closeModal('password-modal')" class="bg-[#E0E0E0] text-[#757575] py-3 rounded-xl shadow-sm border-b-4 border-[#BDBDBD] active:border-b-0 active:translate-y-1 transition-all">ì·¨ì†Œ</button>
                    <button onclick="window.haptic(); window.checkPassword()" class="bg-[#FF8BA7] text-white py-3 rounded-xl shadow-sm border-b-4 border-[#F06292] active:border-b-0 active:translate-y-1 transition-all">í™•ì¸</button>
                </div>
            </div>
        </div>

        <!-- Admin Data Modal -->
        <div id="admin-modal" class="absolute inset-0 z-50 bg-[#4A4036]/50 backdrop-blur-sm hidden flex items-end sm:items-center justify-center sm:px-4 pb-4 sm:pb-0">
            <div class="paper-card w-full max-w-sm scale-in relative overflow-hidden max-h-[85vh] flex flex-col p-6 bg-[#FDFBF7]">
                <div class="flex justify-between items-center mb-6 border-b-2 border-dashed border-[#D7CCC8] pb-2">
                    <h3 class="text-xl text-[#5D4037]">ê´€ë¦¬ì ë…¸íŠ¸ <span class="text-[#FF8BA7] text-sm ml-2" id="admin-month-title"></span></h3>
                    <button onclick="window.haptic(); window.closeModal('admin-modal')" class="w-8 h-8 rounded-full bg-[#EFEBE9] flex items-center justify-center text-[#8D6E63] active:scale-95"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="overflow-y-auto flex-1 pr-1 space-y-6">
                    <!-- Backup -->
                    <div class="bg-[#E3F2FD] p-4 rounded-xl border-2 border-[#BBDEFB] border-dashed">
                        <label class="block text-sm text-[#1976D2] mb-3 flex items-center gap-1"><i class="fa-solid fa-floppy-disk"></i> ë°ì´í„° ë°±ì—…</label>
                        <div class="flex gap-2 mb-3">
                            <button onclick="window.createCloudBackup()" class="flex-1 bg-white text-[#1976D2] border border-[#1976D2] py-2 rounded-lg text-sm shadow-sm active:scale-95">
                                í˜„ì¬ ìƒíƒœ ì €ì¥
                            </button>
                        </div>
                        <div class="relative">
                            <select id="backup-select" class="input-paper text-sm p-2 mb-2 h-10 bg-white"></select>
                            <button onclick="window.restoreCloudBackup()" class="w-full bg-white text-[#D32F2F] border border-[#D32F2F] py-2 rounded-lg text-sm shadow-sm active:scale-95">
                                ì„ íƒ ì‹œì ìœ¼ë¡œ ë³µì›
                            </button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm text-[#8D6E63] mb-2">ì´ ì”ì•¡</label>
                        <input type="number" id="admin-total-balance" class="input-paper text-lg font-bold" placeholder="ê¸ˆì•¡">
                    </div>
                    <div>
                        <label class="block text-sm text-[#8D6E63] mb-2">ë©¤ë²„ ê´€ë¦¬</label>
                        <div id="admin-member-list" class="space-y-2"></div>
                    </div>
                    <div>
                        <label class="block text-sm text-[#8D6E63] mb-2">ë©´ì œê¶Œ</label>
                        <div id="admin-ticket-list" class="space-y-2"></div>
                    </div>
                </div>
                <div class="mt-6 pt-4 border-t-2 border-[#D7CCC8]">
                    <button onclick="window.haptic(); window.saveAdminData()" class="w-full bg-[#5D4037] text-[#FFF8E1] py-3 rounded-xl shadow-md border-b-4 border-[#3E2723] active:border-b-0 active:translate-y-1 transition-all">ì €ì¥ ì™„ë£Œ</button>
                </div>
            </div>
        </div>

        <!-- Schedule Modal -->
        <div id="schedule-modal" class="absolute inset-0 z-50 bg-[#4A4036]/50 backdrop-blur-sm hidden flex items-end sm:items-center justify-center sm:px-4 pb-4 sm:pb-0">
            <div class="paper-card w-full max-w-sm scale-in relative overflow-hidden flex flex-col p-6 bg-[#FFF9C4] rotate-1">
                <div class="tape" style="top:-15px;"></div>
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl text-[#5D4037]" id="sch-modal-title">ì¼ì • ì“°ê¸°</h3>
                    <button onclick="window.haptic(); window.closeModal('schedule-modal')" class="w-8 h-8 rounded-full bg-[#FFF176] flex items-center justify-center text-[#8D6E63] active:scale-95"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="space-y-4">
                    <input type="hidden" id="sch-edit-date-key">
                    <input type="hidden" id="sch-edit-index">
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2">
                             <label class="block text-xs text-[#8D6E63] mb-1 ml-1">ì¢…ë¥˜</label>
                            <select id="add-sch-category" class="input-paper bg-white">
                                <option value="meet">âœˆï¸ ëª¨ì„/ì—¬í–‰</option>
                                <option value="personal">ğŸ  ê°œì¸ ì¼ì •</option>
                                <option value="school">ğŸ“ í•™êµ/ì¢…ê°•</option>
                                <option value="bday">ğŸ‚ ìƒì¼</option>
                                <option value="etc">ğŸ¸ ê¸°íƒ€</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-[#8D6E63] mb-1 ml-1">ì‹œì‘</label>
                            <input type="date" id="add-sch-start-date" class="input-paper text-sm bg-white">
                        </div>
                        <div>
                            <label class="block text-xs text-[#8D6E63] mb-1 ml-1">ë</label>
                            <input type="date" id="add-sch-end-date" class="input-paper text-sm bg-white">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs text-[#8D6E63] mb-1 ml-1">ì‹œê°„</label>
                        <input type="text" id="add-sch-time" placeholder="ì˜ˆ: 19:00" class="input-paper bg-white">
                    </div>
                    <div>
                        <label class="block text-xs text-[#8D6E63] mb-1 ml-1">ë‚´ìš©</label>
                        <input type="text" id="add-sch-title" placeholder="ë¬´ìŠ¨ ì¼ì¸ê°€ìš”?" class="input-paper bg-white">
                    </div>
                </div>
                <div class="mt-8 flex gap-3">
                    <button id="sch-delete-btn" onclick="window.haptic(); window.deleteSchedule()" class="hidden flex-1 py-3 text-[#D32F2F] bg-[#FFCDD2] rounded-xl border-b-4 border-[#EF9A9A] active:border-b-0 active:translate-y-1">ì§€ìš°ê¸°</button>
                    <button id="sch-save-btn" onclick="window.haptic(); window.saveScheduleToFirebase()" class="flex-[2] py-3 text-white bg-[#4CAF50] rounded-xl border-b-4 border-[#388E3C] active:border-b-0 active:translate-y-1">ì ê¸°</button>
                </div>
            </div>
        </div>

        <!-- Common Alert Modal -->
        <div id="common-modal" class="absolute inset-0 z-[70] bg-[#4A4036]/50 backdrop-blur-sm hidden flex items-center justify-center px-6">
            <div class="paper-card p-8 w-full max-w-xs scale-in text-center bg-white border-2 border-[#D7CCC8]">
                <div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-5 text-3xl bg-[#FFF8E1] text-[#FFB300] shadow-sm" id="modal-icon-bg">
                    <i id="modal-icon" class=""></i>
                </div>
                <h3 class="text-xl text-[#5D4037] mb-3" id="modal-title">ì•Œë¦¼</h3>
                <p class="text-[#8D6E63] text-sm mb-8 leading-relaxed break-keep" id="modal-desc">ë‚´ìš©</p>
                <button onclick="window.haptic(); window.closeModal('common-modal')" class="w-full bg-[#5D4037] text-white py-3 rounded-xl border-b-4 border-[#3E2723] active:border-b-0 active:translate-y-1 transition-all">ì•Œê² ì–´!</button>
            </div>
        </div>

    </div> <!-- End of Mobile Frame -->

    <!-- =======================
             Logic Scripts
             ======================= -->
    <script>
        // Global Variables
        window.meetingData = null;
        window.currentDuesMonth = new Date().getMonth() + 1;
        window.dynamicEvents = {};
        window.viewYear = new Date().getFullYear();
        window.viewMonth = new Date().getMonth();
        window.activeTabIndex = 0;

        // Helper Functions
        window.haptic = function() { if (navigator.vibrate) navigator.vibrate(10); }
        window.closeModal = (id) => { document.getElementById(id).classList.add('hidden'); document.getElementById(id).classList.remove('flex'); };
        window.showModal = (id) => { document.getElementById(id).classList.remove('hidden'); document.getElementById(id).classList.add('flex'); };
        
        window.openBrowser = function(url) {
            const screen = document.getElementById('browser-screen');
            const frame = document.getElementById('internal-browser-frame');
            const loader = document.getElementById('browser-loader');
            loader.style.display = 'flex';
            frame.src = url;
            screen.classList.remove('hidden');
            screen.classList.add('flex');
        };

        window.closeBrowser = function() {
            const screen = document.getElementById('browser-screen');
            const frame = document.getElementById('internal-browser-frame');
            screen.classList.add('hidden');
            screen.classList.remove('flex');
            frame.src = '';
        };

        window.setGreeting = function() { /* Handled in HTML */ }

        window.showTravelModal = () => { const m = document.getElementById('common-modal'); document.getElementById('modal-title').innerText = 'ì¤€ë¹„ ì¤‘'; document.getElementById('modal-desc').innerHTML = 'ì—¬í–‰ ê¸°ë¡ ì„œë¹„ìŠ¤ëŠ”<br>ê³§ ì„œë¹„ìŠ¤ê°€ ë  ì˜ˆì •ì´ì—ìš” âœˆï¸'; document.getElementById('modal-icon').className = 'fa-solid fa-plane'; m.classList.remove('hidden'); m.classList.add('flex'); };
        window.showSecretModal = () => { const m = document.getElementById('common-modal'); document.getElementById('modal-title').innerText = 'ë¹„ë°€'; document.getElementById('modal-desc').innerHTML = 'ì•„ì§ì€ ë³¼ ìˆ˜ ì—†ì–´ìš”.<br>ë‚˜ì¤‘ì— ë‹¤ì‹œ ì™€ì£¼ì„¸ìš”! ğŸ”’'; document.getElementById('modal-icon').className = 'fa-solid fa-lock'; m.classList.remove('hidden'); m.classList.add('flex'); };
        window.showOttModal = () => { const m = document.getElementById('common-modal'); document.getElementById('modal-title').innerText = 'ì˜¤í”ˆ ì˜ˆì •'; document.getElementById('modal-desc').innerHTML = '2025ë…„ ë§ ì˜¤í”ˆ ì˜ˆì •!<br>íŒì½˜ ë“¤ê³  ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” ğŸ¿'; document.getElementById('modal-icon').className = 'fa-solid fa-film'; m.classList.remove('hidden'); m.classList.add('flex'); };
        
        window.openPasswordModal = function() { document.getElementById('admin-password-input').value = ''; document.getElementById('password-modal').classList.remove('hidden'); document.getElementById('password-modal').classList.add('flex'); };
        window.checkPassword = function() { const pw = document.getElementById('admin-password-input').value; if (pw === '0920') { window.closeModal('password-modal'); window.openAdminModalReal(); } else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”!'); } };
        
        window.openAdminModalReal = function() { 
            if (!window.meetingData) window.meetingData = getInitialMeetingData(); 
            const modal = document.getElementById('admin-modal'); modal.classList.remove('hidden'); modal.classList.add('flex'); 
            document.getElementById('admin-month-title').innerText = `${window.currentDuesMonth}ì›”`; 
            document.getElementById('admin-total-balance').value = window.meetingData.totalBalance || 0; 
            
            const list = document.getElementById('admin-member-list'); list.innerHTML = ''; 
            if (!window.meetingData.records[window.currentDuesMonth]) window.meetingData.records[window.currentDuesMonth] = createEmptyMonthData(); 
            const records = window.meetingData.records[window.currentDuesMonth]; 
            records.forEach((m, i) => { const isPaid = m.status === 'paid'; list.innerHTML += `<div class="flex items-center justify-between p-3 bg-white border border-[#E0E0E0] rounded-xl mb-2"><span class="text-sm text-[#5D4037]">${m.name}</span><div class="flex items-center gap-2"><input type="number" id="edit-amt-${i}" class="w-20 text-right text-xs p-2 bg-[#F5F5F5] rounded-lg outline-none font-bold" value="${m.amount}"><button onclick="window.togglePay(${i})" class="text-[11px] px-3 py-2 rounded-lg transition-all ${isPaid ? 'bg-[#E8F5E9] text-[#2E7D32]' : 'bg-[#FFEBEE] text-[#C62828]'}">${isPaid ? 'ë‚©ë¶€' : 'ë¯¸ë‚©'}</button></div></div>`; }); 
            
            const ticketList = document.getElementById('admin-ticket-list'); ticketList.innerHTML = '';
            const members = ['í™ë°•ì‚¬', 'ë¥˜ì§±', 'ì˜¤ìŠ¤í‹´', 'ì „ì‹œê¸°', 'ì´ì§„ëˆ„', 'ì„±ì›ì œ'];
            const exemptions = window.meetingData.exemptions || { 'ë¥˜ì§±': 1, 'ì„±ì›ì œ': 1, 'ì „ì‹œê¸°': 1 };
            members.forEach((name, i) => {
                const count = exemptions[name] || 0;
                ticketList.innerHTML += `<div class="flex items-center justify-between p-3 bg-white border border-[#E0E0E0] rounded-xl mb-2"><span class="text-sm text-[#5D4037]">${name}</span><div class="flex items-center gap-2"><button onclick="window.updateExemption('${name}', -1)" class="w-8 h-8 rounded-lg bg-[#EFEBE9] text-[#8D6E63] flex items-center justify-center active:scale-95">-</button><span id="admin-ticket-${name}" class="font-bold text-sm w-6 text-center text-[#5D4037]">${count}</span><button onclick="window.updateExemption('${name}', 1)" class="w-8 h-8 rounded-lg bg-[#EFEBE9] text-[#8D6E63] flex items-center justify-center active:scale-95">+</button></div></div>`;
            });
            if(window.fetchBackupList) window.fetchBackupList();
        };

        window.updateExemption = function(name, delta) {
            const el = document.getElementById(`admin-ticket-${name}`);
            let val = parseInt(el.innerText);
            val += delta;
            if(val < 0) val = 0;
            el.innerText = val;
            if(!window.meetingData.exemptions) window.meetingData.exemptions = { 'ë¥˜ì§±': 1, 'ì„±ì›ì œ': 1, 'ì „ì‹œê¸°': 1 };
            window.meetingData.exemptions[name] = val;
        }

        window.togglePay = function(idx) { 
            const records = window.meetingData.records[window.currentDuesMonth]; 
            if(records && records[idx]) { 
                const m = records[idx]; 
                if(m.status === 'paid') { m.status = 'unpaid'; m.amount = 0; } 
                else { m.status = 'paid'; m.amount = 15000; } 
                const row = document.getElementById('admin-member-list').children[idx]; 
                row.querySelector('input').value = m.amount; 
                const btn = row.querySelector('button'); 
                btn.className = `text-[11px] px-3 py-2 rounded-lg transition-all ${m.status === 'paid' ? 'bg-[#E8F5E9] text-[#2E7D32]' : 'bg-[#FFEBEE] text-[#C62828]'}`; 
                btn.innerText = m.status === 'paid' ? 'ë‚©ë¶€' : 'ë¯¸ë‚©'; 
            } 
        };
        
        window.saveAdminData = async function() { 
            if (!window.meetingData || !window.meetingDb) { alert("DB ì˜¤ë¥˜"); return; } 
            const bal = parseInt(document.getElementById('admin-total-balance').value) || 0; 
            window.meetingData.totalBalance = bal; 
            const records = window.meetingData.records[window.currentDuesMonth]; 
            if(records) { records.forEach((m, i) => { const val = document.getElementById(`edit-amt-${i}`).value; m.amount = parseInt(val) || 0; }); } 
            if(!window.meetingData.exemptions) window.meetingData.exemptions = { 'ë¥˜ì§±': 1, 'ì„±ì›ì œ': 1, 'ì „ì‹œê¸°': 1 };
            try { await window.setDoc(window.doc(window.meetingDb, ...window.MEETING_PATH), window.meetingData); alert('ì €ì¥ ì™„ë£Œ! ğŸ“'); window.closeModal('admin-modal'); } catch (e) { console.error(e); alert('ì €ì¥ ì‹¤íŒ¨'); } 
        };
        
        window.saveScheduleToFirebase = async function() { 
            if (!window.meetingDb) { alert('DB ì˜¤ë¥˜'); return; } 
            const category = document.getElementById('add-sch-category').value; 
            const startDateStr = document.getElementById('add-sch-start-date').value; 
            let endDateStr = document.getElementById('add-sch-end-date').value; 
            const time = document.getElementById('add-sch-time').value || 'í•˜ë£¨ ì¢…ì¼'; 
            const title = document.getElementById('add-sch-title').value; 
            const editKey = document.getElementById('sch-edit-date-key').value; 
            const editIdx = document.getElementById('sch-edit-index').value; 
            const isEdit = (editKey && editIdx !== ''); 
            if (!startDateStr || !title) { alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
            if (!endDateStr) endDateStr = startDateStr; 
            if (endDateStr < startDateStr) { alert('ë‚ ì§œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”'); return; }
            const newEvent = { type: category, title: title, time: time }; 
            try { 
                const docRef = window.doc(window.meetingDb, ...window.SCHEDULE_PATH);
                const docSnap = await window.getDoc(docRef);
                let data = docSnap.exists() ? docSnap.data() : {};
                if(isEdit) { 
                    const oldList = data[editKey]; 
                    if(oldList) { 
                        oldList.splice(editIdx, 1); 
                        if(oldList.length === 0) delete data[editKey]; 
                        else data[editKey] = oldList; 
                    } 
                } 
                const start = new Date(startDateStr);
                const end = new Date(endDateStr);
                for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                    const dateKey = d.toISOString().split('T')[0];
                    const list = data[dateKey] || [];
                    list.push(newEvent);
                    data[dateKey] = list;
                }
                await window.setDoc(docRef, data); 
                alert(isEdit ? 'ìˆ˜ì •í–ˆì–´ìš”!' : 'ì ì—ˆì–´ìš”!'); 
                window.closeModal('schedule-modal'); 
            } catch (e) { console.error(e); alert('ì‹¤íŒ¨'); } 
        };

        window.deleteSchedule = async function() { if(!confirm('ì •ë§ ì§€ìš¸ê¹Œìš”?')) return; const dateKey = document.getElementById('sch-edit-date-key').value; const index = document.getElementById('sch-edit-index').value; try { const docSnap = await window.getDoc(window.doc(window.meetingDb, ...window.SCHEDULE_PATH)); if(docSnap.exists()) { const data = docSnap.data(); const list = data[dateKey]; if(list) { list.splice(index, 1); if(list.length === 0) delete data[dateKey]; else data[dateKey] = list; await window.setDoc(window.doc(window.meetingDb, ...window.SCHEDULE_PATH), data); alert('ì§€ì› ì–´ìš”.'); window.closeModal('schedule-modal'); } } } catch(e) { console.error(e); alert('ì‹¤íŒ¨'); } }
        window.changeDuesMonth = function(delta) { window.currentDuesMonth += delta; if (window.currentDuesMonth < 1) window.currentDuesMonth = 12; if (window.currentDuesMonth > 12) window.currentDuesMonth = 1; window.renderDues(window.currentDuesMonth); }
        
        window.updateMeetingUI = function(data) { 
            if (data.records) {
                Object.keys(data.records).forEach(month => {
                    data.records[month].forEach(member => {
                        if (member.name === 'ì§€ë…¸') member.name = 'ì´ì§„ëˆ„';
                    });
                });
            }
            if (data.exemptions && data.exemptions['ì§€ë…¸'] !== undefined) {
                data.exemptions['ì´ì§„ëˆ„'] = (data.exemptions['ì´ì§„ëˆ„'] || 0) + data.exemptions['ì§€ë…¸'];
                delete data.exemptions['ì§€ë…¸'];
            }

            window.meetingData = data; 
            if (!window.meetingData.exemptions) {
                window.meetingData.exemptions = { 'ë¥˜ì§±': 1, 'ì„±ì›ì œ': 1, 'ì „ì‹œê¸°': 1 };
            }
            const balanceEl = document.getElementById('total-balance'); 
            const balanceStr = (data.totalBalance || 0).toLocaleString();
            if (balanceEl) balanceEl.innerText = balanceStr + "ì›"; 
            window.renderDues(window.currentDuesMonth); 
        };
        
        window.openAddScheduleModal = () => { 
            document.getElementById('sch-modal-title').innerText = 'ì¼ì • ì“°ê¸°'; 
            document.getElementById('sch-delete-btn').classList.add('hidden'); 
            document.getElementById('sch-save-btn').innerText = 'ì ê¸°'; 
            document.getElementById('sch-edit-date-key').value = ''; 
            document.getElementById('sch-edit-index').value = ''; 
            document.getElementById('add-sch-title').value = ''; 
            document.getElementById('add-sch-time').value = ''; 
            document.getElementById('add-sch-start-date').value = ''; 
            document.getElementById('add-sch-end-date').value = ''; 
            document.getElementById('schedule-modal').classList.remove('hidden'); 
            document.getElementById('schedule-modal').classList.add('flex'); 
        };

        window.openEditScheduleModal = (dateStr, index) => { 
            if (!dateStr) { window.openAddScheduleModal(); return; } 
            document.getElementById('sch-modal-title').innerText = 'ê³ ì³ ì“°ê¸°'; 
            document.getElementById('sch-delete-btn').classList.remove('hidden'); 
            document.getElementById('sch-save-btn').innerText = 'ê³ ì¹˜ê¸°'; 
            document.getElementById('sch-edit-date-key').value = dateStr; 
            document.getElementById('sch-edit-index').value = index; 
            const list = window.dynamicEvents[dateStr]; 
            if(list && list[index]) { 
                const event = list[index]; 
                document.getElementById('add-sch-category').value = event.type; 
                document.getElementById('add-sch-start-date').value = dateStr; 
                document.getElementById('add-sch-end-date').value = dateStr; 
                document.getElementById('add-sch-time').value = event.time; 
                document.getElementById('add-sch-title').value = event.title; 
            } 
            document.getElementById('schedule-modal').classList.remove('hidden'); 
            document.getElementById('schedule-modal').classList.add('flex'); 
        };

        window.goToMusic = () => window.openBrowser("https://won429.github.io/enjoy/");
        window.playGame = () => window.location.href = "game.html";
        window.goToTravel = () => window.openBrowser("https://won429.github.io/enjoy_trip/");
        
        window.goHome = () => { window.updateTabUI(0); }
        window.goSchedule = () => { window.updateTabUI(1); }
        window.goMeeting = () => { window.updateTabUI(2); }
        window.changeMonth = (delta) => { window.viewMonth += delta; if (window.viewMonth < 0) { window.viewYear--; window.viewMonth = 11; } else if (window.viewMonth > 11) { window.viewYear++; window.viewMonth = 0; } window.renderCalendar(window.viewYear, window.viewMonth); }

        function createEmptyMonthData() { const members = ['í™ë°•ì‚¬', 'ë¥˜ì§±', 'ì˜¤ìŠ¤í‹´', 'ì „ì‹œê¸°', 'ì´ì§„ëˆ„', 'ì„±ì›ì œ']; return members.map(name => ({ name: name, status: 'unpaid', amount: 0, isLeader: name === 'ì „ì‹œê¸°' })); }
        function getInitialMeetingData() { 
            return { 
                totalBalance: 448999, 
                exemptions: { 'ë¥˜ì§±': 1, 'ì„±ì›ì œ': 1, 'ì „ì‹œê¸°': 1 },
                records: { 
                    10: [ { name: 'ì˜¤ìŠ¤í‹´', status: 'unpaid', amount: 0, penalty: 'ë¯¸ë‚©ë¶€ë¡œ ì¸í•œ ë¶€ê³¼ê¸ˆ 10,000ì› ë°œìƒ' }, { name: 'í™ë°•ì‚¬', status: 'paid', amount: 15000 }, { name: 'ë¥˜ì§±', status: 'paid', amount: 15000 }, { name: 'ì „ì‹œê¸°', status: 'paid', amount: 15000, isLeader: true }, { name: 'ì´ì§„ëˆ„', status: 'paid', amount: 15000 }, { name: 'ì„±ì›ì œ', status: 'paid', amount: 15000 } ], 
                    11: [ { name: 'í™ë°•ì‚¬', status: 'paid', amount: 15000 }, { name: 'ë¥˜ì§±', status: 'paid', amount: 16000 }, { name: 'ì˜¤ìŠ¤í‹´', status: 'paid', amount: 15000 }, { name: 'ì „ì‹œê¸°', status: 'paid', amount: 15000, isLeader: true }, { name: 'ì´ì§„ëˆ„', status: 'paid', amount: 15000 }, { name: 'ì„±ì›ì œ', status: 'paid', amount: 15000 } ], 
                    12: [ { name: 'í™ë°•ì‚¬', status: 'paid', amount: 15000 }, { name: 'ë¥˜ì§±', status: 'unpaid', amount: 0 }, { name: 'ì˜¤ìŠ¤í‹´', status: 'unpaid', amount: 0 }, { name: 'ì „ì‹œê¸°', status: 'unpaid', amount: 0, isLeader: true }, { name: 'ì´ì§„ëˆ„', status: 'unpaid', amount: 0 }, { name: 'ì„±ì›ì œ', status: 'unpaid', amount: 0 } ] 
                } 
            }; 
        }
        
        // Colors for Paper Style
        const memberColors = { 
            'í™ë°•ì‚¬': { bg: 'bg-[#E3F2FD]', text: 'text-[#1976D2]', char: 'í™' }, 
            'ë¥˜ì§±': { bg: 'bg-[#F3E5F5]', text: 'text-[#9C27B0]', char: 'ë¥˜' }, 
            'ì˜¤ìŠ¤í‹´': { bg: 'bg-[#E8F5E9]', text: 'text-[#388E3C]', char: 'ì˜¤' }, 
            'ì „ì‹œê¸°': { bg: 'bg-[#FFF3E0]', text: 'text-[#F57C00]', char: 'ì „' }, 
            'ì´ì§„ëˆ„': { bg: 'bg-[#E8EAF6]', text: 'text-[#3F51B5]', char: 'ì´' }, 
            'ì„±ì›ì œ': { bg: 'bg-[#FFEBEE]', text: 'text-[#D32F2F]', char: 'ì„±' } 
        };
        
        window.renderMeetingStatus = function() {
            const penaltyListMini = document.getElementById('penalty-list-mini');
            const ticketListMini = document.getElementById('ticket-list-mini');
            
            if (!penaltyListMini || !ticketListMini) return;
            if (!window.meetingData) window.meetingData = getInitialMeetingData();
            
            const now = new Date(); const currentRealMonth = now.getMonth() + 1;
            let hasPenalty = false;
            let htmlPenalty = '';
            
            if (window.meetingData && window.meetingData.records) {
                for(let m=1; m < currentRealMonth; m++) {
                    const records = window.meetingData.records[m] || [];
                    records.forEach(mem => {
                        if(mem.status === 'unpaid') {
                             hasPenalty = true; 
                             htmlPenalty += `
                             <div class="flex items-center justify-between py-1 border-b border-[#E0D8D0] last:border-0 border-dashed">
                                <div class="flex items-center gap-2">
                                    <div class="w-1.5 h-1.5 rounded-full bg-[#E57373]"></div>
                                    <span class="text-xs text-[#5D4037]">${mem.name}</span>
                                    <span class="text-[10px] text-[#A1887F]">(${m}ì›”)</span>
                                </div>
                                <span class="text-xs font-bold text-[#E57373]">25,000</span>
                             </div>`;
                        }
                    });
                }
            }
            if (!hasPenalty) htmlPenalty = `<div class="h-full flex items-center justify-center text-xs text-[#A1887F]">ê¹¨ë—í•´! âœ¨</div>`;
            penaltyListMini.innerHTML = htmlPenalty;

            let hasTicket = false;
            let htmlTicket = '';
            const exemptions = window.meetingData.exemptions || { 'ë¥˜ì§±': 1, 'ì„±ì›ì œ': 1, 'ì „ì‹œê¸°': 1 };
            for (const [name, count] of Object.entries(exemptions)) {
                if (count > 0) {
                    hasTicket = true;
                    htmlTicket += `
                    <div class="flex items-center justify-between py-1 border-b border-[#E0D8D0] last:border-0 border-dashed">
                        <div class="flex items-center gap-2">
                            <div class="w-1.5 h-1.5 rounded-full bg-[#81C784]"></div>
                            <span class="text-xs text-[#5D4037]">${name}</span>
                        </div>
                        <span class="text-[10px] bg-[#E8F5E9] text-[#388E3C] px-1.5 rounded">${count}ê°œ</span>
                    </div>`;
                }
            }
            if (!hasTicket) htmlTicket = `<div class="h-full flex items-center justify-center text-xs text-[#A1887F]">ì—†ì–´...</div>`;
            ticketListMini.innerHTML = htmlTicket;
        }

        window.renderDues = function(month) {
            const list = document.getElementById('dues-list'); const title = document.getElementById('dues-month-title'); if(!list) return; title.innerText = `${month}ì›”`; list.innerHTML = '';
            if (!window.meetingData) window.meetingData = getInitialMeetingData();
            if(window.activeTabIndex === 2) window.renderMeetingStatus();
            
            let records = []; 
            if (window.meetingData && window.meetingData.records && window.meetingData.records[month]) { 
                records = window.meetingData.records[month]; 
            } else {
                records = createEmptyMonthData(); 
            }

            if (records.length === 0) { list.innerHTML = `<div class="text-center py-8 text-[#A1887F] text-xs">ê¸°ë¡ì´ ì—†ì–´ìš”.</div>`; return; }
            records.forEach((m, i) => {
                const c = memberColors[m.name] || { bg: 'bg-[#F5F5F5]', text: 'text-[#757575]', char: '?' }; const isPaid = m.status === 'paid'; 
                // Paper List Item
                list.innerHTML += `
                <div class="paper-card p-3 flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full ${c.bg} flex items-center justify-center text-xs font-bold ${c.text} border border-[#E0E0E0]">${c.char}</div>
                        <div>
                            <div class="flex items-center gap-1">
                                <span class="text-sm text-[#4A4036]">${m.name}</span>
                                ${m.isLeader ? '<i class="fa-solid fa-crown text-[#FFB74D] text-[10px]"></i>' : ''}
                            </div>
                            <span class="text-[10px] ${isPaid ? 'text-[#388E3C]' : 'text-[#D32F2F]'}">${isPaid ? 'ì™„ë£Œ' : 'ë¯¸ë‚©'}</span>
                        </div>
                    </div>
                    <span class="text-sm font-bold ${isPaid ? 'text-[#4A4036]' : 'text-[#D32F2F]'}">${isPaid ? m.amount.toLocaleString()+'ì›' : 'ë¯¸ë‚©'}</span>
                </div>`;
            });
        };
        
        window.getHolidays = function(y, m) {
            const e = {}; const p = `${y}-${String(m).padStart(2,'0')}`;
            if(m===1) e[`${p}-01`] = [{type:'holiday', title:'ì‹ ì •', time:'ë¹¨ê°„ë‚ '}];
            if(m===3) e[`${p}-01`] = [{type:'holiday', title:'ì‚¼ì¼ì ˆ', time:'ë¹¨ê°„ë‚ '}];
            if(m===5) e[`${p}-05`] = [{type:'holiday', title:'ì–´ë¦°ì´ë‚ ', time:'ë¹¨ê°„ë‚ '}];
            if(m===6) e[`${p}-06`] = [{type:'holiday', title:'í˜„ì¶©ì¼', time:'ë¹¨ê°„ë‚ '}];
            if(m===7) e[`${p}-17`] = [{type:'holiday', title:'ì œí—Œì ˆ', time:'êµ­ê²½ì¼'}]; 
            if(m===8) e[`${p}-15`] = [{type:'holiday', title:'ê´‘ë³µì ˆ', time:'ë¹¨ê°„ë‚ '}];
            if(m===10) { e[`${p}-03`] = (e[`${p}-03`]||[]).concat([{type:'holiday', title:'ê°œì²œì ˆ', time:'ë¹¨ê°„ë‚ '}]); e[`${p}-09`] = (e[`${p}-09`]||[]).concat([{type:'holiday', title:'í•œê¸€ë‚ ', time:'ë¹¨ê°„ë‚ '}]); }
            if(m===12) e[`${p}-25`] = [{type:'holiday', title:'ì„±íƒ„ì ˆ', time:'ë¹¨ê°„ë‚ '}];
            const lunarHolidays = {
                2024: { 2: {9:'ì„¤ë‚ ', 10:'ì„¤ë‚ ', 11:'ì„¤ë‚ ', 12:'ëŒ€ì²´'}, 4:{10:'ì„ ê±°'}, 5:{6:'ëŒ€ì²´', 15:'ì„íƒ„ì¼'}, 9:{16:'ì¶”ì„', 17:'ì¶”ì„', 18:'ì¶”ì„'} },
                2025: { 1: {28:'ì„¤ë‚ ', 29:'ì„¤ë‚ ', 30:'ì„¤ë‚ '}, 3:{3:'ëŒ€ì²´'}, 5:{5:'ì„íƒ„ì¼', 6:'ëŒ€ì²´'}, 10:{3:'ê°œì²œì ˆ', 5:'ì¶”ì„', 6:'ì¶”ì„', 7:'ì¶”ì„', 8:'ëŒ€ì²´', 9:'í•œê¸€ë‚ '} },
                2026: { 2: {16:'ì„¤ë‚ ', 17:'ì„¤ë‚ ', 18:'ì„¤ë‚ '}, 5:{24:'ì„íƒ„ì¼', 25:'ëŒ€ì²´'}, 9:{24:'ì¶”ì„', 25:'ì¶”ì„', 26:'ì¶”ì„'} },
                2027: { 2: {6:'ì„¤ë‚ ', 7:'ì„¤ë‚ ', 8:'ì„¤ë‚ ', 9:'ëŒ€ì²´'}, 5:{13:'ì„íƒ„ì¼'}, 9:{14:'ì¶”ì„', 15:'ì¶”ì„', 16:'ì¶”ì„'} },
                2028: { 1: {26:'ì„¤ë‚ ', 27:'ì„¤ë‚ ', 28:'ì„¤ë‚ '}, 5:{2:'ì„íƒ„ì¼'}, 10:{2:'ì¶”ì„', 3:'ì¶”ì„', 4:'ì¶”ì„'} },
                2029: { 2: {12:'ì„¤ë‚ ', 13:'ì„¤ë‚ ', 14:'ì„¤ë‚ '}, 5:{20:'ì„íƒ„ì¼'}, 9:{21:'ì¶”ì„', 22:'ì¶”ì„', 23:'ì¶”ì„'} },
                2030: { 2: {2:'ì„¤ë‚ ', 3:'ì„¤ë‚ ', 4:'ì„¤ë‚ ', 5:'ëŒ€ì²´'}, 5:{9:'ì„íƒ„ì¼'}, 9:{12:'ì¶”ì„', 13:'ì¶”ì„', 14:'ì¶”ì„'} }
            };
            const yearData = lunarHolidays[y];
            if (yearData && yearData[m]) {
                Object.keys(yearData[m]).forEach(day => {
                    const dayKey = `${p}-${String(day).padStart(2,'0')}`;
                    const title = yearData[m][day];
                    e[dayKey] = (e[dayKey] || []).concat([{type:'holiday', title: title, time: 'ë¹¨ê°„ë‚ '}]);
                });
            }
            return e;
        }

        window.getMergedEvents = function(year, month) {
            const events = {}; const keyPrefix = `${year}-${String(month).padStart(2, '0')}`;
            const holidays = window.getHolidays(year, month); Object.keys(holidays).forEach(k => { events[k] = (events[k] || []).concat(holidays[k]); });
            events[`${keyPrefix}-06`] = (events[`${keyPrefix}-06`]||[]).concat([{ type: 'dues', title: 'íšŒë¹„ ë‚´ëŠ” ë‚ ', time: '15,000ì›' }]);
            const birthdays = { '01-02': 'ì „ì‹œê¸° ìƒì¼', '03-22': 'ì´ì§„ëˆ„ ìƒì¼', '04-01': 'ì˜¤ìŠ¤í‹´ ìƒì¼', '06-05': 'í™ë°•ì‚¬ ìƒì¼', '06-12': 'ë¥˜ì§± ìƒì¼', '10-15': 'ì„±ì›ì œ ìƒì¼' }; Object.entries(birthdays).forEach(([d, t]) => { const [m, day] = d.split('-'); if (parseInt(m) === month) { const k = `${keyPrefix}-${day}`; events[k] = (events[k] || []).concat([{ type: 'bday', title: t, time: 'í•˜ë£¨ ì¢…ì¼' }]); } });
            if(month===6) { const l = new Date(year, month, 0).getDate(); const a = year - 2024; for(let i=1; i<=l; i++) { const k = `${keyPrefix}-${String(i).padStart(2,'0')}`; events[k] = (events[k]||[]).concat([{type:'anniv', title:`ì—”ì¡°ì´ ${a}ì£¼ë…„`, time:'ê¸°ë…ì¼'}]); } }
            if (year === 2025 && month === 12) { events[`${keyPrefix}-12`] = (events[`${keyPrefix}-12`]||[]).concat([{type:'school', title:'ìš°ì†¡ëŒ€ ì¢…ê°•', time:'í•™êµ'}]); events[`${keyPrefix}-20`] = (events[`${keyPrefix}-20`]||[]).concat([{type:'school', title:'ì•ˆë™ëŒ€ ì¢…ê°•', time:'í•™êµ'}]); }
            if (year === 2025 && month === 2) { ['05', '06', '07'].forEach(day => { const k = `${keyPrefix}-${day}`; events[k] = (events[k]||[]).concat([{type:'meet', title:'ëŒ€êµ¬ ì—¬í–‰', time:'ì—¬í–‰'}]); }); }
            if (year === 2025 && month === 8) { ['29', '30'].forEach(day => { const k = `${keyPrefix}-${day}`; events[k] = (events[k]||[]).concat([{type:'meet', title:'ì§„ì£¼ ì—¬í–‰', time:'ì—¬í–‰'}]); }); }
            const lastDay = new Date(year, month, 0).getDate(); for(let i=1; i<=lastDay; i++) { const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(i).padStart(2, '0')}`; const currentDate = new Date(dateStr); const sanghoonStart = new Date('2025-12-23'); const sanghoonEnd = new Date('2026-01-22'); if (currentDate >= sanghoonStart && currentDate <= sanghoonEnd) { if(i===1 || currentDate.getTime() === sanghoonStart.getTime()) { events[dateStr] = (events[dateStr]||[]).concat([{type:'personal', title:'ìƒí›ˆ ì¼ì •', time:'ì¥ê¸°'}]); } else { events[dateStr] = (events[dateStr]||[]).concat([{type:'personal_dot', title:'ìƒí›ˆ ì¼ì •', time:''}]); } } }
            if (window.dynamicEvents) { Object.keys(window.dynamicEvents).forEach(k => { const [dy, dm, dd] = k.split('-').map(Number); if (dy === year && dm === month) { const list = window.dynamicEvents[k]; if(Array.isArray(list)) { const taggedList = list.map(e => ({...e, isFirebase: true})); events[k] = (events[k] || []).concat(taggedList); } } }); }
            return events;
        }

        window.renderCalendar = function(year, month) { 
            const grid = document.getElementById('calendar-grid'); const title = document.getElementById('cal-title'); const list = document.getElementById('event-list'); if(!grid) return; 
            title.innerText = `${year}.${String(month + 1).padStart(2, '0')}`; grid.innerHTML = ''; list.innerHTML = ''; 
            const firstDay = new Date(year, month, 1).getDay(); const lastDate = new Date(year, month + 1, 0).getDate(); 
            const events = window.getMergedEvents(year, month + 1); 
            
            for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`; 
            
            let hasEvents = false; 
            for(let i=1; i<=lastDate; i++) { 
                const dKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`; 
                const dayEvts = events[dKey]; 
                const isToday = (i === new Date().getDate() && month === new Date().getMonth() && year === new Date().getFullYear()); 
                let dots = ''; 
                if(dayEvts) { 
                    hasEvents = true; 
                    dayEvts.forEach(e => { 
                        let c = 'bg-[#64B5F6]'; 
                        if(e.type==='holiday') c='bg-[#E57373]'; else if(e.type==='dues') c='bg-[#81C784]'; else if(e.type==='bday') c='bg-[#FFB74D]'; else if(e.type==='meet') c='bg-[#BA68C8]'; else if(e.type==='anniv') c='bg-[#F06292]'; else if(e.type==='personal') c='bg-[#BDBDBD]'; else if(e.type==='personal_dot') c='bg-[#E0E0E0]'; 
                        if(e.type!=='holiday') dots += `<div class="w-1.5 h-1.5 rounded-full ${c} mx-[1px]"></div>`; 
                    }); 
                } 
                let dateClass = 'text-[#8C837B] text-sm'; const dayOfWeek = new Date(year, month, i).getDay(); 
                if (dayOfWeek === 0) dateClass = 'text-[#E57373] font-bold text-sm'; 
                if(dayEvts && dayEvts.some(e => e.type === 'holiday')) dateClass = 'text-[#E57373] font-bold text-sm'; 
                if(isToday) dateClass = 'text-white bg-[#FF8BA7] rounded-full w-6 h-6 flex items-center justify-center font-bold text-sm mx-auto shadow-sm'; 
                
                grid.innerHTML += `
                <div class="h-10 flex flex-col items-center justify-start py-1 cursor-pointer hover:bg-[#F5F5F5] rounded-lg transition-colors">
                    <span class="${dateClass} mb-1 block">${i}</span>
                    <div class="flex justify-center flex-wrap px-1 h-2 overflow-hidden">${dots}</div>
                </div>`; 
                
                if(dayEvts) { 
                    dayEvts.forEach((e, idx) => { 
                        let onclickAttr = ''; let showPen = false; 
                        if (e.isFirebase) { 
                            const dynList = window.dynamicEvents[dKey] || []; 
                            const dynIdx = dynList.findIndex(de => de.title === e.title && de.time === e.time); 
                            if(dynIdx !== -1) { onclickAttr = `onclick="window.haptic(); window.openEditScheduleModal('${dKey}', ${dynIdx})"`; showPen = true; } 
                        } else { onclickAttr = `onclick="window.haptic(); alert('ê¸°ë³¸ ì¼ì •ì€ ëª» ë°”ê¿”ìš” ğŸ”’')"`; } 
                        
                        // Render List Items
                        if(e.type === 'personal_dot') { /* Skip */ } 
                        else {
                            let icon = 'fa-check text-[#8D6E63]', bg = 'bg-[#EFEBE9]'; 
                            if(e.type === 'dues') { icon = 'fa-coins text-[#388E3C]'; bg = 'bg-[#E8F5E9]'; } 
                            else if(e.type === 'bday') { icon = 'fa-cake-candles text-[#F57C00]'; bg = 'bg-[#FFF3E0]'; } 
                            else if(e.type === 'meet') { icon = 'fa-plane text-[#7B1FA2]'; bg = 'bg-[#F3E5F5]'; } 
                            else if(e.type === 'school') { icon = 'fa-school text-[#1976D2]'; bg = 'bg-[#E3F2FD]'; } 
                            else if(e.type === 'holiday') { icon = 'fa-flag text-[#D32F2F]'; bg = 'bg-[#FFEBEE]'; } 
                            else if(e.type === 'personal') { icon = 'fa-user text-[#303F9F]'; bg = 'bg-[#E8EAF6]'; } 

                            list.innerHTML += `
                            <div class="paper-card p-3 flex items-center gap-3 hover:bg-[#FFF] active:scale-95 cursor-pointer border border-[#E0D8D0]" ${onclickAttr}>
                                <div class="w-9 h-9 rounded-lg ${bg} flex items-center justify-center text-sm border border-[#D7CCC8]">
                                    <i class="fa-solid ${icon}"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex justify-between items-start mb-0.5">
                                        <p class="text-sm text-[#4A4036]">${e.title}</p>
                                        ${showPen ? '<i class="fa-solid fa-pen text-[#BDBDBD] text-xs"></i>' : ''}
                                    </div>
                                    <p class="text-xs text-[#8D6E63]">${month + 1}ì›” ${i}ì¼ Â· ${e.time}</p>
                                </div>
                            </div>`; 
                        } 
                    }); 
                } 
            } 
            if(!hasEvents) list.innerHTML = `<div class="text-center py-8 text-[#BDBDBD] font-light text-xs">ì¼ì •ì´ ì—†ë„¤ìš”.</div>`; 
        };

        window.updateTabUI = function(index) {
            window.activeTabIndex = index;
            const tabs = document.querySelectorAll('.screen-container');
            
            tabs.forEach((tab, i) => {
                if (i === index) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach((item, i) => {
                if (i === index) item.classList.add('active');
                else item.classList.remove('active');
            });

            if(index===1) window.renderCalendar(window.viewYear, window.viewMonth);
            else if(index===2) window.renderDues(window.currentDuesMonth);
        };

        // Birthday Logic
        window.closeBirthdayOverlay = function() {
            const overlay = document.getElementById('birthday-overlay');
            overlay.style.transition = 'opacity 0.5s';
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                if(window.stopFireworks) window.stopFireworks();
            }, 500);
        }

        window.leaveBirthdayMessage = function() {
            const msg = prompt("ì „ì‹œê¸°ì—ê²Œ ì¶•í•˜ ë©”ì„¸ì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!");
            if(msg) {
                alert("ë©”ì„¸ì§€ê°€ ì „ë‹¬ë˜ì—ˆì–´ìš”! (ë§ˆìŒìœ¼ë¡œ..ã…ã…)");
            }
        }

        window.startFireworks = function() {
            const canvas = document.getElementById('firework-canvas');
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            let width = canvas.width = window.innerWidth;
            let height = canvas.height = window.innerHeight;
            
            let fireworks = [];
            let particles = [];
            let balloons = [];
            let confetti = [];
            let animationId;

            window.addEventListener('resize', () => {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
            });

            function random(min, max) { return Math.random() * (max - min) + min; }

            // 1. Balloons (Pastel)
            class Balloon {
                constructor() {
                    this.x = Math.random() * width;
                    this.y = height + Math.random() * 100;
                    this.r = Math.random() * 10 + 15; // Radius
                    this.vx = (Math.random() - 0.5) * 1;
                    this.vy = Math.random() * 1.5 + 1;
                    this.color = `hsl(${Math.random() * 360}, 70%, 85%)`; // Pastel tone
                    this.stringLen = 50;
                }
                update() {
                    this.y -= this.vy;
                    this.x += Math.sin(this.y * 0.05) * 0.5 + this.vx;
                    if(this.y < -100) { // Reset if out of screen
                        this.y = height + 100;
                        this.x = Math.random() * width;
                    }
                }
                draw() {
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    // Balloon body (oval)
                    ctx.ellipse(this.x, this.y, this.r, this.r * 1.2, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // String
                    ctx.strokeStyle = "rgba(255,255,255,0.5)";
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y + this.r * 1.2);
                    ctx.quadraticCurveTo(this.x + 5, this.y + this.r * 1.2 + 25, this.x, this.y + this.r * 1.2 + this.stringLen);
                    ctx.stroke();
                }
            }

            // 2. Confetti (Paper scraps)
            class ConfettiPiece {
                constructor() {
                    this.x = Math.random() * width;
                    this.y = Math.random() * height - height;
                    this.size = Math.random() * 8 + 4;
                    this.speed = Math.random() * 2 + 1;
                    this.color = `hsl(${Math.random() * 360}, 80%, 60%)`;
                    this.angle = Math.random() * 360;
                    this.spin = (Math.random() - 0.5) * 0.2;
                    this.sway = Math.random() * 0.05;
                    this.swayOffset = Math.random() * 100;
                }
                update() {
                    this.y += this.speed;
                    this.angle += this.spin;
                    this.x += Math.sin(this.y * 0.01 + this.swayOffset) + this.sway;
                    if(this.y > height) {
                        this.y = -10;
                        this.x = Math.random() * width;
                    }
                }
                draw() {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(this.angle);
                    ctx.fillStyle = this.color;
                    ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size); // Square confetti
                    ctx.restore();
                }
            }

            // 3. Firework Projectile
            class Firework {
                constructor(sx, sy, tx, ty) {
                    this.x = sx; this.y = sy;
                    this.sx = sx; this.sy = sy;
                    this.tx = tx; this.ty = ty;
                    this.distanceToTarget = Math.sqrt(Math.pow(tx - sx, 2) + Math.pow(ty - sy, 2));
                    this.distanceTraveled = 0;
                    this.coordinates = [];
                    this.coordinateCount = 3;
                    while(this.coordinateCount--) { this.coordinates.push([this.x, this.y]); }
                    this.angle = Math.atan2(ty - sy, tx - sx);
                    this.speed = 2;
                    this.acceleration = 1.05;
                    this.brightness = random(50, 70);
                    this.hue = random(0, 360);
                }
                update(index) {
                    this.coordinates.pop();
                    this.coordinates.unshift([this.x, this.y]);
                    this.speed *= this.acceleration;
                    const vx = Math.cos(this.angle) * this.speed;
                    const vy = Math.sin(this.angle) * this.speed;
                    this.distanceTraveled = Math.sqrt(Math.pow(this.sx - this.x, 2) + Math.pow(this.sy - this.y, 2));
                    
                    if(this.distanceTraveled >= this.distanceToTarget) {
                        createParticles(this.tx, this.ty, this.hue);
                        fireworks.splice(index, 1);
                    } else {
                        this.x += vx;
                        this.y += vy;
                    }
                }
                draw() {
                    ctx.beginPath();
                    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
                    ctx.lineTo(this.x, this.y);
                    ctx.strokeStyle = `hsl(${this.hue}, 100%, ${this.brightness}%)`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }

            // 4. Explosion Particle
            class Particle {
                constructor(x, y, hue) {
                    this.x = x; this.y = y;
                    this.coordinates = [];
                    this.coordinateCount = 5;
                    while(this.coordinateCount--) { this.coordinates.push([this.x, this.y]); }
                    this.angle = random(0, Math.PI * 2);
                    this.speed = random(1, 10);
                    this.friction = 0.95;
                    this.gravity = 1;
                    this.hue = random(hue - 20, hue + 20);
                    this.brightness = random(50, 80);
                    this.alpha = 1;
                    this.decay = random(0.015, 0.03);
                }
                update(index) {
                    this.coordinates.pop();
                    this.coordinates.unshift([this.x, this.y]);
                    this.speed *= this.friction;
                    this.x += Math.cos(this.angle) * this.speed;
                    this.y += Math.sin(this.angle) * this.speed + this.gravity;
                    this.alpha -= this.decay;
                    if(this.alpha <= this.decay) {
                        particles.splice(index, 1);
                    }
                }
                draw() {
                    ctx.beginPath();
                    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
                    ctx.lineTo(this.x, this.y);
                    ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
                    ctx.stroke();
                }
            }

            function createParticles(x, y, hue) {
                let particleCount = 40; 
                while(particleCount--) {
                    particles.push(new Particle(x, y, hue));
                }
            }

            // Init objects
            for(let i=0; i<15; i++) {
                balloons.push(new Balloon());
            }
            for(let i=0; i<50; i++) {
                confetti.push(new ConfettiPiece());
            }

            function animate() {
                // Clear Canvas completely to avoid trails on Balloons/Confetti
                // But this removes firework trails? 
                // -> Firework & Particle classes store their own coordinate history to draw trails!
                ctx.clearRect(0, 0, width, height);

                // Draw Balloons
                balloons.forEach(b => { b.update(); b.draw(); });

                // Draw Confetti
                confetti.forEach(c => { c.update(); c.draw(); });

                // Draw Fireworks
                if(Math.random() < 0.05) { 
                    fireworks.push(new Firework(width / 2, height, random(0, width), random(0, height / 2)));
                    if(Math.random() < 0.3) {
                         fireworks.push(new Firework(random(0, width), height, random(0, width), random(0, height / 2)));
                    }
                }

                let i = fireworks.length;
                while(i--) {
                    fireworks[i].draw();
                    fireworks[i].update(i);
                }

                let k = particles.length;
                while(k--) {
                    particles[k].draw();
                    particles[k].update(k);
                }

                animationId = requestAnimationFrame(animate);
            }

            animate();
            window.stopFireworks = () => cancelAnimationFrame(animationId);
        }

        window.onload = () => {
            window.setGreeting();
            window.updateTabUI(0);
            window.startFireworks(); // Start celebration
        };

    </script>

    <!-- Firebase Module (DO NOT TOUCH) -->
    <script type="module">
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc, arrayUnion, getDoc, addDoc, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        window.getDoc = getDoc; 
        window.doc = doc;
        window.setDoc = setDoc;
        window.addDoc = addDoc;
        window.collection = collection;
        window.query = query;
        window.orderBy = orderBy;
        window.limit = limit;
        window.getDocs = getDocs;
        window.arrayUnion = arrayUnion;
        
        window.MEETING_PATH = ['meeting_account', 'dues_status'];
        window.SCHEDULE_PATH = ['meeting_account', 'schedules'];
        window.BACKUP_PATH = ['meeting_account', 'backups', 'history'];

        const stockConfig = { apiKey: "AIzaSyABn9xi7a-3LyLpvS6HT03gJUGTlQkgHmk", authDomain: "enjoystock.firebaseapp.com", projectId: "enjoystock", storageBucket: "enjoystock.firebasestorage.app", messagingSenderId: "981969177924", appId: "1:981969177924:web:51b0093a0d1b001ead9b11" };
        const meetingConfig = { apiKey: "AIzaSyAVQ_WdMXKuU2CgTgvSHqLKuAVGPeeDuOQ", authDomain: "enjoy-meeting-account.firebaseapp.com", projectId: "enjoy-meeting-account", storageBucket: "enjoy-meeting-account.firebasestorage.app", messagingSenderId: "956113498506", appId: "1:956113498506:web:b520f2b77fdb3295cb9873" };
        const STOCK_PATH = ['artifacts', 'enjoy-stock-live', 'public', 'data', 'stock_data', 'enjoy_ticker'];

        let meetingDb = null;

        function getOrInitializeApp(config, name) {
            const existingApps = getApps();
            const found = existingApps.find(app => app.name === name);
            if (found) return found;
            return initializeApp(config, name);
        }

        async function init() {
            if (window.isFirebaseInitialized) return;
            window.isFirebaseInitialized = true;

            try {
                const stockApp = getOrInitializeApp(stockConfig, 'stockApp');
                const stockDb = getFirestore(stockApp);
                await signInAnonymously(getAuth(stockApp)).catch(()=>{});
                onSnapshot(doc(stockDb, ...STOCK_PATH), (s) => { if(s.exists()) updateStockUI(s.data()); }, (error) => { console.warn("Stock snapshot error:", error); });

                const meetingApp = getOrInitializeApp(meetingConfig, 'meetingApp');
                const meetingAuth = getAuth(meetingApp);
                window.meetingDb = getFirestore(meetingApp);

                await signInAnonymously(meetingAuth).catch((e) => console.warn('Meeting Auth Failed', e));

                onSnapshot(doc(window.meetingDb, ...window.MEETING_PATH), (docSnap) => {
                    if (docSnap.exists()) { 
                        window.updateMeetingUI(docSnap.data()); 
                    } else { 
                        console.warn("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                    }
                }, (error) => { console.warn("Meeting snapshot error:", error); });

                onSnapshot(doc(window.meetingDb, ...window.SCHEDULE_PATH), (docSnap) => {
                    if (docSnap.exists()) { 
                        window.dynamicEvents = docSnap.data(); 
                        window.renderCalendar(window.viewYear, window.viewMonth); 
                    } else { 
                        window.dynamicEvents = {};
                    }
                }, (error) => { console.warn("Schedule snapshot error:", error); });
            } catch(e) { console.error("Firebase Init Error:", e); }
        }

        function updateStockUI(data) {
           // No Stock UI in this version
        }

        init();
    </script>
</body>
</html>